--- 
title: "Evaluating Discards using Observer Data Guyana`s Shrimp Fishery"
author: "Seion Richardson"
date: "`r Sys.Date()`"
site: bookdown::bookdown_site
output: bookdown::gitbook
documentclass: book
bibliography: [book.bib, packages.bib]
biblio-style: apalike
link-citations: yes
github-repo: rstudio/bookdown-demo

---

```{r 0.1, include = FALSE}
knitr::opts_chunk$set(echo = TRUE,
  #cache = FALSE,
  cache = TRUE,
  fig.align = "center",
  strip.white = TRUE,
  highlight = TRUE,
  comment = " ",
  message = FALSE
)
```

# Data

The data used in this project is on discarded fish species [(Appendix 12.2)][Discarded fish species] from the Atlantic seabob [(Appendix 12.3)][Atlantic seabob shrimp] fishery in Guyana, South America (Figure \@ref(fig:fig01)). The data was collected at-sea by fishery observers (Figure \@ref(fig:fig02)) onboard seven Atlantic seabob shrimp bottom trawl vessels [(Appendix 12.1)][Bottom trawl fishing vessel] between 2019 to 2020 (see chapter 1.3 for data variables). The data was collected within the seabob trawling zone i.e. 15 to 33 metres of water depth (Figure \@ref(fig:fig01)). It includes sampled bottom trawl fishing tow data from eight distinct fishing trips (one vessel was used twice) with an average of six sampled hauls per trip (three day, three night) and at different fishing depths.

## Fishing Area

<center>

![(#fig:fig01) Map of Guyana EEZ. The Yellow boundary lines represents the different zone demarcations. The Seabob trawling zone (15 to 33 meter lines) is colored red (Richardson, 2020).](C:\Users\UNUFTP\Documents\MyGit\Masters-Thesis-Seion\GuyanaEEZ.png){width=65%}

</center>

### Sampling protocol used to collect data

<center>

![(#fig:fig02) Data collection sampling protocol used to collect the data for this project](C:\Users\UNUFTP\Documents\MyGit\Masters-Thesis-Seion\SamplingProtocol2.png){width=75%}

</center>

## Data Analysis 

**R packages used in this project**

```{r 0.2, message = FALSE, warning = FALSE}
library(bookdown)
library(tidyverse)
library(kableExtra)
library(tidytext)
library(gridExtra)
library(broom)
library(rcompanion)
library(corrplot)
library(FSA)
library(lattice)
library(Hmisc)
library(mclust)
library(MASS)
library(RColorBrewer)
library(FactoMineR)
library(cluster)    # clustering algorithms
library(factoextra) # clustering algorithms & visualization
library(GGally)
library(vegan)
library(psych)
library(PerformanceAnalytics)
library(CCA)
library(CCP)
```

```{r 0.3, message = FALSE}
# Reading in data 
ObserverData <- read_csv("observer_weights_mas102m.csv") %>% 
  filter(hrs_dec > 2) # Removing trip 28 from data

# Names of variables 
names(ObserverData)

# Dimension of dataset
dim(ObserverData)
```


**Inspecting the classes of variables**

```{r 0.3.1}
ObserverData %>% 
  glimpse()

### CODE COMMENTS ###
#[1]. glimpse() is used to view the classes of each variable from the data. 
```

From the output created above we can see that of the 32 variables, 17 were of class characters, 3 difftime and 12 numeric. All the data seems to fit reasonably well into the required categories i.e. character, difftime and numeric. The main exceptions were the dates variables. Normally, these would have needed to be converted before use. However, this will not be done in this project as dates are not required to answer the research questions. 

**Description of data variables**

The variables within the data are coded. A total of 32 variables were recorded in the data. A description for each variable is below : 

1. **company**: Fishing company
2. **dep_date**: Date the vessel departs port for fishing
3. **arr_date**: Date the vessel returns from fishing
4. **das**: Number of days the vessel spent at-sea       
5. **trip**: Unique trip identification number
6. **drag**: Unique drag identification number by 
7. **drag_all**: Sequential drag identification number 
8. **drag_date**: Date the drag was done
9. **day**: Day the drag was done
10. **month**: Month the drag was done
11. **year**: Year the drag was done
12. **zone**: Fishing zone (Figure 1) where the drag was done
13. **drag_period**: Binary variable of time of day for drag
14. **drag_time_s**: Time the drag started (24:00 hrs)
15. **drag_time_e**: Time the drag ended (24:00 hrs)
16. **time_fished_min**: Time fished in hours
17. **hrs_dec**: Time fished converted to decimals 
18. **depth**: Average fishing depth
19. **depth_sd**: Binary variable of fishing depth
20. **id_status**: Binary variable of species identification
21. **com_status**: Binary variable of species economic status<br>
22. **order**: Species taxonomy - Order
23. **family**: Species taxonomy - Family
24. **class**: Species taxonomy - Class
25. **total_catch_cat**: Catch categorization (see definitions)
26. **total_catch_spp**: Board species categorization
27. **categories**: More narrow species categorization <br>
28. **sci_name**: Latin names for each species
29. **alpha_code**: Unique 3-alpha species identifier used by FAO
30. **com_name**: Local name or "call name" for species 
31. **sample_wt_lbs**: Species sample weight per drag (in lbs) 
32. **total_wt_lbs**: Species total weight per drag (in lbs)

From (Table \@ref(tab:tab01)) we can get a quick view of the first few rows of the data and the old variable names before they are changed. 

```{r tab01}
Table.1.1 <- head(ObserverData) 

Table.1.1 %>% 
  kbl(caption = "The first six rows of data",
    align = "l") %>%
  kable_classic() %>%
  row_spec(0, bold = TRUE) %>%
  kable_styling(fixed_thead = T,
    bootstrap_options = c("striped",
      "condensed")) %>% 
  scroll_box(width = "770px", height = "550px")

### CODE COMMENTS ###
#[1]. A peek at first 6 rows in data using head().
#[2]. kable() is used to create a scrollable html table. This is useful for data with many variables 
#     like this one. 
```

**Renaming of all the variables from the data**

```{r 0.4}
# Renaming of variables 
ObserverData <-  ObserverData %>% 
  dplyr::rename(Company = company, 
    Departure = dep_date,
    Arrival = arr_date, 
    DaysAtSea = das, 
    TripID = trip, 
    DragID = drag, 
    DragID2 = drag_all, 
    DragDate = drag_date,
    Day = day,
    Month = month,
    Year = year,
    FishingZones = zone,
    TimePeriods = drag_period, 
    DragStart = drag_time_s, 
    DragEnd = drag_time_e, 
    TimeFishedHrs = time_fished_min, 
    TimeFishedDec = hrs_dec, 
    FishingDepthFtm = depth, 
    FishingDepth2 = depth_sd, 
    SpeciesID = id_status, 
    EconomicStatus = com_status, 
    OrderTax = order, 
    FamilyTax = family, 
    ClassTax = class, 
    CatchCategory = total_catch_cat, 
    SpeciesCategory = total_catch_spp, 
    SpeciesCategory2 = categories,
    SpeciesCategory3 = categories2,
    LatinNames = sci_name, 
    AplhaCode = alpha_code, 
    CommonName = com_name, 
    SampleWeightLB = sample_wt_lbs, 
    TotalWeightLB = total_wt_lbs)
```

## Creating a few additonal variables

Four new variables were added to the data. These variables will change the convert older variables from **Imperial** to **Metric** units (e.g. pounds to kilograms).  

```{r 0.5}
ObserverData <- ObserverData %>% 
  mutate(SampleWeightKG = round(SampleWeightLB/2.2, 2), 
    TotalWeightKG = round(TotalWeightLB/2.2, 2),
    CpueKGHR = round(TotalWeightKG/TimeFishedDec, 5),
    FishingDepthMtr = round(FishingDepthFtm*1.8288))
```

## Dividing the data up by catch groups

```{r 0.6}
DiscardedCatch <- ObserverData %>%
  filter(CatchCategory == "Discarded catch")

IncidentalCatch <- ObserverData %>%
  filter(CatchCategory == "Incidental catch")

TargetCatch <- ObserverData %>%
  filter(CatchCategory == "Target catch")
```

### Data by bottom trawl tows sampled - Appendix

```{r 0.7}
# Creating Table
SummaryTable <- ObserverData %>% 
  group_by(TripID,
    Company,
    DragID2,
    Departure,
    Month,
    TimePeriods,
    FishingZones,
    FishingDepthMtr,
    Arrival,
    CatchCategory) %>% 
  dplyr::summarise(SumWeightsKG = round(sum(TotalWeightKG),2),
    MeanEffortHr = round(mean(TimeFishedDec),2),
    CpueKGHr = round(SumWeightsKG/MeanEffortHr,2),
    CountSpecies = n()) %>%  
  mutate(PropWeight = round(SumWeightsKG/sum(SumWeightsKG),2)) %>%   arrange(DragID2)


# Print Table
SummaryTable %>% 
  kbl() %>%
  kable_classic() %>% 
  row_spec(0, bold = TRUE) %>% 
  kable_styling(fixed_thead = T,
    bootstrap_options = "condensed") %>% 
  scroll_box(width = "750px", height = "600px")

```


```{r 0.8, include = FALSE}
# automatically create a bib database for R packages
knitr::write_bib(c(
  .packages(),
  'tidyverse',
  'kableExtra'),
  'packages.bib')
```

<!--chapter:end:index.Rmd-->

# Distribution of factor variables

## Company

```{r 1.1}
ObserverData.2 <- ObserverData %>% 
  group_by(DragID2,
    Company) %>% 
  dplyr::summarise(.groups = 'drop')

ObserverData.2 <- ObserverData.2 %>% 
  group_by(Company) %>% 
  dplyr::summarise(n = n(),
    .groups = 'drop')

ggplot(data = ObserverData.2,
  aes(x = Company,
    y = n,
    color = Company)) + 
  geom_bar(stat = "identity",
    width = .3,
    fill = "gray") +
  scale_fill_brewer(palette = "Set2") +
  theme_bw() +
  theme(panel.background = element_rect(fill = "white",
    colour = "grey50"),
    legend.position = "none") +
  labs(x = "Company",
    y = "Count",
    title = "Histogram of bottom trawl sampling distribution by company") 
```

## Fishing Depths

```{r 1.2}
ObserverData.3 <- ObserverData %>% 
  group_by(DragID2,
    FishingDepthMtr) %>% 
  dplyr::summarise(.groups = 'drop')

ggplot(data = ObserverData.3,
  aes(x = FishingDepthMtr)) + 
  geom_bar(color = "blue",
    fill = "gray") +
  scale_x_continuous(breaks = seq(from = 9, to = 22)) +
  scale_fill_brewer(palette = "Set2") +
  theme_bw() +
  theme(panel.background = element_rect(fill = "white",
    colour = "grey50"),
    legend.position = "none") +
  labs(x = "Fishing Depths (m)",
    y = "Count",
    title = "Histogram of bottom trawl sampling distribution by fishing depths")
```

## Time of day

```{r 1.3}

ObserverData.4 <- ObserverData %>% 
  group_by(DragID2, TimePeriods) %>% 
  dplyr::summarise(.groups = 'drop')

ObserverData.4 <- ObserverData.4 %>% 
  group_by(TimePeriods) %>% 
  dplyr::summarise(n = n(),
    .groups = 'drop')

ggplot(data = ObserverData.4,
  aes(x = TimePeriods,
    y = n,
    color = TimePeriods)) + 
  geom_bar(stat = "identity",
    width = .3,
    fill = "gray") +
  theme_bw() +
  scale_fill_brewer(palette = "Set2") +
  theme(panel.background = element_rect(fill = "white",
    colour = "grey50"),
    legend.position = "none") +
  labs(x = "Time of day",
    y = "Count",
    title = "Histogram of bottom trawl sampling distribution by time of day")

```

## Months

```{r 1.4}
ObserverData.5 <- ObserverData %>% 
  group_by(DragID2, Month) %>% 
  dplyr::summarise(.groups = 'drop')

ggplot(data = ObserverData.5,
  aes(x = Month)) + 
  geom_bar(color = "orange",
    fill = "gray") +
  scale_x_continuous(breaks = seq(from = 1, to = 12)) +
  theme_bw() +
  scale_fill_brewer(palette = "Set2") +
  theme(panel.background = element_rect(fill = "white",
    colour = "grey50"),
    legend.position = "none") +
  labs(x = "Months",
    y = "Count",
    title = "Histogram of bottom trawl sampling distribution by month")
```

## Fishing Zones

```{r 1.5}
ObserverData.6 <- ObserverData %>% 
  group_by(DragID2, FishingZones) %>% 
  dplyr::summarise(.groups = 'drop')

ggplot(data = ObserverData.6,
  aes(x = FishingZones)) + 
  geom_bar(color = "red",
    fill = "gray") +
  scale_x_continuous(breaks = seq(from = 1, to = 9)) +
  theme_bw() +
  scale_fill_brewer(palette = "Set2") +
  theme(panel.background = element_rect(fill = "white",
    colour = "grey50"),
    legend.position = "none") +
  labs(x = "Fishing Zones",
    y = "Count",
    title = "Histogram of bottom trawl sampling distribution by fishing zones")

```




<!--chapter:end:01-part1.Rmd-->

# Catch per unit effort

```{r 2.1}
# Length data

LengthImport <- read_csv("observer_lengths_mas102m.csv")

LengthData <- inner_join(ObserverData,
  LengthImport,
  by = c("TripID", "DragID2", "LatinNames"))

# Creating Table
SummaryTable2 <- ObserverData %>% 
  group_by(TripID,
    Company,
    DragID2,
    Departure,
    Month,
    TimePeriods,
    FishingZones,
    FishingDepthMtr,
    Arrival) %>% 
  dplyr::summarise(SumWeightsKG = round(sum(TotalWeightKG),2),
    MeanEffortHr = round(mean(TimeFishedDec),2),
    CpueKGHr = round(SumWeightsKG/MeanEffortHr,2),
    CountSpecies = n(),
    .groups = 'drop') %>%  
  mutate(PropWeight = round(SumWeightsKG/sum(SumWeightsKG),2)) %>%   arrange(DragID2)
```


## All species

```{r 2.2, fig.width = 6, fig.height = 8}

ggplot(data = SummaryTable,
  aes(x = CpueKGHr,
    fill = CatchCategory)) + 
  geom_histogram(bins = 20) +
  theme_bw() +
  theme(panel.background = element_rect(fill = "white",
    colour = "grey50"),
    legend.position = "none") +
  labs(x = "CPUE (kgs/hr)",
    y = "Count",
    title = "Histograms of CPUE for all species observations",
    subtitle = "Colour is used to represent the different catch groups") +
  facet_wrap(~CatchCategory,
    scales = "free",
    ncol = 1) 
```

### Bottom trawl tows

```{r 2.3, fig.width = 7, fig.height = 8}
ObserverData2 <- ObserverData %>%
  group_by(DragID2,
    CatchCategory) %>%
  dplyr::summarise(Mean.cpue = mean(CpueKGHR),
    Mean.cpue.sd = sd(CpueKGHR),
    Count = n(),
    Mean.cpue.se = Mean.cpue.sd/sqrt(Count),
    .groups = 'drop')

ggplot(data = ObserverData2,
  aes(x = as.factor(DragID2), 
    y = Mean.cpue,
    color = CatchCategory,  
    shape = CatchCategory,
    group = 1)) +
  geom_point() +
  geom_line() +
  geom_errorbar(aes(ymin = Mean.cpue - Mean.cpue.se,
    ymax = Mean.cpue + Mean.cpue.se),
    width = .5) +
  theme_bw() +
  theme(panel.background = element_rect(fill = "white",
    colour = "grey50"),
    legend.position = "none",
    axis.text.x = element_text(angle = 90)) +
  labs(x="Bottom Trawl Tows",
    y = "Mean CPUE (kgs/hr)",
    title = "Line plots of the mean CPUE(with SE bars) for all species observations \nacross bottom trawl tows",
    subtitle = "Colour is used to represent the different catch groups") +
  facet_wrap(~CatchCategory,
    scales = "free",
    ncol = 1)

```

### Fishing Depths

```{r 2.4, fig.width = 7, fig.height = 8}

ObserverData3 <- ObserverData %>% 
  group_by(FishingDepthMtr,
    CatchCategory) %>% 
  dplyr::summarise(Mean.cpue = mean(CpueKGHR),
    Mean.cpue.sd = sd(CpueKGHR),
    Count = n(),
    Mean.cpue.se = Mean.cpue.sd/sqrt(Count),
    .groups = 'drop')

ggplot(data = ObserverData3,
  aes(x = as.factor(FishingDepthMtr), 
    y = Mean.cpue,
    color = CatchCategory,  
    shape = CatchCategory,
    group = 1)) +
  geom_point() +
  geom_line() +
  geom_errorbar(aes(ymin = Mean.cpue - Mean.cpue.se,
    ymax = Mean.cpue + Mean.cpue.se),
    width = .1) +
  theme_bw() +
  theme(panel.background = element_rect(fill = "white",
    colour = "grey50"),
    legend.position = "none",
    axis.text.x = element_text(angle = 90)) +
  labs(x="Fishing Depths (m)",
    y = "Mean CPUE (kgs/hr)",
    title = "Line plots of mean CPUE(with SE bars) for all species observations across \nfishing depths",
    subtitle = "Colour is used to represent the different catch groups") +
  facet_wrap(~CatchCategory,
    scales = "free",
    ncol = 1) 

```

### Time of day

```{r 2.5, fig.width = 5, fig.height = 8}

ObserverData5 <- ObserverData %>% 
  group_by(TimePeriods,
    CatchCategory) %>% 
  dplyr::summarise(Mean.cpue = mean(CpueKGHR),
    Mean.cpue.sd = sd(CpueKGHR),
    Count = n(),
    Mean.cpue.se = Mean.cpue.sd/sqrt(Count),
    .groups = 'drop')

ggplot(data = ObserverData5,
  aes(x = TimePeriods, 
    y = Mean.cpue,
    fill = CatchCategory)) + 
  geom_col(width = 0.2) +
  geom_errorbar(aes(ymin = Mean.cpue - Mean.cpue.se,
    ymax = Mean.cpue + Mean.cpue.se),
    width = .05) + 
  scale_fill_brewer(palette = "Set2") +
  theme_bw() +
  theme(panel.background = element_rect(fill = "white",
    colour = "grey50"),
    legend.position = "none",
    axis.text.x = element_text(angle = 90)) +
  labs(x = "Time of day",
    y = "Mean CPUE (kgs/hr)",
    title = "Barplots of mean CPUE(with SE bars) for all species \nobservations across time of day",
    subtitle = "Colour is used to represent the different catch groups") +
  facet_wrap(~CatchCategory,
    scales = "free",
    ncol = 1) 

```

### Company

```{r 2.6, fig.width = 5, fig.height = 8}

ObserverData5 <- ObserverData %>% 
  group_by(Company,
    CatchCategory) %>% 
  dplyr::summarise(Mean.cpue = mean(CpueKGHR),
    Mean.cpue.sd = sd(CpueKGHR),
    Count = n(),
    Mean.cpue.se = Mean.cpue.sd/sqrt(Count),
    .groups = 'drop')

ggplot(data = ObserverData5,
  aes(x = Company, 
    y = Mean.cpue,
    fill = CatchCategory)) + 
  geom_col(width = 0.2) +
  geom_errorbar(aes(ymin = Mean.cpue - Mean.cpue.se,
    ymax = Mean.cpue + Mean.cpue.se),
    width = .05) +
  scale_fill_brewer(palette = "Set3", direction = -1) +
  theme_bw() +
  theme(panel.background = element_rect(fill = "white",
    colour = "grey50"),
    legend.position = "none",
    axis.text.x = element_text(angle = 90)) +
  labs(x="Company",
    y = "Mean CPUE (kgs/hr)",
    title = "Barplots of mean CPUE(with SE bars) for all species \nobservations across fishing companies",
    subtitle = "Colour is used to represent the different catch groups") +
  facet_wrap(~CatchCategory,
    scales = "free",
    ncol = 1) 

```

### Months

```{r 2.7, fig.width = 7, fig.height = 8}

ObserverData6 <- ObserverData %>% 
  group_by(Month,
    CatchCategory) %>% 
  dplyr::summarise(Mean.cpue = mean(CpueKGHR),
    Mean.cpue.sd = sd(CpueKGHR),
    Count = n(),
    Mean.cpue.se = Mean.cpue.sd/sqrt(Count),
    .groups = 'drop')

ggplot(data = ObserverData6,
  aes(x = as.factor(Month), 
    y = Mean.cpue,
    color = CatchCategory,  
    shape = CatchCategory,
    group = 1)) +
  geom_point() +
  geom_line() +
  geom_errorbar(aes(ymin = Mean.cpue - Mean.cpue.se,
    ymax = Mean.cpue + Mean.cpue.se),
    width = .1) +
  geom_point() +
  geom_line() +
  theme_bw() +
  theme(panel.background = element_rect(fill = "white",
    colour = "grey50"),
    legend.position = "none",
    axis.text.x = element_text(angle = 90)) +
  labs(x="Months",
    y = "Mean CPUE (kgs/hr)",
    title = "Line plots of mean CPUE(with SE bars) for all species observations across \nmonths",
    subtitle = "Colour is used to represent the different catch groups") +
  facet_wrap(~CatchCategory,
    scales = "free",
    ncol = 1) 

```

### Checking if code worked using Months...

```{r 2.8}
# Table
head(ObserverData6)

Test.data <- ObserverData %>%
  filter(CatchCategory == "Discarded catch" & Month == 2)

sd(Test.data$CpueKGHR)/sqrt(length(Test.data$CpueKGHR)) # sd/sqrt(n)
```


```{r 2.9}
# Plot
names <- unique(ObserverData6$CatchCategory)

for(i in names){
  Check.data <- ObserverData %>% 
    filter(CatchCategory == i) %>% 
    group_by(Month,
      CatchCategory) %>% 
    dplyr::summarise(Mean.cpue = mean(CpueKGHR),
      Mean.cpue.sd = sd(CpueKGHR),
      Count = n(),
      Mean.cpue.se = Mean.cpue.sd/sqrt(Count),
      .groups = 'drop')
  
  plots <- ggplot(data = Check.data,
    aes(x = as.factor(Month), 
      y = Mean.cpue,
      color = CatchCategory,  
      shape = CatchCategory,
      group = 1)) +
    geom_point() +
    geom_line() +
    geom_errorbar(aes(ymin = Mean.cpue - Mean.cpue.se,
      ymax = Mean.cpue + Mean.cpue.se),
      width = .1) +
    geom_point() +
    geom_line() +
    theme_bw() +
    theme(panel.background = element_rect(fill = "white",
      colour = "grey50"),
      legend.position = "none",
      axis.text.x = element_text(angle = 90)) +
    labs(x="Months",
      y = "Mean CPUE (kgs/hr)",
      title = paste0("Line plots of the mean ",i ," CPUE \n(with SE bars) for all species observations across \nmonths"))
  
  print(plots)
}
names(ObserverData6)
```

### Fishing Zones

```{r 2.10, fig.width = 7, fig.height = 8}

ObserverData7 <- ObserverData %>% 
  group_by(FishingZones,
    CatchCategory) %>% 
  dplyr::summarise(Mean.cpue = mean(CpueKGHR),
    Mean.cpue.sd = sd(CpueKGHR),
    Count = n(),
    Mean.cpue.se = Mean.cpue.sd/sqrt(Count),
    .groups = 'drop')

ggplot(data = ObserverData7,
  aes(x = as.factor(FishingZones), 
    y = Mean.cpue,
    fill = CatchCategory,
    color = CatchCategory,  
    shape = CatchCategory,
    group = 1)) +
  geom_point() +
  geom_line() +
  geom_errorbar(aes(ymin = Mean.cpue - Mean.cpue.se,
    ymax = Mean.cpue + Mean.cpue.se),
    width = .1) +
  theme_bw() +
  theme(panel.background = element_rect(fill = "white",
    colour = "grey50"),
    legend.position = "none",
    axis.text.x = element_text(angle = 90)) +
  labs(x = "Fishing Zones",
    y = "Mean CPUE (kgs/hr)",
    title = "Line plots of mean CPUE(with SE bars) for all species observations across \nfishing zones",
    subtitle = "Colour is used to represent the different catch groups") +
  facet_wrap(~CatchCategory,
    scales = "free",
    ncol = 1) 
```

## Species CPUE

```{r 2.11, fig.height = 5.5, warning = FALSE}
# Names to remove 
Remove <- c("Multiple species finfish", "Multiple species prawns", "Xiphopenaeus kroyeri")

# Data
Top10Species <- ObserverData %>% 
  group_by(LatinNames, CommonName) %>% 
  dplyr::summarise(NoSampled = n(),
    .groups = 'drop') %>%
  filter(NoSampled >= 10) %>%
  filter(!LatinNames %in% Remove) %>%
  arrange(desc(NoSampled)) %>% 
  head(10)

# Creating a vector of names
Top10names <- Top10Species$LatinNames


# Filtering data to keep species
FilteredSpecies <- ObserverData %>% 
  filter(LatinNames %in% Top10names) %>% 
  group_by(DragID2) %>%  
  mutate(PropWeight = round(CpueKGHR/sum(CpueKGHR),5)) %>% 
  mutate(LatinNames = fct_relevel(LatinNames, Top10names)) 

# Plotting species 
ggplot(data = FilteredSpecies,
  aes(x = reorder(LatinNames,
    CpueKGHR,
    FUN = median), 
    y = CpueKGHR,
    fill = LatinNames)) + 
  geom_boxplot() +
  stat_boxplot(geom = 'errorbar', width = 0.2) +
  # scale_y_continuous(trans='log10') +
  ylim(0, 30) +
  scale_fill_brewer(palette = "Set3") +
  theme_bw() +
  theme(panel.background = element_rect(fill = "white",
    colour = "grey50"),
    legend.position = "none") +
  labs(x = "Species",
    y = "CPUE (kgs/hr)",
    title = "Boxplot of CPUE data for the Top 10 species",
    subtitle = "These species were in at least 10 fishing trips \n4 observations above 30 kgs/hr were removed") +
  coord_flip()
```


### Species by bottom trawl tows

```{r 2.12}

ggplot(data = FilteredSpecies,
  mapping = aes(x = as.factor(DragID2), 
    y = PropWeight, 
    fill = LatinNames)) +
  geom_col(width = 0.9) +
  theme_bw() +
  theme(legend.position = "bottom",
    axis.text.x = element_text(angle = 90,
      vjust = 0.5,
      hjust = 0.1)) +
  labs(x = "Bottom Trawl Tows", 
    y = "Proportions",
    title = "Stacked barplot of the top 10 species proportion change across bottom trawl tows",
    subtitle = "Colour is used to represent the different species ") + 
  scale_fill_brewer(palette = "Paired", 
    name = " ") 
```


## Histogram of Top 10 species CPUE

```{r 2.13, fig.width = 8, fig.height = 10}

ggplot(data = FilteredSpecies,
  aes(x = CpueKGHR,
    fill = as.factor(LatinNames))) + 
  geom_histogram(bins = 20) +
  theme_bw() +
  theme(panel.background = element_rect(fill = "white",
    colour = "grey50"),
    legend.position = "none") +
  labs(x = "CPUE (kgs/hr)",
    y = "Count",
    title = "Histograms of all CPUE observations for the Top 10 species",
    subtitle = "Colour is used to represent the different species") +
  facet_wrap(~LatinNames,
    scales = "free",
    ncol = 2)
```

## Weight proportions for the Top 10 Discard Species across fishing tows

### Tables 

```{r 2.14, message = FALSE, include = FALSE}

# Tables
for (i in Top10names){

  Tables <- FilteredSpecies %>%
    filter(LatinNames == i) %>%
  kbl() %>%
  kable_classic() %>%
  row_spec(0, bold = TRUE) %>%
  kable_styling(fixed_thead = T,
    bootstrap_options = "condensed")

  print(Tables)
}
```


### Plots

```{r 2.15, fig.width = 8, fig.height = 18, warning = FALSE}

FilteredSpecies %>% 
  # filter(LatinNames == "Callinectes ornatus") %>% 
  # filter(!DragID2 == 9) %>% 
  ggplot(aes(x = as.factor(DragID2),
    y = PropWeight,
    fill = LatinNames)) +
  geom_bar(stat = "identity") +
  labs(x = "Bottom trawl tows",
    y = "Proportion of CPUE") +
  theme_bw() +
  theme(legend.position = "none",
     axis.text.y = element_text(size = 8)) +
  guides(fill = guide_legend(title = "Latin Name")) +
  coord_flip() +
  facet_wrap(~LatinNames)
```

## Species Length Table

```{r 2.16}

# Creating species length table 
SpeciesLengths <- LengthData %>% 
  group_by(LatinNames) %>% 
  dplyr::summarise(NoMeasured = n(),
    MeanLength = round(mean(Lengths)),
    MedianLength = round(median(Lengths)),
    SDLength = round(sd(Lengths)),
    MaxLength = round(max(Lengths)),
    MinLength = round(min(Lengths)),
    .groups = 'drop') %>%
  arrange(desc(NoMeasured))

# Printing table 
SpeciesLengths %>% 
  kbl() %>%
  kable_classic() %>% 
  row_spec(0, bold = TRUE) %>% 
  kable_styling(fixed_thead = T,
    bootstrap_options = "condensed")

```

## Visualising Lenght Measurements

```{r 2.17, fig.height = 10, fig.width = 8}

# Plotting data
LengthData %>%
  filter(!LatinNames == "Trichiurus lepturus") %>% 
  ggplot(aes(x = reorder(LatinNames, 
    Lengths,
    FUN = median),
    y = Lengths,
    fill = LatinNames)) +
  geom_boxplot(show.legend = FALSE) +
  stat_boxplot(geom = 'errorbar', width = 0.2) +
  theme_bw() +
  scale_fill_brewer(palette = "Paired") +
  coord_flip() +
  labs(y = "Lengths (cm)",
    x = NULL,
    title = "Box plot of species lengths for the species meaured",
    subtitle = "Trichiurus lepturus (the largest) was removed to better see the distributions")
```


```{r 2.18}
# Plot of single species

LengthData %>%
  filter(LatinNames == "Trichiurus lepturus") %>% 
  ggplot(aes(x = reorder(LatinNames, 
    Lengths,
    FUN = median),
    y = Lengths,
    fill = LatinNames)) +
  geom_boxplot(show.legend = FALSE, width = 0.3) +
  stat_boxplot(geom = 'errorbar', width = 0.2) +
  theme_bw() +
  scale_fill_brewer(palette = "Paired") +
  labs(y = "Lengths (cm)",
    x = NULL,
    title = "Box plot of Trichiurus lepturus lengths")
```


<!--chapter:end:02-part2.Rmd-->

# Cpue by species

<!-- **FREQUENCY HISTOGRAMS** -->

<!-- ```{r, fig.width = 7, fig.height = 65} -->

<!-- Species <- ObserverData %>%  -->
<!--   group_by(LatinNames, CommonName) %>%  -->
<!--   dplyr::summarise(NoSampled = n(), -->
<!--     .groups = 'drop') %>% -->
<!--   filter(NoSampled >= 10) %>%  -->
<!--   arrange(desc(NoSampled))  -->

<!-- Species.names <- Species$LatinNames -->
<!-- Remove <- c("Multiple species finfish", "Multiple species prawns", "Xiphopenaeus kroyeri") -->


<!-- Plot.species <- ObserverData %>%  -->
<!--   filter(LatinNames %in% Species.names) -->


<!-- Plot.species <- Plot.species %>%  -->
<!--   mutate(LatinNames = fct_relevel(LatinNames, Species.names)) %>% -->
<!--   filter(!LatinNames %in% Remove) -->

<!-- Plot.species %>%  -->
<!--   ggplot(aes(x = CpueKGHR, -->
<!--     fill = LatinNames)) +  -->
<!--   geom_histogram(bins = 20) + -->
<!--   theme_bw() + -->
<!--   theme(panel.background = element_rect(fill = "white", -->
<!--     colour = "grey50"), -->
<!--     legend.position = "none") + -->
<!--   labs(x = "CPUE (kgs/hr)", -->
<!--     y = "Count", -->
<!--     title = "Histograms of CPUE for all species observations", -->
<!--     subtitle = "Colour is used to represent the different catch groups") + -->
<!--   facet_wrap(~LatinNames, -->
<!--     scales = "free",  -->
<!--     ncol = 2)  -->
<!-- ``` -->

<!-- ## Company -->

<!-- ```{r, fig.width = 6, fig.height = 6} -->
<!-- names <- unique(Plot.species$LatinNames) -->

<!-- for(i in names){ -->

<!--   Plots.1 <- ggplot(Plot.species %>%  -->
<!--       filter(LatinNames == i), -->
<!--     aes(x = CpueKGHR, -->
<!--       fill = Company)) +  -->
<!--     geom_histogram(bins = 20) + -->
<!--     theme_bw() + -->
<!--     theme(panel.background = element_rect(fill = "white", -->
<!--       colour = "grey50"), -->
<!--       legend.position = "none") + -->
<!--     labs(x = "CPUE (kgs/hr)", -->
<!--       y = "Count", -->
<!--       title = paste0("Histogram of ", i, " CPUE - all observations"), -->
<!--       subtitle = "Colour is used to represent the different fishing companies") + -->
<!--     facet_wrap(~Company, -->
<!--       scales = "free",  -->
<!--       ncol = 1) -->

<!--   print(Plots.1) -->

<!-- } -->

<!-- ``` -->


<!-- ## Fishing Depths -->

<!-- ```{r, fig.width = 7, fig.height = 9, warning = FALSE} -->

<!-- for(i in names){ -->

<!--   Plots.2 <- ggplot(Plot.species %>%  -->
<!--       filter(LatinNames == i), -->
<!--     aes(x = CpueKGHR, -->
<!--       fill = as.factor(FishingDepthMtr))) +  -->
<!--     geom_histogram(bins = 20) + -->
<!--     theme_bw() + -->
<!--     theme(panel.background = element_rect(fill = "white", -->
<!--       colour = "grey50"), -->
<!--       legend.position = "none") + -->
<!--     labs(x = "CPUE (kgs/hr)", -->
<!--       y = "Count", -->
<!--       title = paste0("Histogram of ", i, " CPUE - all observations"), -->
<!--       subtitle = "Colour is used to represent the different fishing depths") + -->
<!--     facet_wrap(~FishingDepthMtr, -->
<!--       scales = "free", -->
<!--       ncol = 2) -->

<!--   print(Plots.2) -->

<!-- } -->

<!-- ``` -->


<!-- ## Time of day -->

<!-- ```{r, fig.width = 6, fig.height = 6} -->

<!-- for(i in names){ -->

<!--   Plots.3 <- ggplot(Plot.species %>%  -->
<!--       filter(LatinNames == i), -->
<!--     aes(x = CpueKGHR, -->
<!--       fill = TimePeriods)) +  -->
<!--     geom_histogram(bins = 20) + -->
<!--     theme_bw() + -->
<!--     theme(panel.background = element_rect(fill = "white", -->
<!--       colour = "grey50"), -->
<!--       legend.position = "none") + -->
<!--     labs(x = "CPUE (kgs/hr)", -->
<!--       y = "Count", -->
<!--       title = paste0("Histogram of ", i, " CPUE - all observations"), -->
<!--       subtitle = "Colour is used to represent the different time of day") + -->
<!--     facet_wrap(~TimePeriods, -->
<!--       scales = "free",  -->
<!--       ncol = 1)  -->

<!--   print(Plots.3) -->

<!-- } -->

<!-- ``` -->

<!-- ## Months -->

<!-- ```{r, fig.width = 7, fig.height = 9} -->

<!-- for(i in names){ -->

<!--   Plots.4 <- ggplot(Plot.species %>%  -->
<!--       filter(LatinNames == i), -->
<!--     aes(x = CpueKGHR, -->
<!--       fill = as.factor(Month))) +  -->
<!--     geom_histogram(bins = 20) + -->
<!--     theme_bw() + -->
<!--     theme(panel.background = element_rect(fill = "white", -->
<!--       colour = "grey50"), -->
<!--       legend.position = "none") + -->
<!--     labs(x = "CPUE (kgs/hr)", -->
<!--       y = "Count", -->
<!--       title = paste0("Histogram of ", i, " CPUE - all observations"), -->
<!--       subtitle = "Colour is used to represent the different fishing depths") + -->
<!--     facet_wrap(~Month, -->
<!--       scales = "free", -->
<!--       ncol = 2) -->

<!--   print(Plots.4) -->

<!-- } -->

<!-- ``` -->

<!-- ## Fishing Zones -->

<!-- ```{r, fig.width = 7, fig.height = 8} -->

<!-- for(i in names){ -->

<!--   Plots.5 <- ggplot(Plot.species %>%  -->
<!--       filter(LatinNames == i), -->
<!--     aes(x = CpueKGHR, -->
<!--       fill = as.factor(FishingZones))) +  -->
<!--     geom_histogram(bins = 20) + -->
<!--     theme_bw() + -->
<!--     theme(panel.background = element_rect(fill = "white", -->
<!--       colour = "grey50"), -->
<!--       legend.position = "none") + -->
<!--     labs(x = "CPUE (kgs/hr)", -->
<!--       y = "Count", -->
<!--       title = paste0("Histogram of ", i, " CPUE - all observations"), -->
<!--       subtitle = "Colour is used to represent the different fishing depths") + -->
<!--     facet_wrap(~FishingZones, -->
<!--       scales = "free", -->
<!--       ncol = 2) -->

<!--   print(Plots.5) -->
<!-- } -->
<!-- ``` -->



<!--chapter:end:03-part3.Rmd-->

# Seabob Models

## CPUE across all fishing tows

### Subsetting and plotting data

```{r 41, fig.cap = "Distribution of seabob cpue across fishing tows"}

target.catch <- SummaryTable %>% 
  filter(CatchCategory == "Target catch")

target.catch %>% 
  ggplot() + 
  geom_histogram(mapping = aes(x = CpueKGHr)) +
  labs(x = "Seabob CPUE (kgs/hr)") +
  theme_bw()

# Converting variables to factors
factor.var <- c("Company",
  "Month",
  "TimePeriods",
  "FishingZones",
  "FishingDepthMtr")

target.catch[,factor.var] <- lapply(target.catch[,factor.var], factor)

glimpse(target.catch)
```

### Predictor = 1 

```{r 4.2}
seabob.glm.1 <- glm(CpueKGHr ~ Company,
  family = gaussian(link = "log"), 
  data = target.catch)

# Print summary
summary(seabob.glm.1)

anova(seabob.glm.1)
```

### Predictors = 2

```{r 4.3}
seabob.glm.2 <- glm(CpueKGHr ~ Company +
    TimePeriods,
  family = gaussian(link = "log"),
  data = target.catch)

# Print summary
summary(seabob.glm.2)
```

### Predictors = 3

```{r 4.4}
seabob.glm.3 <- glm(CpueKGHr ~ Company +
    TimePeriods +
    Month,
  family = gaussian(link = "log"),
  data = target.catch)

# Print summary
summary(seabob.glm.3)
```

### Predictors = 4

```{r 4.5}
seabob.glm.4 <- glm(CpueKGHr ~ Company +
    TimePeriods + 
    Month + 
    FishingZones,
  family = gaussian(link = "log"),
  data = target.catch,
  na.action = na.exclude)

# Print summary
summary(seabob.glm.4)
```

### Predictors = 5

```{r 4.6}
seabob.glm.5 <- glm(CpueKGHr ~ Company +
    TimePeriods + 
    Month + 
    FishingZones +
    FishingDepthMtr,
  family = gaussian(link = "log"),
  data = target.catch)

# Print summary
summary(seabob.glm.5)
```

### Interaction terms = 1

```{r 4.7}
seabob.glm.6 <- glm(CpueKGHr ~ Company +
    TimePeriods +
    Company*TimePeriods,
  family = gaussian(link = "log"), 
  data = target.catch)

# Print summary
summary(seabob.glm.6)
```

### Interaction terms = 2

```{r 4.8}
seabob.glm.7 <- glm(CpueKGHr ~ Company +
    TimePeriods +
    Month +
    Company*TimePeriods +
    Company*Month,
  family = gaussian(link = "log"), 
  data = target.catch)

# Print summary
summary(seabob.glm.7)
```

### Interaction terms = 3

```{r 4.9}
seabob.glm.8 <- glm(CpueKGHr ~ Company +
    TimePeriods +
    Month +
    Company*TimePeriods +
    Company*Month +
    TimePeriods*Month,
  family = gaussian(link = "log"), 
  data = target.catch)

# Print summary
summary(seabob.glm.8)
```

### Interaction terms = 4

```{r 4.10}
seabob.glm.9 <- glm(CpueKGHr ~ Company +
    TimePeriods +
    Month +
    FishingZones +
    Company*TimePeriods +
    Company*Month +
    Company*FishingZones +
    TimePeriods*Month,
  family = gaussian(link = "log"), 
  data = target.catch)

# Print summary
summary(seabob.glm.9)
```

### Interaction terms = 5

```{r 4.11}
seabob.glm.10 <- glm(CpueKGHr ~ Company +
    TimePeriods +
    Month +
    FishingZones +
    Company*TimePeriods +
    Company*Month +
    Company*FishingZones +
    TimePeriods*Month +
    TimePeriods*FishingZones,
  family = gaussian(link = "log"), 
  data = target.catch)

# Print summary
summary(seabob.glm.10)
```

### Interaction terms = 6

```{r 4.12}
seabob.glm.11 <- glm(CpueKGHr ~ Company +
    TimePeriods +
    Month +
    FishingZones +
    Company*TimePeriods +
    Company*Month +
    Company*FishingZones +
    TimePeriods*Month +
    TimePeriods*FishingZones +
    Month*FishingZones,
  family = gaussian(link = "log"), 
  data = target.catch)

# Print summary
summary(seabob.glm.11)
```

### Interaction terms = 7

```{r 4.13}
seabob.glm.12 <- glm(CpueKGHr ~ Company +
    TimePeriods +
    Month +
    FishingZones +
    FishingDepthMtr +
    Company*TimePeriods +
    Company*Month +
    Company*FishingZones +
    Company*FishingDepthMtr +
    TimePeriods*Month +
    TimePeriods*FishingZones +
    TimePeriods*FishingDepthMtr,
  family = gaussian(link = "log"), 
  data = target.catch)

# Print summary
summary(seabob.glm.12)
```

### Interaction terms = 8

```{r 4.14}
seabob.glm.13 <- glm(CpueKGHr ~ Company +
    TimePeriods +
    Month +
    FishingZones +
    FishingDepthMtr +
    Company*TimePeriods +
    Company*Month +
    Company*FishingZones +
    Company*FishingDepthMtr +
    TimePeriods*Month +
    TimePeriods*FishingZones +
    TimePeriods*FishingDepthMtr +
    Month*FishingZones,
  family = gaussian(link = "log"), 
  data = target.catch)

# Print summary
summary(seabob.glm.13)
```

### Interaction terms = 9

```{r 4.15}
seabob.glm.14 <- glm(CpueKGHr ~ Company +
    TimePeriods +
    Month +
    FishingZones +
    FishingDepthMtr +
    Company*TimePeriods +
    Company*Month +
    Company*FishingZones +
    Company*FishingDepthMtr +
    TimePeriods*Month +
    TimePeriods*FishingZones +
    TimePeriods*FishingDepthMtr +
    Month*FishingZones +
    Month*FishingDepthMtr,
  family = gaussian(link = "log"), 
  data = target.catch)

# Print summary
summary(seabob.glm.14)
```

### Interaction terms = 10

```{r 4.16}
seabob.glm.15 <- glm(CpueKGHr ~ Company +
    TimePeriods +
    Month +
    FishingZones +
    FishingDepthMtr +
    Company*TimePeriods +
    Company*Month +
    Company*FishingZones +
    Company*FishingDepthMtr +
    TimePeriods*Month +
    TimePeriods*FishingZones +
    TimePeriods*FishingDepthMtr +
    Month*FishingZones +
    Month*FishingDepthMtr +
    FishingZones*FishingDepthMtr,
  family = gaussian(link = "log"), 
  data = target.catch)

# Print summary
summary(seabob.glm.15)
```

## Model Comparison

```{r 4.17}
rcompanion::compareGLM(seabob.glm.1,
  seabob.glm.2,
  seabob.glm.3,
  seabob.glm.4,
  seabob.glm.5,
  seabob.glm.6,
  seabob.glm.7,
  seabob.glm.8,
  seabob.glm.9,
  seabob.glm.10,
  seabob.glm.11,
  seabob.glm.12,
  seabob.glm.13,
  seabob.glm.14,
  seabob.glm.15) 
```


## Weight proportions across all fishing tows

### Subsetting and plotting data

```{r 4.18, fig.cap = "Distribution of weight proportions across fishing tows"}

target.catch <- SummaryTable %>% 
  filter(CatchCategory == "Target catch")

target.catch %>% 
  ggplot() + 
  geom_histogram(mapping = aes(x = PropWeight)) +
  labs(x = "Weight proportions (kgs)") +
  theme_bw()

# Converting variables to factors
factor.var <- c("Company",
  "Month",
  "TimePeriods",
  "FishingZones",
  "FishingDepthMtr")

target.catch[,factor.var] <- lapply(target.catch[,factor.var], factor)

glimpse(target.catch)
```

### Predictor = 1 

```{r 4.19}
seabob.glm.1 <- glm(PropWeight ~ Company,
  family = gaussian(link = "log"), 
  data = target.catch)

# Print summary
summary(seabob.glm.1)
```

### Predictors = 2

```{r 4.20}
seabob.glm.2 <- glm(PropWeight ~ Company +
    TimePeriods,
  family = gaussian(link = "log"),
  data = target.catch)

# Print summary
summary(seabob.glm.2)
```

### Predictors = 3

```{r 4.21}
seabob.glm.3 <- glm(PropWeight ~ Company +
    TimePeriods +
    Month,
  family = gaussian(link = "log"),
  data = target.catch)

# Print summary
summary(seabob.glm.3)
```

### Predictors = 4

```{r 4.22}
seabob.glm.4 <- glm(PropWeight ~ Company +
    TimePeriods + 
    Month + 
    FishingZones,
  family = gaussian(link = "log"),
  data = target.catch,
  na.action = na.exclude)

# Print summary
summary(seabob.glm.4)
```

### Predictors = 5

```{r 4.23}
seabob.glm.5 <- glm(PropWeight ~ Company +
    TimePeriods + 
    Month + 
    FishingZones +
    FishingDepthMtr,
  family = gaussian(link = "log"),
  data = target.catch)

# Print summary
summary(seabob.glm.5)
```

### Interaction terms = 1

```{r 4.24}
seabob.glm.6 <- glm(PropWeight ~ Company +
    TimePeriods +
    Company*TimePeriods,
  family = gaussian(link = "log"), 
  data = target.catch)

# Print summary
summary(seabob.glm.6)
```

### Interaction terms = 2

```{r 4.25}
seabob.glm.7 <- glm(PropWeight ~ Company +
    TimePeriods +
    Month +
    Company*TimePeriods +
    Company*Month,
  family = gaussian(link = "log"), 
  data = target.catch)

# Print summary
summary(seabob.glm.7)
```

### Interaction terms = 3

```{r 4.26}
seabob.glm.8 <- glm(PropWeight ~ Company +
    TimePeriods +
    Month +
    Company*TimePeriods +
    Company*Month +
    TimePeriods*Month,
  family = gaussian(link = "log"), 
  data = target.catch)

# Print summary
summary(seabob.glm.8)
```

### Interaction terms = 4

```{r 4.27}
seabob.glm.9 <- glm(PropWeight ~ Company +
    TimePeriods +
    Month +
    FishingZones +
    Company*TimePeriods +
    Company*Month +
    Company*FishingZones +
    TimePeriods*Month,
  family = gaussian(link = "log"), 
  data = target.catch)

# Print summary
summary(seabob.glm.9)
```

### Interaction terms = 5

```{r 4.28}
seabob.glm.10 <- glm(PropWeight ~ Company +
    TimePeriods +
    Month +
    FishingZones +
    Company*TimePeriods +
    Company*Month +
    Company*FishingZones +
    TimePeriods*Month +
    TimePeriods*FishingZones,
  family = gaussian(link = "log"), 
  data = target.catch)

# Print summary
summary(seabob.glm.10)
```

### Interaction terms = 6

```{r 4.29}
seabob.glm.11 <- glm(PropWeight ~ Company +
    TimePeriods +
    Month +
    FishingZones +
    Company*TimePeriods +
    Company*Month +
    Company*FishingZones +
    TimePeriods*Month +
    TimePeriods*FishingZones +
    Month*FishingZones,
  family = gaussian(link = "log"), 
  data = target.catch)

# Print summary
summary(seabob.glm.11)
```

### Interaction terms = 7

```{r 4.30}
seabob.glm.12 <- glm(PropWeight ~ Company +
    TimePeriods +
    Month +
    FishingZones +
    FishingDepthMtr +
    Company*TimePeriods +
    Company*Month +
    Company*FishingZones +
    Company*FishingDepthMtr +
    TimePeriods*Month +
    TimePeriods*FishingZones +
    TimePeriods*FishingDepthMtr,
  family = gaussian(link = "log"), 
  data = target.catch)

# Print summary
summary(seabob.glm.12)
```

### Interaction terms = 8

```{r 4.31}
seabob.glm.13 <- glm(PropWeight ~ Company +
    TimePeriods +
    Month +
    FishingZones +
    FishingDepthMtr +
    Company*TimePeriods +
    Company*Month +
    Company*FishingZones +
    Company*FishingDepthMtr +
    TimePeriods*Month +
    TimePeriods*FishingZones +
    TimePeriods*FishingDepthMtr +
    Month*FishingZones,
  family = gaussian(link = "log"), 
  data = target.catch)

# Print summary
summary(seabob.glm.13)
```

### Interaction terms = 9

```{r 4.32}
seabob.glm.14 <- glm(PropWeight ~ Company +
    TimePeriods +
    Month +
    FishingZones +
    FishingDepthMtr +
    Company*TimePeriods +
    Company*Month +
    Company*FishingZones +
    Company*FishingDepthMtr +
    TimePeriods*Month +
    TimePeriods*FishingZones +
    TimePeriods*FishingDepthMtr +
    Month*FishingZones +
    Month*FishingDepthMtr,
  family = gaussian(link = "log"), 
  data = target.catch)

# Print summary
summary(seabob.glm.14)
```

### Interaction terms = 10

```{r 4.33}
seabob.glm.15 <- glm(PropWeight ~ Company +
    TimePeriods +
    Month +
    FishingZones +
    FishingDepthMtr +
    Company*TimePeriods +
    Company*Month +
    Company*FishingZones +
    Company*FishingDepthMtr +
    TimePeriods*Month +
    TimePeriods*FishingZones +
    TimePeriods*FishingDepthMtr +
    Month*FishingZones +
    Month*FishingDepthMtr +
    FishingZones*FishingDepthMtr,
  family = gaussian(link = "log"), 
  data = target.catch)

# Print summary
summary(seabob.glm.15)
```

## Model Comparison

```{r 4.34}
rcompanion::compareGLM(seabob.glm.1,
  seabob.glm.2,
  seabob.glm.3,
  seabob.glm.4,
  seabob.glm.5,
  seabob.glm.6,
  seabob.glm.7,
  seabob.glm.8,
  seabob.glm.9,
  seabob.glm.10,
  seabob.glm.11,
  seabob.glm.12,
  seabob.glm.13,
  seabob.glm.14,
  seabob.glm.15) 
```

<!--chapter:end:04-part4.Rmd-->

# Seabob Models - Best Models

## CPUE 

### Data modifications

```{r 5.1}
target.catch.cpue <- SummaryTable %>% 
  ungroup() %>%
  # mutate(Company.bv = case_when(Company == "PSI" ~ 1,
  #   Company == "NHS" ~ 0),
  #   TimePeriods.bv = case_when(TimePeriods == "Day" ~ 1,
  #   TimePeriods == "Night" ~ 0)) %>% 
  filter(CatchCategory == "Target catch") %>% 
  dplyr::select(Company,
  Month,
  TimePeriods,
  FishingZones,
  FishingDepthMtr,
  CpueKGHr)

# Converting variables to factors
factor.var <- c("Company",
  "Month",
  "TimePeriods",
  "FishingZones")

target.catch.cpue[,factor.var] <- lapply(target.catch.cpue[,factor.var], factor)

# Removing fishing zones 2 and 5

drop.zones <- c(2, 5)
target.catch.cpue.2 <- target.catch.cpue %>% 
  filter(!FishingZones %in% drop.zones)
```

### Qucik glance at response variable

```{r 5.2}
# Table
table(target.catch.cpue$CpueKGHr) 

# Histogram
hist(target.catch.cpue$CpueKGHr)
```

#### 2 Predictors

```{r 5.3}
cpue.model.1 <- glm(CpueKGHr ~ Month +
    TimePeriods,
  family = gaussian(link = "log"),
  data = target.catch.cpue)
# Print summary
summary(cpue.model.1)
```

#### 2 Predictors with 1 interaction term

```{r 5.4}
cpue.model.2 <- glm(CpueKGHr ~ Month +
    TimePeriods +
    Month*TimePeriods,
  family = gaussian(link = "log"),
  data = target.catch.cpue)

# Print summary
summary(cpue.model.2)
```

#### 3 Predictors

```{r 5.5}
cpue.model.3 <- glm(CpueKGHr ~ TimePeriods +
    FishingDepthMtr +
    FishingZones,
  family = gaussian(link = "log"),
  data = target.catch.cpue.2)

# Print summary
summary(cpue.model.3)
```

#### 3 Predictors and 1 interaction term

```{r 5.6}
cpue.model.4 <- glm(CpueKGHr ~ FishingDepthMtr +
  FishingZones +
  TimePeriods +
  TimePeriods*FishingZones, # Yields a low AIC
  family = gaussian(link = "log"),
  data = target.catch.cpue.2)

# Print summary
summary(cpue.model.4)
```

#### 3 Predictors with 2 interaction term

```{r 5.7}
cpue.model.5 <- glm(CpueKGHr ~ Month +
    TimePeriods +
    FishingDepthMtr +
    Month*TimePeriods +
    FishingDepthMtr*TimePeriods, 
    # FishingDepthMtr*Month, Gives some NA values
  family = gaussian(link = "log"),
  data = target.catch.cpue)

# Print summary
summary(cpue.model.5)
```

#### 3 Predictors with 1 interaction term - Dropping Month*TimePeriods

```{r 5.8}
cpue.model.5 <- glm(CpueKGHr ~ Month +
    TimePeriods +
    FishingDepthMtr +
    # Month*TimePeriods +
    FishingDepthMtr*TimePeriods, 
    # FishingDepthMtr*Month, Gives some NA values
  family = gaussian(link = "log"),
  data = target.catch.cpue)

# Print summary
summary(cpue.model.5)
```

```{r Prof Paulson, echo = FALSE}

# cpue.model.f.5.b <- aov(CpueKGHR ~ Month + TimePeriods + as.factor(FishingZones) + FishingDepthMtr + 
#       Month:TimePeriods + Month:FishingDepthMtr + TimePeriods:as.factor(FishingZones) + 
#       TimePeriods:FishingDepthMtr,
#    data = species.1)
# 
# cpue.model.f.5.a <- aov(log(CpueKGHR)  ~ Month + TimePeriods + FishingZones + FishingDepthMtr + 
#       Month:TimePeriods + Month:FishingDepthMtr + TimePeriods:FishingZones + 
#       TimePeriods:FishingDepthMtr,
#    data = species.1)
# 
# cpue.model.f.5.c <- lm(log(CpueKGHR)  ~ Month + TimePeriods + FishingZones + FishingDepthMtr + 
#       Month:TimePeriods + Month:FishingDepthMtr + TimePeriods:FishingZones + 
#       TimePeriods:FishingDepthMtr,
#    data = species.1)
# 
# plot(cpue.model.f.5.a)
# plot(cpue.model.f.5.b)
# plot(cpue.model.f.5.c)
# # Print summary
# summary.aov(cpue.model.f.5.a)
# summary.aov(cpue.model.f.5.b)
# summary(cpue.model.f.5.c)
# summary(cpue.model.f.5.b)
# 
# table(species.1$FishingZones,species.1$TimePeriods)
# 
# sapply(species.1,data.class)
```

### Model Comparison

```{r 5.8.1}
rcompanion::compareGLM(cpue.model.1,
  cpue.model.2,
  cpue.model.3,
  cpue.model.4,
  cpue.model.5) 
```

## Weight prop. 

### Data modifications

```{r 5.9}
target.catch.prop <- SummaryTable %>% 
  ungroup() %>%
  filter(CatchCategory == "Target catch") %>% 
  dplyr::select(Company,
  FishingDepthMtr,
  FishingZones,
  Month,
  TimePeriods,
  PropWeight)

# Converting variables to factors
factor.var <- c("Company",
  "Month",
  "TimePeriods",
  "FishingZones")

target.catch.prop[,factor.var] <- lapply(target.catch.prop[,factor.var], factor)

# Removing fishing zones 2 and 5
drop.zones <- c(2, 5)
target.catch.prop.2 <- target.catch.prop %>% 
  filter(!FishingZones %in% drop.zones)
```

### Qucik glance at response variable

```{r 5.10}
# Table
table(target.catch.prop$PropWeight) 

# Histogram
hist(target.catch.prop$PropWeight)
```

#### 2 Predictors

```{r 5.11}
prop.model.1 <- glm(PropWeight ~ Month +
    TimePeriods,
  family = gaussian,
  data = target.catch.prop)

# Print summary
summary(prop.model.1)
```

#### 2 Predictors with 1 interaction term

```{r 5.12}
prop.model.2 <- glm(PropWeight ~ Month +
    TimePeriods +
    Month*TimePeriods,
  family = gaussian,
  data = target.catch.prop)

# Print summary
summary(prop.model.2)
```

#### 3 Predictors

```{r 5.13}
prop.model.3 <- glm(PropWeight ~ Month +
    TimePeriods +
    FishingDepthMtr,
  family = gaussian,
  data = target.catch.prop)

# Print summary
summary(prop.model.3)
```

#### 3 Predictors

```{r 5.14}
prop.model.4 <- glm(PropWeight ~ Month +
    FishingDepthMtr +
    FishingZones,
    # TimePeriods, Adding time of day does not influence significance. 
    # Adding Months results in NA values
  family = gaussian,
  data = target.catch.prop.2)

# Print summary
summary(prop.model.4)
```

#### 3 Predictors and 1 interaction term

```{r 5.15}
prop.model.5 <- glm(PropWeight ~ TimePeriods +
  Month +
  FishingDepthMtr + # Increase significance values
  TimePeriods*Month, 
  family = gaussian,
  data = target.catch.prop)

# Print summary
summary(prop.model.5)
```

#### 3 Predictors with 2 interaction term

```{r 5.16}
prop.model.6 <- glm(PropWeight ~ Month +
    TimePeriods +
    FishingDepthMtr +
    Month*TimePeriods +
    FishingDepthMtr*TimePeriods, # Adding fishing zones yields NA values
  family = gaussian,
  data = target.catch.prop)

# Print summary
summary(prop.model.6)
```

### Model Comparison

```{r 5.17}
rcompanion::compareGLM(prop.model.1,
  prop.model.2,
  prop.model.3,
  prop.model.4,
  prop.model.5,
  prop.model.6) 
```



<!--chapter:end:05-part5.Rmd-->

#  Best CPUE Models - Top 10 Bycatch Species

## Data Modifications 

```{r 6.1}
# Names to remove 
Remove <- c("Multiple species finfish", "Multiple species prawns", "Xiphopenaeus kroyeri")

# Data
Top10Species <- ObserverData %>% 
  group_by(LatinNames, CommonName) %>% 
  dplyr::summarise(NoSampled = n(),
    .groups = 'drop') %>%
  filter(NoSampled >= 10) %>%
  filter(!LatinNames %in% Remove) %>%
  arrange(desc(NoSampled)) %>% 
  head(10)

# Creating a vector of names
Top10names <- Top10Species$LatinNames


# Filtering data to keep species
FilteredSpecies <- ObserverData %>% 
  filter(LatinNames %in% Top10names) %>% 
  group_by(DragID2) %>%  
  mutate(PropWeight = CpueKGHR/sum(CpueKGHR)) %>% 
  ungroup() %>% 
  dplyr::select(LatinNames,
    DragID2,
    CpueKGHR,
    Company,
    Month,
    TimePeriods,
    FishingZones,
    FishingDepthMtr)

# Converting variables to factors
factor.var <- c("Company",
  "Month",
  "TimePeriods",
  "FishingZones")

FilteredSpecies[,factor.var] <- lapply(FilteredSpecies[,factor.var], factor)

# Removing fishing zones 2 and 5
drop.zones <- c(2, 5)
FilteredSpecies <- FilteredSpecies %>% 
  filter(!FishingZones %in% drop.zones) %>% 
  droplevels()
```

## CPUE Model Selection

### Macrodon ancylodon

```{r 6.2}
species.1 <- FilteredSpecies %>% 
  filter(LatinNames == Top10names[1]) %>% 
  # select(-DragID2) %>% 
  dplyr::select(-LatinNames)

# Histogram
hist(species.1$CpueKGHR, breaks = 10)

# Running models
# 2 Predictors
ma.an.1 <- glm(CpueKGHR ~ Month +
    TimePeriods,
  family = gaussian(link = "log"),
  data = species.1)

summary(ma.an.1) # print summary

# 2 Predictors with 1 interaction term
ma.an.2 <- glm(CpueKGHR ~ Month +
    TimePeriods +
    Month*TimePeriods,
  family = gaussian(link = "log"),
  data = species.1)

summary(ma.an.2) # print summary

# 3 Predictors
ma.an.3 <- glm(CpueKGHR ~ TimePeriods +
    FishingDepthMtr +
    FishingZones,
  family = gaussian(link = "log"),
  data = species.1)

summary(ma.an.3) # print summary

# 3 Predictors and 1 interaction term
ma.an.4 <- glm(CpueKGHR ~ FishingDepthMtr +
  FishingZones +
  TimePeriods +
  TimePeriods*FishingZones, # Yields a low AIC
  family = gaussian(link = "log"),
  data = species.1)

summary(ma.an.4) # print summary

# 3 Predictors with 2 interaction term
ma.an.5 <- glm(CpueKGHR ~ Month +
    TimePeriods +
    FishingDepthMtr +
    Month*TimePeriods +
    FishingDepthMtr*TimePeriods, 
    # FishingDepthMtr*Month, Gives some NA values
  family = gaussian(link = "log"),
  data = species.1)

summary(ma.an.5) # print summary

# 2 Predictors
ma.an.1.log <- glm(log(CpueKGHR) ~ Month +
    TimePeriods,
  family = gaussian,
  data = species.1)

summary(ma.an.1.log) # print summary

# 2 Predictors with 1 interaction term
ma.an.2.log <- glm(log(CpueKGHR) ~ Month +
    TimePeriods +
    Month*TimePeriods,
  family = gaussian,
  data = species.1)

summary(ma.an.2.log) # print summary

# 3 Predictors
ma.an.3.log <- glm(log(CpueKGHR) ~ TimePeriods +
    FishingDepthMtr +
    FishingZones,
  family = gaussian,
  data = species.1)

summary(ma.an.3.log) # print summary

# 3 Predictors and 1 interaction term
ma.an.4.log <- glm(log(CpueKGHR) ~ FishingDepthMtr +
  FishingZones +
  TimePeriods +
  TimePeriods*FishingZones, # Yields a low AIC
  family = gaussian,
  data = species.1)

summary(ma.an.4.log) # print summary

# 3 Predictors with 2 interaction term
ma.an.5.log <- glm(log(CpueKGHR) ~ Month +
    TimePeriods +
    FishingDepthMtr +
    Month*TimePeriods +
    FishingDepthMtr*TimePeriods, 
    # FishingDepthMtr*Month, Gives some NA values
  family = gaussian,
  data = species.1)

summary(ma.an.5.log)

# interaction.plot(species.1$Month, species.1$TimePeriods, species.1$CpueKGHR)
```

#### Model Comparison

```{r 6.3}
rcompanion::compareGLM(ma.an.1,
  ma.an.2,
  ma.an.3,
  ma.an.4,
  ma.an.5,
  ma.an.1.log,
  ma.an.2.log,
  ma.an.3.log,
  ma.an.4.log,
  ma.an.5.log)

# Best model = 6
```

### Callinectes ornatus

```{r 6.4}
species.2 <- FilteredSpecies %>% 
  filter(LatinNames == Top10names[2]) %>% 
  dplyr::select(-LatinNames)

# Histogram
hist(species.2$CpueKGHR, breaks = 10)

# Running models
# 2 Predictors
ca.or.1 <- glm(CpueKGHR ~ Month +
    TimePeriods,
  family = gaussian(link = "log"),
  data = species.2)

summary(ca.or.1) # print summary

# 2 Predictors with 1 interaction term
ca.or.2 <- glm(CpueKGHR ~ Month +
    TimePeriods +
    Month*TimePeriods,
  family = gaussian(link = "log"),
  data = species.2)

summary(ca.or.2) # print summary

# 3 Predictors
ca.or.3 <- glm(CpueKGHR ~ TimePeriods +
    FishingDepthMtr +
    FishingZones,
  family = gaussian(link = "log"),
  data = species.2)

summary(ca.or.3) # print summary

# 3 Predictors and 1 interaction term
ca.or.4 <- glm(CpueKGHR ~ FishingDepthMtr +
  FishingZones +
  TimePeriods +
  TimePeriods*FishingZones, # Yields a low AIC
  family = gaussian(link = "log"),
  data = species.2)

summary(ca.or.4) # print summary

# 3 Predictors with 2 interaction term
ca.or.5 <- glm(CpueKGHR ~ Month +
    TimePeriods +
    FishingDepthMtr +
    Month*TimePeriods +
    FishingDepthMtr*TimePeriods, 
    # FishingDepthMtr*Month, Gives some NA values
  family = gaussian(link = "log"),
  data = species.2)

summary(ca.or.5) # print summary

# 2 Predictors
ca.or.1.log <- glm(log(CpueKGHR) ~ Month +
    TimePeriods,
  family = gaussian,
  data = species.2)

summary(ca.or.1.log) # print summary

# 2 Predictors with 1 interaction term
ca.or.2.log <- glm(log(CpueKGHR) ~ Month +
    TimePeriods +
    Month*TimePeriods,
  family = gaussian,
  data = species.2)

summary(ca.or.2.log) # print summary

# 3 Predictors
ca.or.3.log <- glm(log(CpueKGHR) ~ TimePeriods +
    FishingDepthMtr +
    FishingZones,
  family = gaussian,
  data = species.2)

summary(ca.or.3.log) # print summary

# 3 Predictors and 1 interaction term
ca.or.4.log <- glm(log(CpueKGHR) ~ FishingDepthMtr +
  FishingZones +
  TimePeriods +
  TimePeriods*FishingZones, # Yields a low AIC
  family = gaussian,
  data = species.2)

summary(ca.or.4.log) # print summary

# 3 Predictors with 2 interaction term
ca.or.5.log <- glm(log(CpueKGHR) ~ Month +
    TimePeriods +
    FishingDepthMtr +
    Month*TimePeriods +
    FishingDepthMtr*TimePeriods, 
    # FishingDepthMtr*Month, Gives some NA values
  family = gaussian,
  data = species.2)

summary(ca.or.5.log) # print summary
```

#### Model Comparison

```{r 6.5}
rcompanion::compareGLM(ca.or.1,
  ca.or.2,
  ca.or.3,
  ca.or.4,
  ca.or.5,
  ca.or.1.log,
  ca.or.2.log,
  ca.or.3.log,
  ca.or.4.log,
  ca.or.5.log) 

# Best model = 8
```

### Stellifer rastrifer

```{r 6.6}
species.3 <- FilteredSpecies %>% 
  filter(LatinNames == Top10names[3]) %>% 
  dplyr::select(-LatinNames)

# Histogram
hist(species.3$CpueKGHR, breaks = 10)

# Running models
# 2 Predictors
st.ra.1 <- glm(CpueKGHR ~ Month +
    TimePeriods,
  family = gaussian(link = "log"),
  data = species.3)

summary(st.ra.1) # print summary

# 2 Predictors with 1 interaction term
st.ra.2 <- glm(CpueKGHR ~ Month +
    TimePeriods +
    Month*TimePeriods,
  family = gaussian(link = "log"),
  data = species.3)

summary(st.ra.2) # print summary

# 3 Predictors
st.ra.3 <- glm(CpueKGHR ~ TimePeriods +
    FishingDepthMtr +
    FishingZones,
  family = gaussian(link = "log"),
  data = species.3)

summary(st.ra.3) # print summary

# 3 Predictors and 1 interaction term
st.ra.4 <- glm(CpueKGHR ~ FishingDepthMtr +
  FishingZones +
  TimePeriods +
  TimePeriods*FishingZones, # Yields a low AIC
  family = gaussian(link = "log"),
  data = species.3)

summary(st.ra.4) # print summary

# 3 Predictors with 2 interaction term
st.ra.5 <- glm(CpueKGHR ~ Month +
    TimePeriods +
    FishingDepthMtr +
    Month*TimePeriods +
    FishingDepthMtr*TimePeriods, 
    # FishingDepthMtr*Month, Gives some NA values
  family = gaussian(link = "log"),
  data = species.3)

summary(st.ra.5) # print summary
```

#### Model Comparison

```{r 6.7}
rcompanion::compareGLM(st.ra.1,
  st.ra.2,
  st.ra.3,
  st.ra.4,
  st.ra.5) 

# Best model = 4
```

### Stellifer microps

```{r 6.8}
species.4 <- FilteredSpecies %>% 
  filter(LatinNames == Top10names[4]) %>% 
  dplyr::select(-LatinNames)

species.4 <- rbind(species.4, species.1[c(17,41,45),]) # Copying row from species.one
species.4[c(43,44,45),2] = 0.01 # changing value to '0'
species.4 <- species.4 %>% 
  arrange(DragID2) %>% 
  dplyr::select(-DragID2)

# Histogram
hist(species.4$CpueKGHR, breaks = 10)

# Running models
# 2 Predictors
st.mi.1 <- glm(CpueKGHR ~ Month +
    TimePeriods,
  family = gaussian(link = "log"),
  data = species.4)

summary(st.mi.1) # print summary

# 2 Predictors with 1 interaction term
st.mi.2 <- glm(CpueKGHR ~ Month +
    TimePeriods +
    Month*TimePeriods,
  family = gaussian(link = "log"),
  data = species.4)

summary(st.mi.2) # print summary

# 3 Predictors
st.mi.3 <- glm(CpueKGHR ~ TimePeriods +
    FishingDepthMtr +
    FishingZones,
  family = gaussian(link = "log"),
  data = species.4)

summary(st.mi.3) # print summary

# 3 Predictors and 1 interaction term
st.mi.4 <- glm(CpueKGHR ~ FishingDepthMtr +
  FishingZones +
  TimePeriods +
  TimePeriods*FishingZones, # Yields a low AIC
  family = gaussian(link = "log"),
  data = species.4)

summary(st.mi.4) # print summary

# 3 Predictors with 2 interaction term
st.mi.5 <- glm(CpueKGHR ~ Month +
    TimePeriods +
    FishingDepthMtr +
    Month*TimePeriods +
    FishingDepthMtr*TimePeriods, 
    # FishingDepthMtr*Month, Gives some NA values
  family = gaussian(link = "log"),
  data = species.4)

summary(st.mi.5) # print summary
```

#### Model Comparison

```{r 6.9}
rcompanion::compareGLM(st.mi.1,
  st.mi.2,
  st.mi.3,
  st.mi.4,
  st.mi.5) 

# Best model = 1
```

### Cynoscion virescens

```{r 6.10}
species.5 <- FilteredSpecies %>% 
  filter(LatinNames == Top10names[5]) %>% 
  dplyr::select(-LatinNames)

species.5 <- rbind(species.5, species.1[c(17,21,22,23),]) # Copying row from species.one
species.5[c(42,43,44,45),2] = 0.01 # changing value to '0'
species.5 <- species.5 %>% 
  arrange(DragID2) %>% 
  dplyr::select(-DragID2)

# Histogram
hist(species.5$CpueKGHR, breaks = 10)

# Running models
# 2 Predictors
cy.vi.1 <- glm(CpueKGHR ~ Month +
    TimePeriods,
  family = gaussian(link = "log"),
  data = species.5)

summary(cy.vi.1) # print summary

# 2 Predictors with 1 interaction term
cy.vi.2 <- glm(CpueKGHR ~ Month +
    TimePeriods +
    Month*TimePeriods,
  family = gaussian(link = "log"),
  data = species.5)

summary(cy.vi.2) # print summary

# 3 Predictors
cy.vi.3 <- glm(CpueKGHR ~ TimePeriods +
    FishingDepthMtr +
    FishingZones,
  family = gaussian(link = "log"),
  data = species.5)

summary(cy.vi.3) # print summary

# 3 Predictors and 1 interaction term
cy.vi.4 <- glm(CpueKGHR ~ FishingDepthMtr +
  FishingZones +
  TimePeriods +
  TimePeriods*FishingZones, # Yields a low AIC
  family = gaussian(link = "log"),
  data = species.5)

summary(cy.vi.4) # print summary

# 3 Predictors with 2 interaction term
cy.vi.5 <- glm(CpueKGHR ~ Month +
    TimePeriods +
    FishingDepthMtr +
    Month*TimePeriods +
    FishingDepthMtr*TimePeriods, 
    # FishingDepthMtr*Month, Gives some NA values
  family = gaussian(link = "log"),
  data = species.5)

summary(cy.vi.5) # print summary
```

#### Model Comparison

```{r 6.11}
rcompanion::compareGLM(cy.vi.1,
  cy.vi.2,
  cy.vi.3,
  cy.vi.4,
  cy.vi.5) 

# Best model = 3
```

### Symphurus plagusia

```{r 6.12}
species.6 <- FilteredSpecies %>% 
  filter(LatinNames == Top10names[6]) %>% 
  dplyr::select(-LatinNames)

species.6 <- rbind(species.6, species.1[c(7,10,18,21),]) # Copying row from species.one
species.6[c(42,43,44,45),2] = 0.01 # changing value to '0'
species.6 <- species.6 %>% 
  arrange(DragID2) %>% 
  dplyr::select(-DragID2)

# Histogram
hist(species.6$CpueKGHR, breaks = 10)

# Running models
# 2 Predictors
sy.pl.1 <- glm(CpueKGHR ~ Month +
    TimePeriods,
  family = gaussian(link = "log"),
  data = species.6)

summary(sy.pl.1) # print summary

# 2 Predictors with 1 interaction term
sy.pl.2 <- glm(CpueKGHR ~ Month +
    TimePeriods +
    Month*TimePeriods,
  family = gaussian(link = "log"),
  data = species.6)

summary(sy.pl.2) # print summary

# 3 Predictors
sy.pl.3 <- glm(CpueKGHR ~ TimePeriods +
    FishingDepthMtr +
    FishingZones,
  family = gaussian(link = "log"),
  data = species.6)

summary(sy.pl.3) # print summary

# 3 Predictors and 1 interaction term
sy.pl.4 <- glm(CpueKGHR ~ FishingDepthMtr +
  FishingZones +
  TimePeriods +
  TimePeriods*FishingZones, # Yields a low AIC
  family = gaussian(link = "log"),
  data = species.6)

summary(sy.pl.4) # print summary

# 3 Predictors with 2 interaction term
sy.pl.5 <- glm(CpueKGHR ~ Month +
    TimePeriods +
    FishingDepthMtr +
    Month*TimePeriods +
    FishingDepthMtr*TimePeriods, 
    # FishingDepthMtr*Month, Gives some NA values
  family = gaussian(link = "log"),
  data = species.6)

summary(sy.pl.5) # print summary
```

#### Model Comparison

```{r 6.13}
rcompanion::compareGLM(sy.pl.1,
  sy.pl.2,
  sy.pl.3,
  sy.pl.4,
  sy.pl.5) 

# Best model = 5
```

### Bagre bagre

```{r 6.14}
species.7 <- FilteredSpecies %>% 
  filter(LatinNames == Top10names[7]) %>% 
  dplyr::select(-LatinNames)

species.7 <- rbind(species.7, species.1[c(18,21,24,27,45),]) # Copying row from species.one
species.7[c(41,42,43,44,45),2] = 0.01 # changing value to '0'
species.7 <- species.7 %>% 
  arrange(DragID2) %>% 
  dplyr::select(-DragID2)

# Histogram
hist(species.7$CpueKGHR, breaks = 10)

# Running models
# 2 Predictors
ba.ba.1 <- glm(CpueKGHR ~ Month +
    TimePeriods,
  family = gaussian(link = "log"),
  data = species.7)

summary(ba.ba.1) # print summary

# 2 Predictors with 1 interaction term
ba.ba.2 <- glm(CpueKGHR ~ Month +
    TimePeriods +
    Month*TimePeriods,
  family = gaussian(link = "log"),
  data = species.7)

summary(ba.ba.2) # print summary

# 3 Predictors
ba.ba.3 <- glm(CpueKGHR ~ TimePeriods +
    FishingDepthMtr +
    FishingZones,
  family = gaussian(link = "log"),
  data = species.7)

summary(ba.ba.3) # print summary

# 3 Predictors and 1 interaction term
ba.ba.4 <- glm(CpueKGHR ~ FishingDepthMtr +
  FishingZones +
  TimePeriods +
  TimePeriods*FishingZones, # Yields a low AIC
  family = gaussian(link = "log"),
  data = species.7)

summary(ba.ba.4) # print summary

# 3 Predictors with 2 interaction term
ba.ba.5 <- glm(CpueKGHR ~ Month +
    TimePeriods +
    FishingDepthMtr +
    Month*TimePeriods +
    FishingDepthMtr*TimePeriods, 
    # FishingDepthMtr*Month, Gives some NA values
  family = gaussian(link = "log"),
  data = species.7)

summary(ba.ba.5) # print summary
```

#### Model Comparison

```{r 6.15}
rcompanion::compareGLM(ba.ba.1,
  ba.ba.2,
  ba.ba.3,
  ba.ba.4,
  ba.ba.5)

# Best model = 1
```

### Trichiurus lepturus

```{r 6.16}
species.8 <- FilteredSpecies %>% 
  filter(LatinNames == Top10names[8]) %>% 
  dplyr::select(-LatinNames)

species.8 <- rbind(species.8, species.1[c(6,7,35,37,41,45),]) # Copying row from species.one
species.8[c(40,41,42,43,44,45),2] = 0.01 # changing value to '0'
species.8 <- species.8 %>% 
  arrange(DragID2) %>% 
  dplyr::select(-DragID2)

# Histogram
hist(species.8$CpueKGHR, breaks = 10)

# Running models
# 2 Predictors
tr.le.1 <- glm(CpueKGHR ~ Month +
    TimePeriods,
  family = gaussian(link = "log"),
  data = species.8)

summary(tr.le.1) # print summary

# 2 Predictors with 1 interaction term
tr.le.2 <- glm(CpueKGHR ~ Month +
    TimePeriods +
    Month*TimePeriods,
  family = gaussian(link = "log"),
  data = species.8)

summary(tr.le.2) # print summary

# 3 Predictors
tr.le.3 <- glm(CpueKGHR ~ TimePeriods +
    FishingDepthMtr +
    FishingZones,
  family = gaussian(link = "log"),
  data = species.8)

summary(tr.le.3) # print summary

# 3 Predictors and 1 interaction term
tr.le.4 <- glm(CpueKGHR ~ FishingDepthMtr +
  FishingZones +
  TimePeriods +
  TimePeriods*FishingZones, # Yields a low AIC
  family = gaussian(link = "log"),
  data = species.8)

summary(tr.le.4) # print summary

# 3 Predictors with 2 interaction term
tr.le.5 <- glm(CpueKGHR ~ Month +
    TimePeriods +
    FishingDepthMtr +
    Month*TimePeriods +
    FishingDepthMtr*TimePeriods, 
    # FishingDepthMtr*Month, Gives some NA values
  family = gaussian(link = "log"),
  data = species.8)

summary(tr.le.5) # print summary
```

#### Model Comparison

```{r 6.17}
rcompanion::compareGLM(tr.le.1,
  tr.le.2,
  tr.le.3,
  tr.le.4,
  tr.le.5) 

# Best model = 1
```

### Achirus achirus

```{r 6.18}
species.9 <- FilteredSpecies %>% 
  filter(LatinNames == Top10names[9]) %>% 
  dplyr::select(-LatinNames)

species.9 <- rbind(species.9, species.1[c(10,11,13,15,18,21,24,25),]) # Copying row from species.one
species.9[c(38,39,40,41,42,43,44,45),2] = 0.01 # changing value to '0'
species.9 <- species.9 %>% 
  arrange(DragID2) %>% 
  dplyr::select(-DragID2)

# Histogram
hist(species.9$CpueKGHR, breaks = 10)

# Running models
# 2 Predictors
ac.ac.1 <- glm(CpueKGHR ~ Month +
    TimePeriods,
  family = gaussian(link = "log"),
  data = species.9)

summary(ac.ac.1) # print summary

# 2 Predictors with 1 interaction term
ac.ac.2 <- glm(CpueKGHR ~ Month +
    TimePeriods +
    Month*TimePeriods,
  family = gaussian(link = "log"),
  data = species.9)

summary(ac.ac.2) # print summary

# 3 Predictors
ac.ac.3 <- glm(CpueKGHR ~ TimePeriods +
    FishingDepthMtr +
    FishingZones,
  family = gaussian(link = "log"),
  data = species.9)

summary(ac.ac.3) # print summary

# 3 Predictors and 1 interaction term
ac.ac.4 <- glm(CpueKGHR ~ FishingDepthMtr +
  FishingZones +
  TimePeriods +
  TimePeriods*FishingZones, # Yields a low AIC
  family = gaussian(link = "log"),
  data = species.9)

summary(ac.ac.4) # print summary

# 3 Predictors with 2 interaction term
ac.ac.5 <- glm(CpueKGHR ~ Month +
    TimePeriods +
    FishingDepthMtr +
    Month*TimePeriods +
    FishingDepthMtr*TimePeriods, 
    # FishingDepthMtr*Month, Gives some NA values
  family = gaussian(link = "log"),
  data = species.9)

summary(ac.ac.5) # print summary
```

#### Model Comparison

```{r 6.19}
rcompanion::compareGLM(ac.ac.1,
  ac.ac.2,
  ac.ac.3,
  ac.ac.4,
  ac.ac.5) 

# Best model = 3
```

### Paralonchurus brasiliensis

```{r 6.20}
species.10 <- FilteredSpecies %>% 
  filter(LatinNames == Top10names[10]) %>% 
  dplyr::select(-LatinNames)

species.10 <- rbind(species.10, species.1[c(7,17,20,22,23,28,35,39,43,45),]) # Copying row from species.one
species.10[c(36,37,38,39,40,41,42,43,44,45),2] = 0.01 # changing value to '0'
species.10 <- species.10 %>% 
  arrange(DragID2) %>% 
  dplyr::select(-DragID2)

# Histogram
hist(species.10$CpueKGHR, breaks = 10)
 
# ## Manually check for mismatches
# dim(species.4)
# unique(species.1$DragID2) #######data have 45 rows rows 10, 28, 36
# 
# vec1 <- unique(species.1$DragID2)
# vec2 <- unique(species.10$DragID2)
# 
# vec1[!(vec1 %in% vec2)]

# Running models
# 2 Predictors
pa.br.1 <- glm(CpueKGHR ~ Month +
    TimePeriods,
  family = gaussian(link = "log"),
  data = species.10)

summary(pa.br.1) # print summary

# 2 Predictors with 1 interaction term
pa.br.2 <- glm(CpueKGHR ~ Month +
    TimePeriods +
    Month*TimePeriods,
  family = gaussian(link = "log"),
  data = species.10)

summary(pa.br.2) # print summary

# 3 Predictors
pa.br.3 <- glm(CpueKGHR ~ TimePeriods +
    FishingDepthMtr +
    FishingZones,
  family = gaussian(link = "log"),
  data = species.10)

summary(pa.br.3) # print summary

# 3 Predictors and 1 interaction term
pa.br.4 <- glm(CpueKGHR ~ FishingDepthMtr +
  FishingZones +
  TimePeriods +
  TimePeriods*FishingZones, # Yields a low AIC
  family = gaussian(link = "log"),
  data = species.10)

summary(pa.br.4) # print summary

# 3 Predictors with 2 interaction term
pa.br.5 <- glm(CpueKGHR ~ Month +
    TimePeriods +
    FishingDepthMtr +
    Month*TimePeriods +
    FishingDepthMtr*TimePeriods, 
    # FishingDepthMtr*Month, Gives some NA values
  family = gaussian(link = "log"),
  data = species.10)

summary(pa.br.5) # print summary
```

#### Model Comparison

```{r 6.21}
rcompanion::compareGLM(pa.br.1,
  pa.br.2,
  pa.br.3,
  pa.br.4,
  pa.br.5) 

# Best model = 3
```

### Summary
Models 1, 3 and 5 were often selected at the best model. 

<!--chapter:end:06-part6.Rmd-->

# Non-parametric Tests 

## Top 10 discard species weight prop 

### Data Modifications 

```{r 7.1}
# Names to remove 
Remove <- c("Multiple species finfish", "Multiple species prawns", "Xiphopenaeus kroyeri")

# Data
Top10Species <- ObserverData %>% 
  group_by(LatinNames, CommonName) %>% 
  dplyr::summarise(NoSampled = n(),
    .groups = 'drop') %>%
  filter(NoSampled >= 10) %>%
  filter(!LatinNames %in% Remove) %>%
  arrange(desc(NoSampled)) %>% 
  head(10)

# Creating a vector of names
Top10names <- Top10Species$LatinNames

# Filtering data to keep species
FilteredSpecies <- ObserverData %>% 
  filter(LatinNames %in% Top10names) %>% 
  group_by(DragID2) %>%  
  mutate(PropWeight = CpueKGHR/sum(CpueKGHR)) %>% 
  ungroup() %>% 
  dplyr::select(LatinNames,
    DragID2,
    PropWeight,
    Company,
    Month,
    TimePeriods,
    FishingZones,
    FishingDepthMtr)

# Converting variables to factors
factor.var <- c("Company",
  "Month",
  "TimePeriods",
  "FishingZones")

FilteredSpecies[,factor.var] <- lapply(FilteredSpecies[,factor.var], factor)

# Removing fishing zones 2 and 5
drop.zones <- c(2, 5)
FilteredSpecies <- FilteredSpecies %>% 
  filter(!FishingZones %in% drop.zones)
names(ObserverData)
```

### Macrodon ancylodon

```{r 7.2}
species.1 <- FilteredSpecies %>% 
  filter(LatinNames == Top10names[1]) %>% 
  # select(-DragID2) %>% 
  dplyr::select(-LatinNames)

# Histograms
bks <- c(10, 30, 50, 100, 500, 1000)

for (i in bks){
  hist(species.1$PropWeight, breaks = i)
} 

# Independent variable 1
# Summary statistics 
Summarize(PropWeight ~ Company,
  data = species.1) 

# Plotting data
histogram(~ PropWeight | Company,
          data = species.1,
          layout=c(1,2)) 

## Non-parametric test
(ma.an.1 <- kruskal.test(PropWeight ~ Company,
  data = species.1))

# Independent variable 2
## Summary statistics 
Summarize(PropWeight ~ TimePeriods,
  data = species.1) 

# Plotting data
histogram(~ PropWeight | TimePeriods,
          data = species.1,
          layout=c(1,2)) 

## Non-parametric test
(ma.an.2 <- kruskal.test(PropWeight ~ TimePeriods,
  data = species.1))

# Independent variable 3
## Summary statistics 
Summarize(PropWeight ~ Month,
  data = species.1) 

# Plotting data
histogram(~ PropWeight | Month,
          data = species.1,
          layout=c(3,3)) 

## Non-parametric test
(ma.an.3 <- kruskal.test(PropWeight ~ Month,
  data = species.1))

# Independent variable 4
## Summary statistics 
Summarize(PropWeight ~ FishingZones,
  data = species.1) 

# Plotting data
histogram(~ PropWeight | FishingZones,
          data = species.1,
          layout=c(2,2)) 

## Non-parametric test
(ma.an.4 <- kruskal.test(PropWeight ~ FishingZones,
  data = species.1))

# Independent variable 5
## Summary statistics 
Summarize(PropWeight ~ as.factor(FishingDepthMtr),
  data = species.1) 

# Plotting data
histogram(~ PropWeight | as.factor(FishingDepthMtr),
          data = species.1,
          layout=c(3,3)) 

## Non-parametric test
(ma.an.5 <- kruskal.test(PropWeight ~ as.factor(FishingDepthMtr),
  data = species.1))

# Lowest p-value = Fishing depth (0.07)
```

### Callinectes ornatus

```{r 7.3}
species.2 <- FilteredSpecies %>% 
  filter(LatinNames == Top10names[2]) %>% 
  dplyr::select(-LatinNames)

# Histograms
for (i in bks){
  hist(species.2$PropWeight, breaks = i)
} 

# Independent variable 1
# Summary statistics 
Summarize(PropWeight ~ Company,
  data = species.2) 

# Plotting data
histogram(~ PropWeight | Company,
          data = species.2,
          layout=c(1,2)) 

## Non-parametric test
(ca.or.1 <- kruskal.test(PropWeight ~ Company,
  data = species.2))

# Independent variable 2
## Summary statistics 
Summarize(PropWeight ~ TimePeriods,
  data = species.2) 

# Plotting data
histogram(~ PropWeight | TimePeriods,
          data = species.2,
          layout=c(1,2)) 

## Non-parametric test
(ca.or.2 <- kruskal.test(PropWeight ~ TimePeriods,
  data = species.2))

# Independent variable 3
## Summary statistics 
Summarize(PropWeight ~ Month,
  data = species.2) 

# Plotting data
histogram(~ PropWeight | Month,
          data = species.2,
          layout=c(3,3)) 

## Non-parametric test
(ca.or.3 <- kruskal.test(PropWeight ~ Month,
  data = species.2))

# Independent variable 4
## Summary statistics 
Summarize(PropWeight ~ FishingZones,
  data = species.2) 

# Plotting data
histogram(~ PropWeight | FishingZones,
          data = species.2,
          layout=c(2,2)) 

## Non-parametric test
(ca.or.4 <- kruskal.test(PropWeight ~ FishingZones,
  data = species.2))

# Independent variable 5
## Summary statistics 
Summarize(PropWeight ~ as.factor(FishingDepthMtr),
  data = species.2) 

# Plotting data
histogram(~ PropWeight | as.factor(FishingDepthMtr),
          data = species.2,
          layout=c(3,3)) 

## Non-parametric test
(ca.or.5 <- kruskal.test(PropWeight ~ as.factor(FishingDepthMtr),
  data = species.2))

# Lowest p-value = Fishing Zone, Company and Month(< 0.05)


```

### Stellifer rastrifer

```{r 7.4}
species.3 <- FilteredSpecies %>% 
  filter(LatinNames == Top10names[3]) %>% 
  dplyr::select(-LatinNames)

# Histograms
for (i in bks){
  hist(species.3$PropWeight, breaks = i)
} 

# Independent variable 1
# Summary statistics 
Summarize(PropWeight ~ Company,
  data = species.3) 

# Plotting data
histogram(~ PropWeight | Company,
          data = species.3,
          layout=c(1,2)) 

## Non-parametric test
(st.ra.1 <- kruskal.test(PropWeight ~ Company,
  data = species.3))

# Independent variable 2
## Summary statistics 
Summarize(PropWeight ~ TimePeriods,
  data = species.3) 

# Plotting data
histogram(~ PropWeight | TimePeriods,
          data = species.3,
          layout=c(1,2)) 

## Non-parametric test
(st.ra.2 <- kruskal.test(PropWeight ~ TimePeriods,
  data = species.3))

# Independent variable 3
## Summary statistics 
Summarize(PropWeight ~ Month,
  data = species.3) 

# Plotting data
histogram(~ PropWeight | Month,
          data = species.3,
          layout=c(3,3)) 

## Non-parametric test
(st.ra.3 <- kruskal.test(PropWeight ~ Month,
  data = species.3))

# Independent variable 4
## Summary statistics 
Summarize(PropWeight ~ FishingZones,
  data = species.3) 

# Plotting data
histogram(~ PropWeight | FishingZones,
          data = species.3,
          layout=c(2,2)) 

## Non-parametric test
(st.ra.4 <- kruskal.test(PropWeight ~ FishingZones,
  data = species.3))

# Independent variable 5
## Summary statistics 
Summarize(PropWeight ~ as.factor(FishingDepthMtr),
  data = species.3) 

# Plotting data
histogram(~ PropWeight | as.factor(FishingDepthMtr),
          data = species.3,
          layout=c(3,3)) 

## Non-parametric test
(st.ra.5 <- kruskal.test(PropWeight ~ as.factor(FishingDepthMtr),
  data = species.3))

# Lowest p-value = Company (0.03)
```

### Stellifer microps

```{r 7.5}
species.4 <- FilteredSpecies %>% 
  filter(LatinNames == Top10names[4]) %>% 
  dplyr::select(-LatinNames)

species.4 <- rbind(species.4, species.1[c(17,41,45),]) # Copying row from species.one
species.4[c(43,44,45),2] = 0.01 # changing value to '0'
species.4 <- species.4 %>% 
  arrange(DragID2) %>% 
  dplyr::select(-DragID2)

# Histograms
for (i in bks){
  hist(species.4$PropWeight, breaks = i)
} 

# Independent variable 1
# Summary statistics 
Summarize(PropWeight ~ Company,
  data = species.4) 

# Plotting data
histogram(~ PropWeight | Company,
          data = species.4,
          layout=c(1,2)) 

## Non-parametric test
(st.mi.1 <- kruskal.test(PropWeight ~ Company,
  data = species.4))

# Independent variable 2
## Summary statistics 
Summarize(PropWeight ~ TimePeriods,
  data = species.4) 

# Plotting data
histogram(~ PropWeight | TimePeriods,
          data = species.4,
          layout=c(1,2)) 

## Non-parametric test
(st.mi.2 <- kruskal.test(PropWeight ~ TimePeriods,
  data = species.4))

# Independent variable 3
## Summary statistics 
Summarize(PropWeight ~ Month,
  data = species.4) 

# Plotting data
histogram(~ PropWeight | Month,
          data = species.4,
          layout=c(3,3)) 

## Non-parametric test
(st.mi.3 <- kruskal.test(PropWeight ~ Month,
  data = species.4))

# Independent variable 4
## Summary statistics 
Summarize(PropWeight ~ FishingZones,
  data = species.4) 

# Plotting data
histogram(~ PropWeight | FishingZones,
          data = species.4,
          layout=c(2,2)) 

## Non-parametric test
(st.mi.4 <- kruskal.test(PropWeight ~ FishingZones,
  data = species.4))

# Independent variable 5
## Summary statistics 
Summarize(PropWeight ~ as.factor(FishingDepthMtr),
  data = species.4) 

# Plotting data
histogram(~ PropWeight | as.factor(FishingDepthMtr),
          data = species.4,
          layout=c(3,3)) 

## Non-parametric test
(st.mi.5 <- kruskal.test(PropWeight ~ as.factor(FishingDepthMtr),
  data = species.4))

# Lowest p-value = Company (0.053)
```

### Cynoscion virescens

```{r 7.6}
species.5 <- FilteredSpecies %>% 
  filter(LatinNames == Top10names[5]) %>% 
  dplyr::select(-LatinNames)

species.5 <- rbind(species.5, species.1[c(17,21,22,23),]) # Copying row from species.one
species.5[c(42,43,44,45),2] = 0.01 # changing value to '0'
species.5 <- species.5 %>% 
  arrange(DragID2) %>% 
  dplyr::select(-DragID2)

# Histograms
for (i in bks){
  hist(species.5$PropWeight, breaks = i)
} 

# Independent variable 1
# Summary statistics 
Summarize(PropWeight ~ Company,
  data = species.5) 

# Plotting data
histogram(~ PropWeight | Company,
          data = species.5,
          layout=c(1,2)) 

## Non-parametric test
(cy.vi.1 <- kruskal.test(PropWeight ~ Company,
  data = species.5))

# Independent variable 2
## Summary statistics 
Summarize(PropWeight ~ TimePeriods,
  data = species.5) 

# Plotting data
histogram(~ PropWeight | TimePeriods,
          data = species.5,
          layout=c(1,2)) 

## Non-parametric test
(cy.vi.2 <- kruskal.test(PropWeight ~ TimePeriods,
  data = species.5))

# Independent variable 3
## Summary statistics 
Summarize(PropWeight ~ Month,
  data = species.5) 

# Plotting data
histogram(~ PropWeight | Month,
          data = species.5,
          layout=c(3,3)) 

## Non-parametric test
(cy.vi.3 <- kruskal.test(PropWeight ~ Month,
  data = species.5))

# Independent variable 4
## Summary statistics 
Summarize(PropWeight ~ FishingZones,
  data = species.5) 

# Plotting data
histogram(~ PropWeight | FishingZones,
          data = species.5,
          layout=c(2,2)) 

## Non-parametric test
(cy.vi.4 <- kruskal.test(PropWeight ~ FishingZones,
  data = species.5))

# Independent variable 5
## Summary statistics 
Summarize(PropWeight ~ as.factor(FishingDepthMtr),
  data = species.5) 

# Plotting data
histogram(~ PropWeight | as.factor(FishingDepthMtr),
          data = species.5,
          layout=c(3,3)) 

## Non-parametric test
(cy.vi.5 <- kruskal.test(PropWeight ~ as.factor(FishingDepthMtr),
  data = species.5))

# Lowest p-values = Fishing Zone and Month(< 0.05)
```

### Symphurus plagusia

```{r 7.7}
species.6 <- FilteredSpecies %>% 
  filter(LatinNames == Top10names[6]) %>% 
  dplyr::select(-LatinNames)

species.6 <- rbind(species.6, species.1[c(7,10,18,21),]) # Copying row from species.one
species.6[c(42,43,44,45),2] = 0.01 # changing value to '0'
species.6 <- species.6 %>% 
  arrange(DragID2) %>% 
  dplyr::select(-DragID2)

# Histograms
for (i in bks){
  hist(species.6$PropWeight, breaks = i)
} 

# Independent variable 1
# Summary statistics 
Summarize(PropWeight ~ Company,
  data = species.6) 

# Plotting data
histogram(~ PropWeight | Company,
          data = species.6,
          layout=c(1,2)) 

## Non-parametric test
(sy.pl.1 <- kruskal.test(PropWeight ~ Company,
  data = species.6))

# Independent variable 2
## Summary statistics 
Summarize(PropWeight ~ TimePeriods,
  data = species.6) 

# Plotting data
histogram(~ PropWeight | TimePeriods,
          data = species.6,
          layout=c(1,2)) 

## Non-parametric test
(sy.pl.2 <- kruskal.test(PropWeight ~ TimePeriods,
  data = species.6))

# Independent variable 3
## Summary statistics 
Summarize(PropWeight ~ Month,
  data = species.6) 

# Plotting data
histogram(~ PropWeight | Month,
          data = species.6,
          layout=c(3,3)) 

## Non-parametric test
(sy.pl.3 <- kruskal.test(PropWeight ~ Month,
  data = species.6))

# Independent variable 4
## Summary statistics 
Summarize(PropWeight ~ FishingZones,
  data = species.6) 

# Plotting data
histogram(~ PropWeight | FishingZones,
          data = species.6,
          layout=c(2,2)) 

## Non-parametric test
(sy.pl.4 <- kruskal.test(PropWeight ~ FishingZones,
  data = species.6))

# Independent variable 5
## Summary statistics 
Summarize(PropWeight ~ as.factor(FishingDepthMtr),
  data = species.6) 

# Plotting data
histogram(~ PropWeight | as.factor(FishingDepthMtr),
          data = species.6,
          layout=c(3,3)) 

## Non-parametric test
(sy.pl.5 <- kruskal.test(PropWeight ~ as.factor(FishingDepthMtr),
  data = species.6))

# Lowest p-value = Company (0.09)
```

### Bagre bagre

```{r 7.8}
species.7 <- FilteredSpecies %>% 
  filter(LatinNames == Top10names[7]) %>% 
  dplyr::select(-LatinNames)

species.7 <- rbind(species.7, species.1[c(18,21,24,27,45),]) # Copying row from species.one
species.7[c(41,42,43,44,45),2] = 0.01 # changing value to '0'
species.7 <- species.7 %>% 
  arrange(DragID2) %>% 
  dplyr::select(-DragID2)

# Histograms
for (i in bks){
  hist(species.7$PropWeight, breaks = i)
} 

# Independent variable 1
# Summary statistics 
Summarize(PropWeight ~ Company,
  data = species.7) 

# Plotting data
histogram(~ PropWeight | Company,
          data = species.7,
          layout=c(1,2)) 

## Non-parametric test
(ba.ba.1 <- kruskal.test(PropWeight ~ Company,
  data = species.7))

# Independent variable 2
## Summary statistics 
Summarize(PropWeight ~ TimePeriods,
  data = species.7) 

# Plotting data
histogram(~ PropWeight | TimePeriods,
          data = species.7,
          layout=c(1,2)) 

## Non-parametric test
(ba.ba.2 <- kruskal.test(PropWeight ~ TimePeriods,
  data = species.7))

# Independent variable 3
## Summary statistics 
Summarize(PropWeight ~ Month,
  data = species.7) 

# Plotting data
histogram(~ PropWeight | Month,
          data = species.7,
          layout=c(3,3)) 

## Non-parametric test
(ba.ba.3 <- kruskal.test(PropWeight ~ Month,
  data = species.7))

# Independent variable 4
## Summary statistics 
Summarize(PropWeight ~ FishingZones,
  data = species.7) 

# Plotting data
histogram(~ PropWeight | FishingZones,
          data = species.7,
          layout=c(2,2)) 

## Non-parametric test
(ba.ba.4 <- kruskal.test(PropWeight ~ FishingZones,
  data = species.7))

# Independent variable 5
## Summary statistics 
Summarize(PropWeight ~ as.factor(FishingDepthMtr),
  data = species.7) 

# Plotting data
histogram(~ PropWeight | as.factor(FishingDepthMtr),
          data = species.7,
          layout=c(3,3)) 

## Non-parametric test
(ba.ba.5 <- kruskal.test(PropWeight ~ as.factor(FishingDepthMtr),
  data = species.7))

# Lowest p-value = Fishing depth (0.13)
```

### Trichiurus lepturus

```{r 7.9}
species.8 <- FilteredSpecies %>% 
  filter(LatinNames == Top10names[8]) %>% 
  dplyr::select(-LatinNames)

species.8 <- rbind(species.8, species.1[c(6,7,35,37,41,45),]) # Copying row from species.one
species.8[c(40,41,42,43,44,45),2] = 0.01 # changing value to '0'
species.8 <- species.8 %>% 
  arrange(DragID2) %>% 
  dplyr::select(-DragID2)

# Histograms
for (i in bks){
  hist(species.8$PropWeight, breaks = i)
} 

# Independent variable 1
# Summary statistics 
Summarize(PropWeight ~ Company,
  data = species.8) 

# Plotting data
histogram(~ PropWeight | Company,
          data = species.8,
          layout=c(1,2)) 

## Non-parametric test
(tr.le.1 <- kruskal.test(PropWeight ~ Company,
  data = species.8))

# Independent variable 2
## Summary statistics 
Summarize(PropWeight ~ TimePeriods,
  data = species.8) 

# Plotting data
histogram(~ PropWeight | TimePeriods,
          data = species.8,
          layout=c(1,2)) 

## Non-parametric test
(tr.le.2 <- kruskal.test(PropWeight ~ TimePeriods,
  data = species.8))

# Independent variable 3
## Summary statistics 
Summarize(PropWeight ~ Month,
  data = species.8) 

# Plotting data
histogram(~ PropWeight | Month,
          data = species.8,
          layout=c(3,3)) 

## Non-parametric test
(tr.le.3 <- kruskal.test(PropWeight ~ Month,
  data = species.8))

# Independent variable 4
## Summary statistics 
Summarize(PropWeight ~ FishingZones,
  data = species.8) 

# Plotting data
histogram(~ PropWeight | FishingZones,
          data = species.8,
          layout=c(2,2)) 

## Non-parametric test
(tr.le.4 <- kruskal.test(PropWeight ~ FishingZones,
  data = species.8))

# Independent variable 5
## Summary statistics 
Summarize(PropWeight ~ as.factor(FishingDepthMtr),
  data = species.8) 

# Plotting data
histogram(~ PropWeight | as.factor(FishingDepthMtr),
          data = species.8,
          layout=c(3,3)) 

## Non-parametric test
(tr.le.5 <- kruskal.test(PropWeight ~ as.factor(FishingDepthMtr),
  data = species.8))

# Lowest p-value = Month (< 0.05)
```

### Achirus achirus

```{r 7.10}
species.9 <- FilteredSpecies %>% 
  filter(LatinNames == Top10names[9]) %>% 
  dplyr::select(-LatinNames)

species.9 <- rbind(species.9, species.1[c(10,11,13,15,18,21,24,25),]) # Copying row from species.one
species.9[c(38,39,40,41,42,43,44,45),2] = 0.01 # changing value to '0'
species.9 <- species.9 %>% 
  arrange(DragID2) %>% 
  dplyr::select(-DragID2)

# Histograms
for (i in bks){
  hist(species.9$PropWeight, breaks = i)
} 

# Independent variable 1
# Summary statistics 
Summarize(PropWeight ~ Company,
  data = species.9) 

# Plotting data
histogram(~ PropWeight | Company,
          data = species.9,
          layout=c(1,2)) 

## Non-parametric test
(ac.ac.1 <- kruskal.test(PropWeight ~ Company,
  data = species.9))

# Independent variable 2
## Summary statistics 
Summarize(PropWeight ~ TimePeriods,
  data = species.9) 

# Plotting data
histogram(~ PropWeight | TimePeriods,
          data = species.9,
          layout=c(1,2)) 

## Non-parametric test
(ac.ac.2 <- kruskal.test(PropWeight ~ TimePeriods,
  data = species.9))

# Independent variable 3
## Summary statistics 
Summarize(PropWeight ~ Month,
  data = species.9) 

# Plotting data
histogram(~ PropWeight | Month,
          data = species.9,
          layout=c(3,3)) 

## Non-parametric test
(ac.ac.3 <- kruskal.test(PropWeight ~ Month,
  data = species.9))

# Independent variable 4
## Summary statistics 
Summarize(PropWeight ~ FishingZones,
  data = species.9) 

# Plotting data
histogram(~ PropWeight | FishingZones,
          data = species.9,
          layout=c(2,2)) 

## Non-parametric test
(ac.ac.4 <- kruskal.test(PropWeight ~ FishingZones,
  data = species.9))

# Independent variable 5
## Summary statistics 
Summarize(PropWeight ~ as.factor(FishingDepthMtr),
  data = species.9) 

# Plotting data
histogram(~ PropWeight | as.factor(FishingDepthMtr),
          data = species.9,
          layout=c(3,3)) 

## Non-parametric test
(ac.ac.5 <- kruskal.test(PropWeight ~ as.factor(FishingDepthMtr),
  data = species.9))

# Lowest p-value = Fishing depth (0.03)
```

### Paralonchurus brasiliensis

```{r 7.11}
species.10 <- FilteredSpecies %>% 
  filter(LatinNames == Top10names[10]) %>% 
  dplyr::select(-LatinNames)

species.10 <- rbind(species.10, species.1[c(7,17,20,22,23,28,35,39,43,45),]) # Copying row from species.one
species.10[c(36,37,38,39,40,41,42,43,44,45),2] = 0.01 # changing value to '0'
species.10 <- species.10 %>% 
  arrange(DragID2) %>% 
  dplyr::select(-DragID2)

# Histograms
for (i in bks){
  hist(species.10$PropWeight, breaks = i)
} 
 
# ## Manually check for mismatches
# dim(species.4)
# unique(species.1$DragID2) #######data have 45 rows rows 10, 28, 36
# 
# vec1 <- unique(species.1$DragID2)
# vec2 <- unique(species.10$DragID2)
# 
# vec1[!(vec1 %in% vec2)]

# Independent variable 1
# Summary statistics 
Summarize(PropWeight ~ Company,
  data = species.10) 

# Plotting data
histogram(~ PropWeight | Company,
          data = species.10,
          layout=c(1,2)) 

## Non-parametric test
(pa.br.1 <- kruskal.test(PropWeight ~ Company,
  data = species.10))

# Independent variable 2
## Summary statistics 
Summarize(PropWeight ~ TimePeriods,
  data = species.10) 

# Plotting data
histogram(~ PropWeight | TimePeriods,
          data = species.10,
          layout=c(1,2)) 

## Non-parametric test
(pa.br.2 <- kruskal.test(PropWeight ~ TimePeriods,
  data = species.10))

# Independent variable 3
## Summary statistics 
Summarize(PropWeight ~ Month,
  data = species.10) 

# Plotting data
histogram(~ PropWeight | Month,
          data = species.10,
          layout=c(3,3)) 

## Non-parametric test
(pa.br.3 <- kruskal.test(PropWeight ~ Month,
  data = species.10))

# Independent variable 4
## Summary statistics 
Summarize(PropWeight ~ FishingZones,
  data = species.10) 

# Plotting data
histogram(~ PropWeight | FishingZones,
          data = species.10,
          layout=c(2,2)) 

## Non-parametric test
(pa.br.4 <- kruskal.test(PropWeight ~ FishingZones,
  data = species.10))

# Independent variable 5
## Summary statistics 
Summarize(PropWeight ~ as.factor(FishingDepthMtr),
  data = species.10) 

# Plotting data
histogram(~ PropWeight | as.factor(FishingDepthMtr),
          data = species.10,
          layout=c(3,3)) 

## Non-parametric test
(pa.br.5 <- kruskal.test(PropWeight ~ as.factor(FishingDepthMtr),
  data = species.10))

# Lowest p-value = Month (0.33)
```

## Model Comparison

```{r 7.12}

Species <- Top10names

Company <- c(ma.an.1$p.value, ca.or.1$p.value, st.ra.1$p.value, st.mi.1$p.value, cy.vi.1$p.value, sy.pl.1$p.value, ba.ba.1$p.value, tr.le.1$p.value, ac.ac.1$p.value, pa.br.1$p.value)


TimePeriods <- c(ma.an.2$p.value, ca.or.2$p.value, st.ra.2$p.value, st.mi.2$p.value, cy.vi.2$p.value, sy.pl.2$p.value, ba.ba.2$p.value, tr.le.2$p.value, ac.ac.2$p.value, pa.br.2$p.value)

Month <- c(ma.an.3$p.value, ca.or.3$p.value, st.ra.3$p.value, st.mi.3$p.value, cy.vi.3$p.value, sy.pl.3$p.value, ba.ba.3$p.value, tr.le.3$p.value, ac.ac.3$p.value, pa.br.3$p.value)

FishingZones <- c(ma.an.4$p.value, ca.or.4$p.value, st.ra.4$p.value, st.mi.4$p.value, cy.vi.4$p.value, sy.pl.4$p.value, ba.ba.4$p.value, tr.le.4$p.value, ac.ac.4$p.value, pa.br.4$p.value)

FishingDepthMtr <- c(ma.an.5$p.value, ca.or.5$p.value, st.ra.5$p.value, st.mi.5$p.value, cy.vi.5$p.value, sy.pl.5$p.value, ba.ba.5$p.value, tr.le.5$p.value, ac.ac.5$p.value, pa.br.5$p.value)


kw.comparison.table <- data.frame(Species, Company, TimePeriods, Month, FishingZones, FishingDepthMtr) %>% 
  mutate_if(is.numeric, round, 3) 

kw.comparison.table[1:10, 1:6] %>%
  mutate(Company = cell_spec(Company, background = ifelse(Company < 0.05, "yellow", " "))) %>% 
  mutate(Month = cell_spec(Month, background = ifelse(Month < 0.05, "yellow", " "))) %>%
  mutate(TimePeriods = cell_spec(TimePeriods, background = ifelse(TimePeriods < 0.05, "yellow", " "))) %>%
  mutate(FishingZones = cell_spec(FishingZones, background = ifelse(FishingZones < 0.05, "yellow", " "))) %>%
  mutate(FishingDepthMtr = cell_spec(FishingDepthMtr, background = ifelse(FishingDepthMtr < 0.05, "yellow", " "))) %>%
  kbl(caption = "Comparison of Kruskal-wallis Test Results for the Top 10 bycatch species",
    booktabs = T, linesep = "", escape = FALSE) %>% 
  add_header_above(c(" " = 1, "P-values" = 5)) %>% 
  kable_paper(full_width = F) %>%
  kable_styling(fixed_thead = T,
    bootstrap_options = c("striped", "condensed")) %>% 
  column_spec(2:6, color = "black") %>% 
  footnote(general = "The p-values < 0.05 are colored yellow.")
```

## All species across bottom trawl tows

### Data Modifications 

```{r 7.13}
discards.prop <- SummaryTable %>% 
  ungroup() %>%
  filter(CatchCategory == "Discarded catch") %>% 
  dplyr::select(Company,
  Month,
  TimePeriods,
  FishingZones,
  FishingDepthMtr,
  PropWeight)

# Converting variables to factors
factor.var <- c("Company",
  "Month",
  "TimePeriods",
  "FishingZones")

discards.prop[,factor.var] <- lapply(discards.prop[,factor.var], factor)

# Removing fishing zones 2 and 5
drop.zones <- c(2, 5)
discards.prop.2 <- discards.prop %>% 
  filter(!FishingZones %in% drop.zones)

# Histogram
hist(discards.prop$PropWeight, breaks = 10)
```

```{r 7.14}
# Independent variable 1
# Summary statistics 
Summarize(PropWeight ~ Company,
  data = discards.prop) 

# Plotting data
histogram(~ PropWeight | Company,
          data = discards.prop,
          layout=c(1,2)) 

## Non-parametric test
(com.model <- kruskal.test(PropWeight ~ Company,
  data = discards.prop))

# Independent variable 2
## Summary statistics 
Summarize(PropWeight ~ TimePeriods,
  data = discards.prop) 

# Plotting data
histogram(~ PropWeight | TimePeriods,
          data = discards.prop,
          layout=c(1,2)) 

## Non-parametric test
(tod.model <- kruskal.test(PropWeight ~ TimePeriods,
  data = discards.prop))

# Independent variable 3
## Summary statistics 
Summarize(PropWeight ~ Month,
  data = discards.prop) 

# Plotting data
histogram(~ PropWeight | Month,
          data = discards.prop,
          layout=c(3,3)) 

## Non-parametric test
(mon.model <- kruskal.test(PropWeight ~ Month,
  data = discards.prop))

# Independent variable 4
## Summary statistics 
Summarize(PropWeight ~ FishingZones,
  data = discards.prop) 

# Plotting data
histogram(~ PropWeight | FishingZones,
          data = discards.prop,
          layout=c(2,2)) 

## Non-parametric test
(fzon.model <- kruskal.test(PropWeight ~ FishingZones,
  data = discards.prop))

# Independent variable 5
## Summary statistics 
Summarize(PropWeight ~ as.factor(FishingDepthMtr),
  data = discards.prop) 

# Plotting data
histogram(~ PropWeight | as.factor(FishingDepthMtr),
          data = discards.prop,
          layout=c(3,3)) 

## Non-parametric test
(fdep.model <- kruskal.test(PropWeight ~ as.factor(FishingDepthMtr),
  data = discards.prop))

# Lowest p-value = Month (0.002)
```

## Model Comparison

```{r 7.15}
Factors <- c("Company", "TimePeriods", "Month", "FishingZones", "FishingDepthMtr")

P.values <- c(com.model$p.value, tod.model$p.value, mon.model$p.value, fzon.model$p.value, fdep.model$p.value)
  
kw.comparison.table.2 <- data.frame(Factors, P.values) %>% 
  mutate_if(is.numeric, round, 3) 

kw.comparison.table.2[1:5, 1:2] %>%
  mutate(P.values = cell_spec(P.values, background = ifelse(P.values < 0.05, "yellow", " "))) %>%
  kbl(caption = "Comparison of Kruskal-wallis Test Results - proportions for all bycatch species",
    booktabs = T,
    linesep = "", 
    escape = FALSE,
    align = "l") %>% 
  kable_paper(full_width = T) %>%
  kable_styling(fixed_thead = T,
    bootstrap_options = c("striped", "condensed")) %>% 
  column_spec(2, color = "black") %>% 
  footnote(general = "The p-values < 0.05 are colored yellow.")
```

<!--chapter:end:07-part7.Rmd-->

#  Best Proportion Models - Top 10 Bycatch Species

```{r, eval = FALSE, include = FALSE}
# ## List of the Most Recent Changes :-
# 
# 1. Summary tables for the negative binomial model outputs:
#   
# * [AIC][Model Comparison - AIC]
# * [P-value][Model Comparison - P.values]
#   
# 2. Correct the response variable in the [binomial models][Binomial Model Selection] 
# 
# 3. Adjust correlation matrix by adding [p-values and correlation for every factor variables][Correlation Analysis for Primary Species]
# 
# 4. Do [PCA for species][Principal Component Analysis (PCA)] not fishing trips. 
# 
# 5. Conduct a [Canonical correspondence analysis][Canonical Correspondence Analysis]. 
# 
# 6. [K-mean and hierarchical clustering starting from k = 3][CLUSTER ANALYSIS]. Do K-means by species and not fishing tows. 
# 
# 7. Repeat the variable PCA plots but showing different factors instead? 
```

## Negative Binomial Model Selection

### Data Modifications 

```{r 8.1}
# Names to remove 
Remove <- c("Multiple species finfish", "Multiple species prawns", "Xiphopenaeus kroyeri")

# Data
Top10Species <- ObserverData %>% 
  group_by(LatinNames, CommonName) %>% 
  dplyr::summarise(NoSampled = n(),
    .groups = 'drop') %>%
  filter(NoSampled >= 10) %>%
  filter(!LatinNames %in% Remove) %>%
  arrange(desc(NoSampled)) %>% 
  head(10)

# Creating a vector of names
Top10names <- Top10Species$LatinNames


# Filtering data to keep species
FilteredSpecies <- ObserverData %>% 
  filter(LatinNames %in% Top10names) %>% 
  group_by(DragID2) %>%  
  mutate(PropWeight = CpueKGHR/sum(CpueKGHR)) %>% 
  ungroup() %>% 
  dplyr::select(LatinNames,
    DragID2,
    PropWeight,
    Company,
    Month,
    TimePeriods,
    FishingZones,
    FishingDepthMtr)

# Converting variables to factors
factor.var <- c("Company",
  "Month",
  "TimePeriods",
  "FishingZones")

FilteredSpecies[,factor.var] <- lapply(FilteredSpecies[,factor.var], factor)

# Removing fishing zones 2 and 5
drop.zones <- c(2, 5)
FilteredSpecies <- FilteredSpecies %>% 
  filter(!FishingZones %in% drop.zones) %>% 
  droplevels()
```

### 1. Macrodon ancylodon

```{r 8.2, warning = FALSE}

# filtering data
species.1 <- FilteredSpecies %>% 
  filter(LatinNames == Top10names[1]) %>% 
  dplyr::select(-LatinNames)

# Running models
# 2 Predictors
ma.an.1a <- glm.nb(PropWeight ~ Month +
    TimePeriods,
  data = species.1)

ma.an.1b <- glm(PropWeight ~ Month +
    TimePeriods,
  family = negative.binomial(ma.an.1a$theta),
  data = species.1)

summary(ma.an.1b) # print summary

# 2 Predictors with 1 interaction term
ma.an.2a <- glm.nb(PropWeight ~ Month +
    TimePeriods +
    Month*TimePeriods,
  data = species.1)

ma.an.2b <- glm(PropWeight ~ Month +
    TimePeriods +
    Month*TimePeriods,
  family = negative.binomial(ma.an.2a$theta),
  data = species.1)

summary(ma.an.2b) # print summary

# 3 Predictors
ma.an.3a <- glm.nb(PropWeight ~ TimePeriods +
    FishingDepthMtr +
    FishingZones,
  data = species.1)

ma.an.3b <- glm(PropWeight ~ TimePeriods +
    FishingDepthMtr +
    FishingZones,
  family = negative.binomial(ma.an.3a$theta),
  data = species.1)

summary(ma.an.3b) # print summary

# 3 Predictors and 1 interaction term
ma.an.4a <- glm.nb(PropWeight ~ FishingDepthMtr +
    FishingZones +
    TimePeriods +
    TimePeriods*FishingZones,
  data = species.1)

ma.an.4b <- glm(PropWeight ~ FishingDepthMtr +
    FishingZones +
    TimePeriods +
    TimePeriods*FishingZones,
  family = negative.binomial(ma.an.4a$theta),
  data = species.1)

summary(ma.an.4b) # print summary

# 3 Predictors with 2 interaction term
ma.an.5a <- glm.nb(PropWeight ~ Month +
    TimePeriods +
    FishingDepthMtr +
    Month*TimePeriods +
    FishingDepthMtr*TimePeriods,
  data = species.1)

ma.an.5b <- glm(PropWeight ~ Month +
    TimePeriods +
    FishingDepthMtr +
    Month*TimePeriods +
    FishingDepthMtr*TimePeriods, 
  family = negative.binomial(ma.an.4a$theta),
  data = species.1)

summary(ma.an.5b) # print summary
```

#### Model Comparison

```{r 8.3}
(sum.tab.1 <- rcompanion::compareGLM(ma.an.1b,
  ma.an.2b,
  ma.an.3b,
  ma.an.4b,
  ma.an.5b))

# Best model = 3
# Factors = TimePeriods + FishingDepthMtr +     
# FishingZones
```

### 2. Callinectes ornatus

```{r 8.4, warning = FALSE}

# filtering data
species.2 <- FilteredSpecies %>% 
  filter(LatinNames == Top10names[2]) %>% 
  dplyr::select(-LatinNames)

# Running models
# 2 Predictors
ca.or.1a <- glm.nb(PropWeight ~ Month +
    TimePeriods,
  data = species.2)

ca.or.1b <- glm(PropWeight ~ Month +
    TimePeriods,
  family = negative.binomial(ca.or.1a$theta),
  data = species.2)

summary(ca.or.1b) # print summary

# 2 Predictors with 1 interaction term
ca.or.2a <- glm.nb(PropWeight ~ Month +
    TimePeriods +
    Month*TimePeriods,
  data = species.2)

ca.or.2b <- glm(PropWeight ~ Month +
    TimePeriods +
    Month*TimePeriods,
  family = negative.binomial(ca.or.2a$theta),
  data = species.2)

summary(ca.or.2b) # print summary

# 3 Predictors
ca.or.3a <- glm.nb(PropWeight ~ TimePeriods +
    FishingDepthMtr +
    FishingZones,
  data = species.2)

ca.or.3b <- glm(PropWeight ~ TimePeriods +
    FishingDepthMtr +
    FishingZones,
  family = negative.binomial(ca.or.3a$theta),
  data = species.2)

summary(ca.or.3b) # print summary

# 3 Predictors and 1 interaction term
ca.or.4a <- glm.nb(PropWeight ~ FishingDepthMtr +
    FishingZones +
    TimePeriods +
    TimePeriods*FishingZones,
  data = species.2)

ca.or.4b <- glm(PropWeight ~ FishingDepthMtr +
    FishingZones +
    TimePeriods +
    TimePeriods*FishingZones,
  family = negative.binomial(ca.or.4a$theta),
  data = species.2)

summary(ca.or.4b) # print summary

# 3 Predictors with 2 interaction term
ca.or.5a <- glm.nb(PropWeight ~ Month +
    TimePeriods +
    FishingDepthMtr +
    Month*TimePeriods +
    FishingDepthMtr*TimePeriods,
  data = species.2)

ca.or.5b <- glm(PropWeight ~ Month +
    TimePeriods +
    FishingDepthMtr +
    Month*TimePeriods +
    FishingDepthMtr*TimePeriods, 
  family = negative.binomial(ca.or.4a$theta),
  data = species.2)

summary(ca.or.5b) # print summary
```

#### Model Comparison

```{r 8.5}
(sum.tab.2 <- rcompanion::compareGLM(ca.or.1b,
  ca.or.2b,
  ca.or.3b,
  ca.or.4b,
  ca.or.5b))

# Best model = 3
# Factors = TimePeriods + FishingDepthMtr +     
# FishingZones
```

### 3. Stellifer rastrifer

```{r 8.6, warning = FALSE}

# filtering data
species.3 <- FilteredSpecies %>% 
  filter(LatinNames == Top10names[3]) %>% 
  dplyr::select(-LatinNames)

# Running models
# 2 Predictors
st.ra.1a <- glm.nb(PropWeight ~ Month +
    TimePeriods,
  data = species.3)

st.ra.1b <- glm(PropWeight ~ Month +
    TimePeriods,
  family = negative.binomial(st.ra.1a$theta),
  data = species.3)

summary(st.ra.1b) # print summary

# 2 Predictors with 1 interaction term
st.ra.2a <- glm.nb(PropWeight ~ Month +
    TimePeriods +
    Month*TimePeriods,
  data = species.3)

st.ra.2b <- glm(PropWeight ~ Month +
    TimePeriods +
    Month*TimePeriods,
  family = negative.binomial(st.ra.2a$theta),
  data = species.3)

summary(st.ra.2b) # print summary

# 3 Predictors
st.ra.3a <- glm.nb(PropWeight ~ TimePeriods +
    FishingDepthMtr +
    FishingZones,
  data = species.3)

st.ra.3b <- glm(PropWeight ~ TimePeriods +
    FishingDepthMtr +
    FishingZones,
  family = negative.binomial(st.ra.3a$theta),
  data = species.3)

summary(st.ra.3b) # print summary

# 3 Predictors and 1 interaction term
st.ra.4a <- glm.nb(PropWeight ~ FishingDepthMtr +
    FishingZones +
    TimePeriods +
    TimePeriods*FishingZones,
  data = species.3)

st.ra.4b <- glm(PropWeight ~ FishingDepthMtr +
    FishingZones +
    TimePeriods +
    TimePeriods*FishingZones,
  family = negative.binomial(st.ra.4a$theta),
  data = species.3)

summary(st.ra.4b) # print summary

# 3 Predictors with 2 interaction term
st.ra.5a <- glm.nb(PropWeight ~ Month +
    TimePeriods +
    FishingDepthMtr +
    Month*TimePeriods +
    FishingDepthMtr*TimePeriods,
  data = species.3)

st.ra.5b <- glm(PropWeight ~ Month +
    TimePeriods +
    FishingDepthMtr +
    Month*TimePeriods +
    FishingDepthMtr*TimePeriods, 
  family = negative.binomial(st.ra.4a$theta),
  data = species.3)

summary(st.ra.5b) # print summary
```

#### Model Comparison

```{r 8.7}
(sum.tab.3 <- rcompanion::compareGLM(st.ra.1b,
  st.ra.2b,
  st.ra.3b,
  st.ra.4b,
  st.ra.5b))

# Best model = 3
# Factors = TimePeriods + FishingDepthMtr +     
# FishingZones
```

### 4. Stellifer microps

```{r 8.8, warning = FALSE}

# filtering data
species.4 <- FilteredSpecies %>% 
  filter(LatinNames == Top10names[4]) %>% 
  dplyr::select(-LatinNames)

# Running models
# 2 Predictors
st.mi.1a <- glm.nb(PropWeight ~ Month +
    TimePeriods,
  data = species.4)

st.mi.1b <- glm(PropWeight ~ Month +
    TimePeriods,
  family = negative.binomial(st.mi.1a$theta),
  data = species.4)

summary(st.mi.1b) # print summary

# 2 Predictors with 1 interaction term
st.mi.2a <- glm.nb(PropWeight ~ Month +
    TimePeriods +
    Month*TimePeriods,
  data = species.4)

st.mi.2b <- glm(PropWeight ~ Month +
    TimePeriods +
    Month*TimePeriods,
  family = negative.binomial(st.mi.2a$theta),
  data = species.4)

summary(st.mi.2b) # print summary

# 3 Predictors
st.mi.3a <- glm.nb(PropWeight ~ TimePeriods +
    FishingDepthMtr +
    FishingZones,
  data = species.4)

st.mi.3b <- glm(PropWeight ~ TimePeriods +
    FishingDepthMtr +
    FishingZones,
  family = negative.binomial(st.mi.3a$theta),
  data = species.4)

summary(st.mi.3b) # print summary

# 3 Predictors and 1 interaction term
st.mi.4a <- glm.nb(PropWeight ~ FishingDepthMtr +
    FishingZones +
    TimePeriods +
    TimePeriods*FishingZones,
  data = species.4)

st.mi.4b <- glm(PropWeight ~ FishingDepthMtr +
    FishingZones +
    TimePeriods +
    TimePeriods*FishingZones,
  family = negative.binomial(st.mi.4a$theta),
  data = species.4)

summary(st.mi.4b) # print summary

# 3 Predictors with 2 interaction term
st.mi.5a <- glm.nb(PropWeight ~ Month +
    TimePeriods +
    FishingDepthMtr +
    Month*TimePeriods +
    FishingDepthMtr*TimePeriods,
  data = species.4)

st.mi.5b <- glm(PropWeight ~ Month +
    TimePeriods +
    FishingDepthMtr +
    Month*TimePeriods +
    FishingDepthMtr*TimePeriods, 
  family = negative.binomial(st.mi.4a$theta),
  data = species.4)

summary(st.mi.5b) # print summary
```

#### Model Comparison

```{r 8.9}
(sum.tab.4 <- rcompanion::compareGLM(st.mi.1b,
  st.mi.2b,
  st.mi.3b,
  st.mi.4b,
  st.mi.5b))

# Best model = 3
# Factors = TimePeriods + FishingDepthMtr +     
# FishingZones
```

### 5. Cynoscion virescens

```{r 8.10, warning = FALSE}

# filtering data
species.5 <- FilteredSpecies %>% 
  filter(LatinNames == Top10names[5]) %>% 
  dplyr::select(-LatinNames)

# Running models
# 2 Predictors
cy.vi.1a <- glm.nb(PropWeight ~ Month +
    TimePeriods,
  data = species.5)

cy.vi.1b <- glm(PropWeight ~ Month +
    TimePeriods,
  family = negative.binomial(cy.vi.1a$theta),
  data = species.5)

summary(cy.vi.1b) # print summary

# 2 Predictors with 1 interaction term
cy.vi.2a <- glm.nb(PropWeight ~ Month +
    TimePeriods +
    Month*TimePeriods,
  data = species.5)

cy.vi.2b <- glm(PropWeight ~ Month +
    TimePeriods +
    Month*TimePeriods,
  family = negative.binomial(cy.vi.2a$theta),
  data = species.5)

summary(cy.vi.2b) # print summary

# 3 Predictors
cy.vi.3a <- glm.nb(PropWeight ~ TimePeriods +
    FishingDepthMtr +
    FishingZones,
  data = species.5)

cy.vi.3b <- glm(PropWeight ~ TimePeriods +
    FishingDepthMtr +
    FishingZones,
  family = negative.binomial(cy.vi.3a$theta),
  data = species.5)

summary(cy.vi.3b) # print summary

# 3 Predictors and 1 interaction term
cy.vi.4a <- glm.nb(PropWeight ~ FishingDepthMtr +
    FishingZones +
    TimePeriods +
    TimePeriods*FishingZones,
  data = species.5)

cy.vi.4b <- glm(PropWeight ~ FishingDepthMtr +
    FishingZones +
    TimePeriods +
    TimePeriods*FishingZones,
  family = negative.binomial(cy.vi.4a$theta),
  data = species.5)

summary(cy.vi.4b) # print summary

# 3 Predictors with 2 interaction term
cy.vi.5a <- glm.nb(PropWeight ~ Month +
    TimePeriods +
    FishingDepthMtr +
    Month*TimePeriods +
    FishingDepthMtr*TimePeriods,
  data = species.5)

cy.vi.5b <- glm(PropWeight ~ Month +
    TimePeriods +
    FishingDepthMtr +
    Month*TimePeriods +
    FishingDepthMtr*TimePeriods, 
  family = negative.binomial(cy.vi.4a$theta),
  data = species.5)

summary(cy.vi.5b) # print summary
```

#### Model Comparison

```{r 8.11}
(sum.tab.5 <- rcompanion::compareGLM(cy.vi.1b,
  cy.vi.2b,
  cy.vi.3b,
  cy.vi.4b,
  cy.vi.5b))

# Best model = 3
# Factors = TimePeriods + FishingDepthMtr +     
# FishingZones
```

### 6. Symphurus plagusia

```{r 8.12, warning = FALSE}

# filtering data
species.6 <- FilteredSpecies %>% 
  filter(LatinNames == Top10names[6]) %>% 
  dplyr::select(-LatinNames)

# Running models
# 2 Predictors
sy.pl.1a <- glm.nb(PropWeight ~ Month +
    TimePeriods,
  data = species.6)

sy.pl.1b <- glm(PropWeight ~ Month +
    TimePeriods,
  family = negative.binomial(sy.pl.1a$theta),
  data = species.6)

summary(sy.pl.1b) # print summary

# 2 Predictors with 1 interaction term
sy.pl.2a <- glm.nb(PropWeight ~ Month +
    TimePeriods +
    Month*TimePeriods,
  data = species.6)

sy.pl.2b <- glm(PropWeight ~ Month +
    TimePeriods +
    Month*TimePeriods,
  family = negative.binomial(sy.pl.2a$theta),
  data = species.6)

summary(sy.pl.2b) # print summary

# 3 Predictors
sy.pl.3a <- glm.nb(PropWeight ~ TimePeriods +
    FishingDepthMtr +
    FishingZones,
  data = species.6)

sy.pl.3b <- glm(PropWeight ~ TimePeriods +
    FishingDepthMtr +
    FishingZones,
  family = negative.binomial(sy.pl.3a$theta),
  data = species.6)

summary(sy.pl.3b) # print summary

# 3 Predictors and 1 interaction term
sy.pl.4a <- glm.nb(PropWeight ~ FishingDepthMtr +
    FishingZones +
    TimePeriods +
    TimePeriods*FishingZones,
  data = species.6)

sy.pl.4b <- glm(PropWeight ~ FishingDepthMtr +
    FishingZones +
    TimePeriods +
    TimePeriods*FishingZones,
  family = negative.binomial(sy.pl.4a$theta),
  data = species.6)

summary(sy.pl.4b) # print summary

# 3 Predictors with 2 interaction term
sy.pl.5a <- glm.nb(PropWeight ~ Month +
    TimePeriods +
    FishingDepthMtr +
    Month*TimePeriods +
    FishingDepthMtr*TimePeriods,
  data = species.6)

sy.pl.5b <- glm(PropWeight ~ Month +
    TimePeriods +
    FishingDepthMtr +
    Month*TimePeriods +
    FishingDepthMtr*TimePeriods, 
  family = negative.binomial(sy.pl.4a$theta),
  data = species.6)

summary(sy.pl.5b) # print summary
```

#### Model Comparison

```{r 8.13}
(sum.tab.6 <- rcompanion::compareGLM(sy.pl.1b,
  sy.pl.2b,
  sy.pl.3b,
  sy.pl.4b,
  sy.pl.5b))

# Best model = 3
# Factors = TimePeriods + FishingDepthMtr +     
# FishingZones
```

### 7. Bagre bagre

```{r 8.14, warning = FALSE}

# filtering data
species.7 <- FilteredSpecies %>% 
  filter(LatinNames == Top10names[7]) %>% 
  dplyr::select(-LatinNames)

# Running models
# 2 Predictors
ba.ba.1a <- glm.nb(PropWeight ~ Month +
    TimePeriods,
  data = species.7)

ba.ba.1b <- glm(PropWeight ~ Month +
    TimePeriods,
  family = negative.binomial(ba.ba.1a$theta),
  data = species.7)

summary(ba.ba.1b) # print summary

# 2 Predictors with 1 interaction term
ba.ba.2a <- glm.nb(PropWeight ~ Month +
    TimePeriods +
    Month*TimePeriods,
  data = species.7)

ba.ba.2b <- glm(PropWeight ~ Month +
    TimePeriods +
    Month*TimePeriods,
  family = negative.binomial(ba.ba.2a$theta),
  data = species.7)

summary(ba.ba.2b) # print summary

# 3 Predictors
ba.ba.3a <- glm.nb(PropWeight ~ TimePeriods +
    FishingDepthMtr +
    FishingZones,
  data = species.7)

ba.ba.3b <- glm(PropWeight ~ TimePeriods +
    FishingDepthMtr +
    FishingZones,
  family = negative.binomial(ba.ba.3a$theta),
  data = species.7)

summary(ba.ba.3b) # print summary

# 3 Predictors and 1 interaction term
ba.ba.4a <- glm.nb(PropWeight ~ FishingDepthMtr +
    FishingZones +
    TimePeriods +
    TimePeriods*FishingZones,
  data = species.7)

ba.ba.4b <- glm(PropWeight ~ FishingDepthMtr +
    FishingZones +
    TimePeriods +
    TimePeriods*FishingZones,
  family = negative.binomial(ba.ba.4a$theta),
  data = species.7)

summary(ba.ba.4b) # print summary

# 3 Predictors with 2 interaction term
ba.ba.5a <- glm.nb(PropWeight ~ Month +
    TimePeriods +
    FishingDepthMtr +
    Month*TimePeriods +
    FishingDepthMtr*TimePeriods,
  data = species.7)

ba.ba.5b <- glm(PropWeight ~ Month +
    TimePeriods +
    FishingDepthMtr +
    Month*TimePeriods +
    FishingDepthMtr*TimePeriods, 
  family = negative.binomial(ba.ba.4a$theta),
  data = species.7)

summary(ba.ba.5b) # print summary
```

#### Model Comparison

```{r 8.15}
(sum.tab.7 <- rcompanion::compareGLM(ba.ba.1b,
  ba.ba.2b,
  ba.ba.3b,
  ba.ba.4b,
  ba.ba.5b))

# Best model = 3
# Factors = TimePeriods + FishingDepthMtr +     
# FishingZones
```

### 8. Trichiurus lepturus

```{r 8.16, warning = FALSE}

# filtering data
species.8 <- FilteredSpecies %>% 
  filter(LatinNames == Top10names[8]) %>% 
  dplyr::select(-LatinNames)

# Running models
# 2 Predictors
tr.le.1a <- glm.nb(PropWeight ~ Month +
    TimePeriods,
  data = species.8)

tr.le.1b <- glm(PropWeight ~ Month +
    TimePeriods,
  family = negative.binomial(tr.le.1a$theta),
  data = species.8)

summary(tr.le.1b) # print summary

# 2 Predictors with 1 interaction term
tr.le.2a <- glm.nb(PropWeight ~ Month +
    TimePeriods +
    Month*TimePeriods,
  data = species.8)

tr.le.2b <- glm(PropWeight ~ Month +
    TimePeriods +
    Month*TimePeriods,
  family = negative.binomial(tr.le.2a$theta),
  data = species.8)

summary(tr.le.2b) # print summary

# 3 Predictors
tr.le.3a <- glm.nb(PropWeight ~ TimePeriods +
    FishingDepthMtr +
    FishingZones,
  data = species.8)

tr.le.3b <- glm(PropWeight ~ TimePeriods +
    FishingDepthMtr +
    FishingZones,
  family = negative.binomial(tr.le.3a$theta),
  data = species.8)

summary(tr.le.3b) # print summary

# 3 Predictors and 1 interaction term
tr.le.4a <- glm.nb(PropWeight ~ FishingDepthMtr +
    FishingZones +
    TimePeriods +
    TimePeriods*FishingZones,
  data = species.8)

tr.le.4b <- glm(PropWeight ~ FishingDepthMtr +
    FishingZones +
    TimePeriods +
    TimePeriods*FishingZones,
  family = negative.binomial(tr.le.4a$theta),
  data = species.8)

summary(tr.le.4b) # print summary

# 3 Predictors with 2 interaction term
tr.le.5a <- glm.nb(PropWeight ~ Month +
    TimePeriods +
    FishingDepthMtr +
    Month*TimePeriods +
    FishingDepthMtr*TimePeriods,
  data = species.8)

tr.le.5b <- glm(PropWeight ~ Month +
    TimePeriods +
    FishingDepthMtr +
    Month*TimePeriods +
    FishingDepthMtr*TimePeriods, 
  family = negative.binomial(tr.le.4a$theta),
  data = species.8)

summary(tr.le.5b) # print summary
```

#### Model Comparison

```{r 8.17}
(sum.tab.8 <- rcompanion::compareGLM(tr.le.1b,
  tr.le.2b,
  tr.le.3b,
  tr.le.4b,
  tr.le.5b))

# Best model = 3
# Factors = TimePeriods + FishingDepthMtr +     
# FishingZones
```

### 9. Achirus achirus

```{r 8.18, warning = FALSE}

# filtering data
species.9 <- FilteredSpecies %>% 
  filter(LatinNames == Top10names[9]) %>% 
  dplyr::select(-LatinNames)

# Running models
# 2 Predictors
ac.ac.1a <- glm.nb(PropWeight ~ Month +
    TimePeriods,
  data = species.9)

ac.ac.1b <- glm(PropWeight ~ Month +
    TimePeriods,
  family = negative.binomial(ac.ac.1a$theta),
  data = species.9)

summary(ac.ac.1b) # print summary

# 2 Predictors with 1 interaction term
ac.ac.2a <- glm.nb(PropWeight ~ Month +
    TimePeriods +
    Month*TimePeriods,
  data = species.9)

ac.ac.2b <- glm(PropWeight ~ Month +
    TimePeriods +
    Month*TimePeriods,
  family = negative.binomial(ac.ac.2a$theta),
  data = species.9)

summary(ac.ac.2b) # print summary

# 3 Predictors
ac.ac.3a <- glm.nb(PropWeight ~ TimePeriods +
    FishingDepthMtr +
    FishingZones,
  data = species.9)

ac.ac.3b <- glm(PropWeight ~ TimePeriods +
    FishingDepthMtr +
    FishingZones,
  family = negative.binomial(ac.ac.3a$theta),
  data = species.9)

summary(ac.ac.3b) # print summary

# 3 Predictors and 1 interaction term
ac.ac.4a <- glm.nb(PropWeight ~ FishingDepthMtr +
    FishingZones +
    TimePeriods +
    TimePeriods*FishingZones,
  data = species.9)

ac.ac.4b <- glm(PropWeight ~ FishingDepthMtr +
    FishingZones +
    TimePeriods +
    TimePeriods*FishingZones,
  family = negative.binomial(ac.ac.4a$theta),
  data = species.9)

summary(ac.ac.4b) # print summary

# 3 Predictors with 2 interaction term
ac.ac.5a <- glm.nb(PropWeight ~ Month +
    TimePeriods +
    FishingDepthMtr +
    Month*TimePeriods +
    FishingDepthMtr*TimePeriods,
  data = species.9)

ac.ac.5b <- glm(PropWeight ~ Month +
    TimePeriods +
    FishingDepthMtr +
    Month*TimePeriods +
    FishingDepthMtr*TimePeriods, 
  family = negative.binomial(ac.ac.4a$theta),
  data = species.9)

summary(ac.ac.5b) # print summary
```

#### Model Comparison

```{r 8.19}
(sum.tab.9 <- rcompanion::compareGLM(ac.ac.1b,
  ac.ac.2b,
  ac.ac.3b,
  ac.ac.4b,
  ac.ac.5b))

# Best model = 3
# Factors = TimePeriods + FishingDepthMtr +     
# FishingZones
```

### 10. Paralonchurus brasiliensis

```{r 8.20, warning = FALSE}

# filtering data
species.10 <- FilteredSpecies %>% 
  filter(LatinNames == Top10names[10]) %>% 
  dplyr::select(-LatinNames)

# Running models
# 2 Predictors
pa.br.1a <- glm.nb(PropWeight ~ Month +
    TimePeriods,
  data = species.10)

pa.br.1b <- glm(PropWeight ~ Month +
    TimePeriods,
  family = negative.binomial(pa.br.1a$theta),
  data = species.10)

summary(pa.br.1b) # print summary

# 2 Predictors with 1 interaction term
pa.br.2a <- glm.nb(PropWeight ~ Month +
    TimePeriods +
    Month*TimePeriods,
  data = species.10)

pa.br.2b <- glm(PropWeight ~ Month +
    TimePeriods +
    Month*TimePeriods,
  family = negative.binomial(pa.br.2a$theta),
  data = species.10)

summary(pa.br.2b) # print summary

# 3 Predictors
pa.br.3a <- glm.nb(PropWeight ~ TimePeriods +
    FishingDepthMtr +
    FishingZones,
  data = species.10)

pa.br.3b <- glm(PropWeight ~ TimePeriods +
    FishingDepthMtr +
    FishingZones,
  family = negative.binomial(pa.br.3a$theta),
  data = species.10)

summary(pa.br.3b) # print summary

# 3 Predictors and 1 interaction term
pa.br.4a <- glm.nb(PropWeight ~ FishingDepthMtr +
    FishingZones +
    TimePeriods +
    TimePeriods*FishingZones,
  data = species.10)

pa.br.4b <- glm(PropWeight ~ FishingDepthMtr +
    FishingZones +
    TimePeriods +
    TimePeriods*FishingZones,
  family = negative.binomial(pa.br.4a$theta),
  data = species.10)

summary(pa.br.4b) # print summary

# 3 Predictors with 2 interaction term
pa.br.5a <- glm.nb(PropWeight ~ Month +
    TimePeriods +
    FishingDepthMtr +
    Month*TimePeriods +
    FishingDepthMtr*TimePeriods,
  data = species.10)

pa.br.5b <- glm(PropWeight ~ Month +
    TimePeriods +
    FishingDepthMtr +
    Month*TimePeriods +
    FishingDepthMtr*TimePeriods, 
  family = negative.binomial(pa.br.4a$theta),
  data = species.10)

summary(pa.br.5b) # print summary
```

#### Model Comparison

```{r 8.21}

(sum.tab.10 <- rcompanion::compareGLM(pa.br.1b,
  pa.br.2b,
  pa.br.3b,
  pa.br.4b,
  pa.br.5b))

# (sum.tab.10 <- do.call(rbind, 
#   lapply(list(pa.br.1b,
#     pa.br.2b,
#     pa.br.3b,
#     pa.br.4b,
#     pa.br.5b),
#     broom::glance)))

# Best model = 3
# Factors = TimePeriods + FishingDepthMtr +     
# FishingZones
```

## Model Comparison - AIC{#id.81}

```{r 8.22, warning = FALSE}

Species <- Top10names

Model.1 <- c(ma.an.1b$aic, ca.or.1b$aic, st.ra.1b$aic, st.mi.1b$aic, cy.vi.1b$aic, sy.pl.1b$aic, ba.ba.1b$aic, tr.le.1b$aic, ac.ac.1b$aic, pa.br.1b$aic)

Model.2 <- c(ma.an.2b$aic, ca.or.2b$aic, st.ra.2b$aic, st.mi.2b$aic, cy.vi.2b$aic, sy.pl.2b$aic, ba.ba.2b$aic, tr.le.2b$aic, ac.ac.2b$aic, pa.br.2b$aic)

Model.3 <- c(ma.an.3b$aic, ca.or.3b$aic, st.ra.3b$aic, st.mi.3b$aic, cy.vi.3b$aic, sy.pl.3b$aic, ba.ba.3b$aic, tr.le.3b$aic, ac.ac.3b$aic, pa.br.3b$aic)

Model.4 <- c(ma.an.4b$aic, ca.or.4b$aic, st.ra.4b$aic, st.mi.4b$aic, cy.vi.4b$aic, sy.pl.4b$aic, ba.ba.4b$aic, tr.le.4b$aic, ac.ac.4b$aic, pa.br.4b$aic)

Model.5 <- c(ma.an.5b$aic, ca.or.5b$aic, st.ra.5b$aic, st.mi.5b$aic, cy.vi.5b$aic, sy.pl.5b$aic, ba.ba.5b$aic, tr.le.5b$aic, ac.ac.5b$aic, pa.br.5b$aic)


nb.comparison.table <- data.frame(Species,
  Model.1,
  Model.2,
  Model.3, 
  Model.4, 
  Model.5) %>% 
  mutate_if(is.numeric,
    round, 3) 

nb.comparison.table.2 <- nb.comparison.table %>%
  gather(Models, val, 2:ncol(nb.comparison.table)) %>%
  spread(Species, val) %>% 
  arrange(Models)

nb.comparison.table.2 <- nb.comparison.table.2[c("Models",
"Macrodon ancylodon",        
"Callinectes ornatus",       
"Stellifer rastrifer",       
"Stellifer microps",         
"Cynoscion virescens",       
"Symphurus plagusia",        
"Bagre bagre",               
"Trichiurus lepturus",       
"Achirus achirus",           
"Paralonchurus brasiliensis")]

nb.comparison.table.2 [1:5, 1:11] %>%
  mutate(`Macrodon ancylodon` = cell_spec(`Macrodon ancylodon`, background = ifelse(`Macrodon ancylodon` == min(`Macrodon ancylodon`), "yellow", " "))) %>% 
  mutate(`Callinectes ornatus` = cell_spec(`Callinectes ornatus`, background = ifelse(`Callinectes ornatus` == min(`Callinectes ornatus`), "yellow", " "))) %>% 
  mutate(`Stellifer rastrifer` = cell_spec(`Stellifer rastrifer`, background = ifelse(`Stellifer rastrifer` == min(`Stellifer rastrifer`), "yellow", " "))) %>% 
  mutate(`Stellifer microps` = cell_spec(`Stellifer microps`, background = ifelse(`Stellifer microps` == min(`Stellifer microps`), "yellow", " "))) %>% 
  mutate(`Cynoscion virescens` = cell_spec(`Cynoscion virescens`, background = ifelse(`Cynoscion virescens` == min(`Cynoscion virescens`), "yellow", " "))) %>% 
  mutate(`Symphurus plagusia` = cell_spec(`Symphurus plagusia`, background = ifelse(`Symphurus plagusia` == min(`Symphurus plagusia`), "yellow", " "))) %>% 
  mutate(`Bagre bagre` = cell_spec(`Bagre bagre`, background = ifelse(`Bagre bagre` == min(`Bagre bagre`), "yellow", " "))) %>% 
  mutate(`Trichiurus lepturus` = cell_spec(`Trichiurus lepturus`, background = ifelse(`Trichiurus lepturus` == min(`Trichiurus lepturus`), "yellow", " "))) %>% 
  mutate(`Achirus achirus` = cell_spec(`Achirus achirus`, background = ifelse(`Achirus achirus` == min(`Achirus achirus`), "yellow", " "))) %>% 
  mutate(`Paralonchurus brasiliensis` = cell_spec(`Paralonchurus brasiliensis`, background = ifelse(`Paralonchurus brasiliensis` == min(`Paralonchurus brasiliensis`), "yellow", " "))) %>% 
  kbl(caption = "Comparison of Negative Binomial Model Results for the Top 10 bycatch species",
    booktabs = T, linesep = "", escape = FALSE, format = "html") %>% 
  add_header_above(c(" " = 1, "Model AIC Values" = 10)) %>% 
  kable_paper(full_width = F) %>%
  kable_styling(fixed_thead = T,
    bootstrap_options = c("striped", "condensed")) %>% 
  column_spec(2:10, color = "black") %>%
  footnote(general = "The models with the lowest AIC are colored yellow.",
    number = c("Model.One = Month + TimePeriods", 
      "Model.Two = Month + TimePeriods + Month*TimePeriods",
      "Model.Three = TimePeriods + FishingDepthMtr +    FishingZones",
      "Model.Four = FishingDepthMtr + FishingZones +    TimePeriods + TimePeriods*FishingZones",
      "Model.Five = Month + TimePeriods + FishingDepthMtr +     Month*TimePeriods + FishingDepthMtr*TimePeriods")) %>% 
  row_spec(which(nb.comparison.table.2[,2] == min()), bold = T, color = "white", background = "red") %>% scroll_box(width = "750px", height = "600px")

```

## Model Comparison - P.values{#id.82}

```{r 8.23, warning = FALSE}

Models <- c("Model.1",
  "Model.2",
  "Model.3", 
  "Model.4", 
  "Model.5")

Species.1 <- c(sum.tab.1$Fit.criteria$p.value[1],
  sum.tab.1$Fit.criteria$p.value[2],
  sum.tab.1$Fit.criteria$p.value[3],
  sum.tab.1$Fit.criteria$p.value[4],
  sum.tab.1$Fit.criteria$p.value[5])

Species.2 <- c(sum.tab.2$Fit.criteria$p.value[1],
  sum.tab.2$Fit.criteria$p.value[2],
  sum.tab.2$Fit.criteria$p.value[3],
  sum.tab.2$Fit.criteria$p.value[4],
  sum.tab.2$Fit.criteria$p.value[5])

Species.3 <- c(sum.tab.3$Fit.criteria$p.value[1],
  sum.tab.3$Fit.criteria$p.value[2],
  sum.tab.3$Fit.criteria$p.value[3],
  sum.tab.3$Fit.criteria$p.value[4],
  sum.tab.3$Fit.criteria$p.value[5])

Species.4 <- c(sum.tab.4$Fit.criteria$p.value[1],
  sum.tab.4$Fit.criteria$p.value[2],
  sum.tab.4$Fit.criteria$p.value[3],
  sum.tab.4$Fit.criteria$p.value[4],
  sum.tab.4$Fit.criteria$p.value[5])

Species.5 <- c(sum.tab.5$Fit.criteria$p.value[1],
  sum.tab.5$Fit.criteria$p.value[2],
  sum.tab.5$Fit.criteria$p.value[3],
  sum.tab.5$Fit.criteria$p.value[4],
  sum.tab.5$Fit.criteria$p.value[5])

Species.6 <- c(sum.tab.6$Fit.criteria$p.value[1],
  sum.tab.6$Fit.criteria$p.value[2],
  sum.tab.6$Fit.criteria$p.value[3],
  sum.tab.6$Fit.criteria$p.value[4],
  sum.tab.6$Fit.criteria$p.value[5])

Species.7 <- c(sum.tab.7$Fit.criteria$p.value[1],
  sum.tab.7$Fit.criteria$p.value[2],
  sum.tab.7$Fit.criteria$p.value[3],
  sum.tab.7$Fit.criteria$p.value[4],
  sum.tab.7$Fit.criteria$p.value[5])

Species.8 <- c(sum.tab.8$Fit.criteria$p.value[1],
  sum.tab.8$Fit.criteria$p.value[2],
  sum.tab.8$Fit.criteria$p.value[3],
  sum.tab.8$Fit.criteria$p.value[4],
  sum.tab.8$Fit.criteria$p.value[5])

Species.9 <- c(sum.tab.9$Fit.criteria$p.value[1],
  sum.tab.9$Fit.criteria$p.value[2],
  sum.tab.9$Fit.criteria$p.value[3],
  sum.tab.9$Fit.criteria$p.value[4],
  sum.tab.9$Fit.criteria$p.value[5])

Species.10 <- c(sum.tab.10$Fit.criteria$p.value[1],
  sum.tab.10$Fit.criteria$p.value[2],
  sum.tab.10$Fit.criteria$p.value[3],
  sum.tab.10$Fit.criteria$p.value[4],
  sum.tab.10$Fit.criteria$p.value[5])


nb.2.comparison.table <- data.frame(Models,
  Species.1,
  Species.2,
  Species.3,
  Species.4,
  Species.5,
  Species.6,
  Species.7,
  Species.8,
  Species.9,
  Species.10) %>% 
  mutate_if(is.numeric,
    round, 6) 

nb.2.comparison.table [1:5, 1:11] %>%
  mutate(Species.1 = cell_spec(Species.1, background = ifelse(Species.1 == min(Species.1), "yellow", " "))) %>% 
  mutate(Species.2 = cell_spec(Species.2 , background = ifelse(Species.2  == min(Species.2 ), "yellow", " "))) %>% 
  mutate(Species.3 = cell_spec(Species.3, background = ifelse(Species.3 == min(Species.3), "yellow", " "))) %>% 
  mutate(Species.4 = cell_spec(Species.4, background = ifelse(Species.4 == min(Species.4), "yellow", " "))) %>% 
  mutate(Species.5 = cell_spec(Species.5, background = ifelse(Species.5 == min(Species.5), "yellow", " "))) %>% 
  mutate(Species.6 = cell_spec(Species.6, background = ifelse(Species.6 == min(Species.6), "yellow", " "))) %>% 
  mutate(Species.7 = cell_spec(Species.7, background = ifelse(Species.7 == min(Species.7), "yellow", " "))) %>% 
  mutate(Species.8 = cell_spec(Species.8, background = ifelse(Species.8 == min(Species.8), "yellow", " "))) %>% 
  mutate(Species.9 = cell_spec(Species.9, background = ifelse(Species.9 == min(Species.9), "yellow", " "))) %>% 
  mutate(Species.10 = cell_spec(Species.10, background = ifelse(Species.10 == min(Species.10), "yellow", " "))) %>% 
  kbl(caption = "Comparison of Negative Binomial Model Results for the Top 10 bycatch species",
    booktabs = T, linesep = "", escape = FALSE,col.names = c("Models", "Macrodon ancylodon",        
"Callinectes ornatus",       
"Stellifer rastrifer",       
"Stellifer microps",         
"Cynoscion virescens",       
"Symphurus plagusia",        
"Bagre bagre",               
"Trichiurus lepturus",       
"Achirus achirus",           
"Paralonchurus brasiliensis")) %>% 
  add_header_above(c(" " = 1, "Model P-values" = 10)) %>% 
  kable_paper(full_width = F) %>%
  kable_styling(fixed_thead = T,
    bootstrap_options = c("striped", "condensed")) %>% 
  column_spec(2:10, color = "black") %>%
  footnote(general = "The models with the lowest A
    p-values are colored yellow.",
    number = c("Model.One = Month + TimePeriods", 
      "Model.Two = Month + TimePeriods + Month*TimePeriods",
      "Model.Three = TimePeriods + FishingDepthMtr +    FishingZones",
      "Model.Four = FishingDepthMtr + FishingZones +    TimePeriods + TimePeriods*FishingZones",
      "Model.Five = Month + TimePeriods + FishingDepthMtr +     Month*TimePeriods + FishingDepthMtr*TimePeriods")) %>% scroll_box(width = "750px", height = "600px")

```

## Binomial Model Selection{#id.83}

### Data modifications R

```{r 8.24}

# Reshaping data - wide format by tows and changing species value to binomial 
FilteredSpecies2 <- FilteredSpecies %>%
  pivot_wider(names_from = LatinNames,
    values_from = PropWeight,
    values_fill = 0) %>% 
  mutate(`Macrodon ancylodon` = ifelse(`Macrodon ancylodon` > 0,"present","absent")) %>% 
  mutate(`Callinectes ornatus` = ifelse(`Callinectes ornatus` > 0,"present","absent")) %>% 
  mutate(`Stellifer rastrifer` = ifelse(`Stellifer rastrifer` > 0,"present","absent")) %>% 
  mutate(`Stellifer microps` = ifelse(`Stellifer microps` > 0,"present","absent")) %>% 
  mutate(`Cynoscion virescens` = ifelse(`Cynoscion virescens` > 0,"present","absent")) %>% 
  mutate(`Symphurus plagusia` = ifelse(`Symphurus plagusia` > 0,"present","absent")) %>% 
  mutate(`Bagre bagre` = ifelse(`Bagre bagre` > 0,"present","absent")) %>% 
  mutate(`Trichiurus lepturus` = ifelse(`Trichiurus lepturus` > 0,"present","absent")) %>% 
  mutate(`Achirus achirus` = ifelse(`Achirus achirus` > 0,"present","absent")) %>% 
  mutate(`Paralonchurus brasiliensis` = ifelse(`Paralonchurus brasiliensis` > 0,"present","absent"))

FilteredSpecies2[,Top10names] <- lapply(FilteredSpecies2[,Top10names], factor)

head(FilteredSpecies2) %>% 
  kbl() %>%
  kable_classic() %>% 
  row_spec(0, bold = TRUE) %>% 
  kable_styling(fixed_thead = T,
    bootstrap_options = "condensed") %>% 
  scroll_box(width = "750px", height = "300px")
```

### Running models on Top 10 discard species

### 1. Macrodon ancylodon

```{r 8.25, warning = FALSE}

# 2 Predictors
ma.an.1 <- glm(`Macrodon ancylodon` ~ Month +
    TimePeriods,
  family = binomial,
  data = FilteredSpecies2)

summary(ma.an.1) # print summary

# 2 Predictors with 1 interaction term
ma.an.2 <- glm(`Macrodon ancylodon` ~ Month +
    TimePeriods +
    Month*TimePeriods,
  family = binomial,
  data = FilteredSpecies2)

summary(ma.an.2) # print summary

# 3 Predictors
ma.an.3 <- glm(`Macrodon ancylodon` ~ TimePeriods +
    FishingDepthMtr +
    FishingZones,
  family = binomial,
  data = FilteredSpecies2)

summary(ma.an.3) # print summary

# 3 Predictors and 1 interaction term
ma.an.4 <- glm(`Macrodon ancylodon` ~ FishingDepthMtr +
    FishingZones +
    TimePeriods +
    TimePeriods*FishingZones,
  family = binomial,
  data = FilteredSpecies2)

summary(ma.an.4) # print summary

# 3 Predictors with 2 interaction term
ma.an.5 <- glm(`Macrodon ancylodon` ~ Month +
    TimePeriods +
    FishingDepthMtr +
    Month*TimePeriods +
    FishingDepthMtr*TimePeriods,
  family = binomial,
  data = FilteredSpecies2)

summary(ma.an.5) # print summary
```

#### Model Comparison

```{r 8.26}
rcompanion::compareGLM(ma.an.1,
  ma.an.2,
  ma.an.3,
  ma.an.4,
  ma.an.5)

# Best model = 3
# Factors = TimePeriods + FishingDepthMtr +     
# FishingZones
```

### 2. Callinectes ornatus

```{r 8.27, warning = FALSE}

# 2 Predictors
ca.or.1 <- glm(`Callinectes ornatus` ~ Month +
    TimePeriods,
  family = binomial,
  data = FilteredSpecies2)

summary(ca.or.1) # print summary

# 2 Predictors with 1 interaction term
ca.or.2 <- glm(`Callinectes ornatus` ~ Month +
    TimePeriods +
    Month*TimePeriods,
  family = binomial,
  data = FilteredSpecies2)

summary(ca.or.2) # print summary

# 3 Predictors
ca.or.3 <- glm(`Callinectes ornatus` ~ TimePeriods +
    FishingDepthMtr +
    FishingZones,
  family = binomial,
  data = FilteredSpecies2)

summary(ca.or.3) # print summary

# 3 Predictors and 1 interaction term
ca.or.4 <- glm(`Callinectes ornatus` ~ FishingDepthMtr +
    FishingZones +
    TimePeriods +
    TimePeriods*FishingZones,
  family = binomial,
  data = FilteredSpecies2)

summary(ca.or.4) # print summary

# 3 Predictors with 2 interaction term
ca.or.5 <- glm(`Callinectes ornatus` ~ Month +
    TimePeriods +
    FishingDepthMtr +
    Month*TimePeriods +
    FishingDepthMtr*TimePeriods,
  family = binomial,
  data = FilteredSpecies2)

summary(ca.or.5) # print summary
```

#### Model Comparison

```{r 8.28}
rcompanion::compareGLM(ca.or.1,
  ca.or.2,
  ca.or.3,
  ca.or.4,
  ca.or.5)

# Best model = 3
# Factors = TimePeriods + FishingDepthMtr +     
# FishingZones
```

### 3. Stellifer rastrifer

```{r 8.29, warning = FALSE}

# 2 Predictors
st.ra.1 <- glm(`Stellifer rastrifer` ~ Month +
    TimePeriods,
  family = binomial,
  data = FilteredSpecies2)

summary(st.ra.1) # print summary

# 2 Predictors with 1 interaction term
st.ra.2 <- glm(`Stellifer rastrifer` ~ Month +
    TimePeriods +
    Month*TimePeriods,
  family = binomial,
  data = FilteredSpecies2)

summary(st.ra.2) # print summary

# 3 Predictors
st.ra.3 <- glm(`Stellifer rastrifer` ~ TimePeriods +
    FishingDepthMtr +
    FishingZones,
  family = binomial,
  data = FilteredSpecies2)

summary(st.ra.3) # print summary

# 3 Predictors and 1 interaction term
st.ra.4 <- glm(`Stellifer rastrifer` ~ FishingDepthMtr +
    FishingZones +
    TimePeriods +
    TimePeriods*FishingZones,
  family = binomial,
  data = FilteredSpecies2)

summary(st.ra.4) # print summary

# 3 Predictors with 2 interaction term
st.ra.5 <- glm(`Stellifer rastrifer` ~ Month +
    TimePeriods +
    FishingDepthMtr +
    Month*TimePeriods +
    FishingDepthMtr*TimePeriods,
  family = binomial,
  data = FilteredSpecies2)

summary(st.ra.5) # print summary
```

#### Model Comparison

```{r 8.30}
rcompanion::compareGLM(st.ra.1,
  st.ra.2,
  st.ra.3,
  st.ra.4,
  st.ra.5)

# Best model = 3
# Factors = TimePeriods + FishingDepthMtr +     
# FishingZones
```

### 4. Stellifer microps

```{r 8.31, warning = FALSE}

# 2 Predictors
st.mi.1 <- glm(`Stellifer microps` ~ Month +
    TimePeriods,
  family = binomial,
  data = FilteredSpecies2)

summary(st.mi.1) # print summary

# 2 Predictors with 1 interaction term
st.mi.2 <- glm(`Stellifer microps` ~ Month +
    TimePeriods +
    Month*TimePeriods,
  family = binomial,
  data = FilteredSpecies2)

summary(st.mi.2) # print summary

# 3 Predictors
st.mi.3 <- glm(`Stellifer microps` ~ TimePeriods +
    FishingDepthMtr +
    FishingZones,
  family = binomial,
  data = FilteredSpecies2)

summary(st.mi.3) # print summary

# 3 Predictors and 1 interaction term
st.mi.4 <- glm(`Stellifer microps` ~ FishingDepthMtr +
    FishingZones +
    TimePeriods +
    TimePeriods*FishingZones,
  family = binomial,
  data = FilteredSpecies2)

summary(st.mi.4) # print summary

# 3 Predictors with 2 interaction term
st.mi.5 <- glm(`Stellifer microps` ~ Month +
    TimePeriods +
    FishingDepthMtr +
    Month*TimePeriods +
    FishingDepthMtr*TimePeriods,
  family = binomial,
  data = FilteredSpecies2)

summary(st.mi.5) # print summary
```

#### Model Comparison

```{r 8.32}
rcompanion::compareGLM(st.mi.1,
  st.mi.2,
  st.mi.3,
  st.mi.4,
  st.mi.5)

# Best model = 3
# Factors = TimePeriods + FishingDepthMtr +     
# FishingZones
```

### 5. Cynoscion virescens

```{r 8.33, warning = FALSE}

# 2 Predictors
cy.vi.1 <- glm(`Cynoscion virescens` ~ Month +
    TimePeriods,
  family = binomial,
  data = FilteredSpecies2)

summary(cy.vi.1) # print summary

# 2 Predictors with 1 interaction term
cy.vi.2 <- glm(`Cynoscion virescens` ~ Month +
    TimePeriods +
    Month*TimePeriods,
  family = binomial,
  data = FilteredSpecies2)

summary(cy.vi.2) # print summary

# 3 Predictors
cy.vi.3 <- glm(`Cynoscion virescens` ~ TimePeriods +
    FishingDepthMtr +
    FishingZones,
  family = binomial,
  data = FilteredSpecies2)

summary(cy.vi.3) # print summary

# 3 Predictors and 1 interaction term
cy.vi.4 <- glm(`Cynoscion virescens` ~ FishingDepthMtr +
    FishingZones +
    TimePeriods +
    TimePeriods*FishingZones,
  family = binomial,
  data = FilteredSpecies2)

summary(cy.vi.4) # print summary

# 3 Predictors with 2 interaction term
cy.vi.5 <- glm(`Cynoscion virescens` ~ Month +
    TimePeriods +
    FishingDepthMtr +
    Month*TimePeriods +
    FishingDepthMtr*TimePeriods,
  family = binomial,
  data = FilteredSpecies2)

summary(cy.vi.5) # print summary
```

#### Model Comparison

```{r 8.34}
rcompanion::compareGLM(cy.vi.1,
  cy.vi.2,
  cy.vi.3,
  cy.vi.4,
  cy.vi.5)

# Best model = 3
# Factors = TimePeriods + FishingDepthMtr +     
# FishingZones
```

### 6. Symphurus plagusia

```{r 8.35, warning = FALSE}

# 2 Predictors
sy.pl.1 <- glm(`Symphurus plagusia` ~ Month +
    TimePeriods,
  family = binomial,
  data = FilteredSpecies2)

summary(sy.pl.1) # print summary

# 2 Predictors with 1 interaction term
sy.pl.2 <- glm(`Symphurus plagusia` ~ Month +
    TimePeriods +
    Month*TimePeriods,
  family = binomial,
  data = FilteredSpecies2)

summary(sy.pl.2) # print summary

# 3 Predictors
sy.pl.3 <- glm(`Symphurus plagusia` ~ TimePeriods +
    FishingDepthMtr +
    FishingZones,
  family = binomial,
  data = FilteredSpecies2)

summary(sy.pl.3) # print summary

# 3 Predictors and 1 interaction term
sy.pl.4 <- glm(`Symphurus plagusia` ~ FishingDepthMtr +
    FishingZones +
    TimePeriods +
    TimePeriods*FishingZones,
  family = binomial,
  data = FilteredSpecies2)

summary(sy.pl.4) # print summary

# 3 Predictors with 2 interaction term
sy.pl.5 <- glm(`Symphurus plagusia` ~ Month +
    TimePeriods +
    FishingDepthMtr +
    Month*TimePeriods +
    FishingDepthMtr*TimePeriods,
  family = binomial,
  data = FilteredSpecies2)

summary(sy.pl.5) # print summary
```

#### Model Comparison

```{r 8.36}
rcompanion::compareGLM(sy.pl.1,
  sy.pl.2,
  sy.pl.3,
  sy.pl.4,
  sy.pl.5)

# Best model = 3
# Factors = TimePeriods + FishingDepthMtr +     
# FishingZones
```

### 7. Bagre bagre

```{r 8.37, warning = FALSE}

# 2 Predictors
ba.ba.1 <- glm(`Bagre bagre` ~ Month +
    TimePeriods,
  family = binomial,
  data = FilteredSpecies2)

summary(ba.ba.1) # print summary

# 2 Predictors with 1 interaction term
ba.ba.2 <- glm(`Bagre bagre` ~ Month +
    TimePeriods +
    Month*TimePeriods,
  family = binomial,
  data = FilteredSpecies2)

summary(ba.ba.2) # print summary

# 3 Predictors
ba.ba.3 <- glm(`Bagre bagre` ~ TimePeriods +
    FishingDepthMtr +
    FishingZones,
  family = binomial,
  data = FilteredSpecies2)

summary(ba.ba.3) # print summary

# 3 Predictors and 1 interaction term
ba.ba.4 <- glm(`Bagre bagre` ~ FishingDepthMtr +
    FishingZones +
    TimePeriods +
    TimePeriods*FishingZones,
  family = binomial,
  data = FilteredSpecies2)

summary(ba.ba.4) # print summary

# 3 Predictors with 2 interaction term
ba.ba.5 <- glm(`Bagre bagre` ~ Month +
    TimePeriods +
    FishingDepthMtr +
    Month*TimePeriods +
    FishingDepthMtr*TimePeriods,
  family = binomial,
  data = FilteredSpecies2)

summary(ba.ba.5) # print summary
```

#### Model Comparison

```{r 8.38}
rcompanion::compareGLM(ba.ba.1,
  ba.ba.2,
  ba.ba.3,
  ba.ba.4,
  ba.ba.5)

# Best model = 3
# Factors = TimePeriods + FishingDepthMtr +     
# FishingZones
```

### 8. Trichiurus lepturus

```{r 8.39, warning = FALSE}

# 2 Predictors
tr.le.1 <- glm(`Trichiurus lepturus` ~ Month +
    TimePeriods,
  family = binomial,
  data = FilteredSpecies2)

summary(tr.le.1) # print summary

# 2 Predictors with 1 interaction term
tr.le.2 <- glm(`Trichiurus lepturus` ~ Month +
    TimePeriods +
    Month*TimePeriods,
  family = binomial,
  data = FilteredSpecies2)

summary(tr.le.2) # print summary

# 3 Predictors
tr.le.3 <- glm(`Trichiurus lepturus` ~ TimePeriods +
    FishingDepthMtr +
    FishingZones,
  family = binomial,
  data = FilteredSpecies2)

summary(tr.le.3) # print summary

# 3 Predictors and 1 interaction term
tr.le.4 <- glm(`Trichiurus lepturus` ~ FishingDepthMtr +
    FishingZones +
    TimePeriods +
    TimePeriods*FishingZones,
  family = binomial,
  data = FilteredSpecies2)

summary(tr.le.4) # print summary

# 3 Predictors with 2 interaction term
tr.le.5 <- glm(`Trichiurus lepturus` ~ Month +
    TimePeriods +
    FishingDepthMtr +
    Month*TimePeriods +
    FishingDepthMtr*TimePeriods,
  family = binomial,
  data = FilteredSpecies2)

summary(tr.le.5) # print summary
```

#### Model Comparison

```{r 8.40}
rcompanion::compareGLM(tr.le.1,
  tr.le.2,
  tr.le.3,
  tr.le.4,
  tr.le.5)

# Best model = 3
# Factors = TimePeriods + FishingDepthMtr +     
# FishingZones
```

### 9. Achirus achirus

```{r 8.41, warning = FALSE}

# 2 Predictors
ac.ac.1 <- glm(`Achirus achirus` ~ Month +
    TimePeriods,
  family = binomial,
  data = FilteredSpecies2)

summary(ac.ac.1) # print summary

# 2 Predictors with 1 interaction term
ac.ac.2 <- glm(`Achirus achirus` ~ Month +
    TimePeriods +
    Month*TimePeriods,
  family = binomial,
  data = FilteredSpecies2)

summary(ac.ac.2) # print summary

# 3 Predictors
ac.ac.3 <- glm(`Achirus achirus` ~ TimePeriods +
    FishingDepthMtr +
    FishingZones,
  family = binomial,
  data = FilteredSpecies2)

summary(ac.ac.3) # print summary

# 3 Predictors and 1 interaction term
ac.ac.4 <- glm(`Achirus achirus` ~ FishingDepthMtr +
    FishingZones +
    TimePeriods +
    TimePeriods*FishingZones,
  family = binomial,
  data = FilteredSpecies2)

summary(ac.ac.4) # print summary

# 3 Predictors with 2 interaction term
ac.ac.5 <- glm(`Achirus achirus` ~ Month +
    TimePeriods +
    FishingDepthMtr +
    Month*TimePeriods +
    FishingDepthMtr*TimePeriods,
  family = binomial,
  data = FilteredSpecies2)

summary(ac.ac.5) # print summary
```

#### Model Comparison

```{r 8.42}
rcompanion::compareGLM(ac.ac.1,
  ac.ac.2,
  ac.ac.3,
  ac.ac.4,
  ac.ac.5)

# Best model = 3
# Factors = TimePeriods + FishingDepthMtr +     
# FishingZones
```

### 10. Paralonchurus brasiliensis

```{r 8.43, warning = FALSE}

# 2 Predictors
pa.br.1 <- glm(`Paralonchurus brasiliensis` ~ Month +
    TimePeriods,
  family = binomial,
  data = FilteredSpecies2)

summary(pa.br.1) # print summary

# 2 Predictors with 1 interaction term
pa.br.2 <- glm(`Paralonchurus brasiliensis` ~ Month +
    TimePeriods +
    Month*TimePeriods,
  family = binomial,
  data = FilteredSpecies2)

summary(pa.br.2) # print summary

# 3 Predictors
pa.br.3 <- glm(`Paralonchurus brasiliensis` ~ TimePeriods +
    FishingDepthMtr +
    FishingZones,
  family = binomial,
  data = FilteredSpecies2)

summary(pa.br.3) # print summary

# 3 Predictors and 1 interaction term
pa.br.4 <- glm(`Paralonchurus brasiliensis` ~ FishingDepthMtr +
    FishingZones +
    TimePeriods +
    TimePeriods*FishingZones,
  family = binomial,
  data = FilteredSpecies2)

summary(pa.br.4) # print summary

# 3 Predictors with 2 interaction term
pa.br.5 <- glm(`Paralonchurus brasiliensis` ~ Month +
    TimePeriods +
    FishingDepthMtr +
    Month*TimePeriods +
    FishingDepthMtr*TimePeriods,
  family = binomial,
  data = FilteredSpecies2)

summary(pa.br.5) # print summary
```

#### Model Comparison

```{r 8.44}
rcompanion::compareGLM(pa.br.1,
  pa.br.2,
  pa.br.3,
  pa.br.4,
  pa.br.5)

# Best model = 3
# Factors = TimePeriods + FishingDepthMtr +     
# FishingZones
```

### Summary
Models 3 was always selected as the best model. 


```{r 8.45, eval = FALSE, error = FALSE, include = FALSE}
<!-- # Alternative Model Selection -->
  
  <!-- ## CPUE -->
  
  <!-- ### Full model - Without Interactions -->
  
  <!-- ```{r 8.1} -->
  <!-- # Model 1 -->
  <!-- cpue.model.1 <- glm(CpueKGHr ~ ., -->
      <!--   family = gaussian, -->
      <!--   data = target.catch.cpue.2) -->
  
  <!-- # Backward elimination method -->
  <!-- step(cpue.model.1, direction = "backward") -->
  <!-- ``` -->
  
  <!-- ### Full model - With Interactions -->
  
  <!-- ```{r 8.2} -->
  <!-- # Model 2  -->
  <!-- cpue.model.2 <- glm(CpueKGHr ~ (.)^2, -->
      <!--   family = gaussian(link = "log"), -->
      <!--   data = target.catch.cpue.2) -->
  
  <!-- # Backward elimination -->
  <!-- step(cpue.model.2, scope = formula(cpue.model.2), direction = 'backward') -->
  <!-- ``` -->
  
  <!-- ## Weight prop. -->
  
  <!-- ### Full model - Without Interactions -->
  
  <!-- ```{r 8.3} -->
  <!-- # Model 1 -->
  <!-- prop.model.1 <- glm(PropWeight ~ ., -->
      <!--   family = gaussian, -->
      <!--   data = target.catch.prop.2) -->
  
  <!-- # Backward elimination -->
  <!-- step(prop.model.1, direction = "backward") -->
  <!-- ``` -->
  
  <!-- ### Full model - With Interactions -->
  
  <!-- ```{r 8.4} -->
  <!-- # Model 2  -->
  <!-- prop.model.2 <- glm(PropWeight ~ (.)^2, -->
      <!--   family = gaussian, -->
      <!--   data = target.catch.prop.2) -->
  
  <!-- # Backward elimination method -->
  <!-- step(prop.model.2, scope = formula(prop.model.2), direction = 'backward') -->
  <!-- ``` -->
  
  
  <!-- ## More messing around - Forward Selection -->
  
  <!-- ```{r 8.5} -->
  <!-- # Creating a NULL model -->
  <!-- first.step <- glm(PropWeight ~ 1, data = target.catch.prop.2) -->
  
  <!-- # Creating a FULL model -->
  <!-- fit.all <- glm(PropWeight ~ (.)^2, -->
      <!--   family = gaussian, -->
      <!--   data = target.catch.prop.2) -->
  
  <!-- # Backward model selection -->
  <!-- step(first.step, direction = "forward", scope = formula(fit.all)) -->
  <!-- ``` -->
  
  
  <!-- ## Individual species example - Species 1 -->
  
  <!-- ### Full model - Without Interactions -->
  
  <!-- ```{r 8.6} -->
  <!-- # Removing DragID from data -->
  <!-- species.1.tmp <- species.1 %>%  -->
  <!--   select(-DragID2) -->
  
  <!-- # Model 1 -->
  <!-- ma.model.1 <- glm(PropWeight ~ ., -->
      <!--   family = gaussian, -->
      <!--   data = species.1.tmp) -->
  
  <!-- # Backward elimination -->
  <!-- step(ma.model.1, direction = "backward") -->
  <!-- ``` -->
  
  <!-- ### Full model - With Interactions -->
  
  <!-- ```{r 8.7} -->
  <!-- # Model 2  -->
  <!-- ma.model.2 <- glm(PropWeight ~ (.)^2, -->
      <!--   family = gaussian, -->
      <!--   data = species.1.tmp) -->
  
  <!-- # Backward elimination method -->
  <!-- step(ma.model.2, scope = formula(ma.model.2), direction = 'backward') -->
  
  
  <!-- # summary(glm(CpueKGHR ~ Month + TimePeriods + FishingZones + FishingDepthMtr +  -->
  <!-- #     Month:TimePeriods + Month:FishingDepthMtr + TimePeriods:FishingZones +  -->
  <!-- #     TimePeriods:FishingDepthMtr, -->
  <!-- #   family = gaussian, -->
  <!-- #   data = species.1.tmp));interaction.plot(species.1$TimePeriods, species.1$FishingZones, species.1$CpueKGHR);table(species.1$TimePeriods, species.1$FishingZones) -->
  <!-- ``` -->
  
  
  <!-- ## More messing around - Forward Selection -->
  
  <!-- ```{r 8.8} -->
  <!-- # Creating a NULL model -->
  <!-- first.step <- glm(PropWeight ~ 1, data = species.1.tmp) -->
  
  <!-- # Creating a FULL model -->
  <!-- fit.all <- glm(PropWeight ~ (.)^2, -->
      <!--   family = gaussian, -->
      <!--   data = species.1.tmp) -->
  
  <!-- # Backward model selection -->
  <!-- step(first.step, direction = "forward", scope = formula(fit.all)) -->
  <!-- ``` -->
  
  
  <!-- ## Individual species example - Species 4 -->
  
  <!-- ### Full model - Without Interactions -->
  
  <!-- ```{r 8.9} -->
  <!-- # Removing DragID from data -->
  <!-- species.4.tmp <- species.4  -->
  
  <!-- # Model 1 -->
  <!-- sm.model.1 <- glm(PropWeight ~ ., -->
      <!--   family = gaussian, -->
      <!--   data = species.4.tmp) -->
  
  <!-- # Backward elimination -->
  <!-- step(sm.model.1, direction = "backward") -->
  <!-- ``` -->
  
  <!-- ### Full model - With Interactions -->
  
  <!-- ```{r 8.10} -->
  <!-- # Model 2  -->
  <!-- sm.model.2 <- glm(PropWeight ~ (.)^2, -->
      <!--   family = gaussian, -->
      <!--   data = species.4.tmp) -->
  
  <!-- # Backward elimination method -->
  <!-- step(sm.model.2, scope = formula(sm.model.2), direction = 'backward') -->
  
  <!-- # # Model 2  -->
  <!-- # sm.model.2 <- glm(CpueKGHR ~ (.)^2, -->
  <!-- #   family = gaussian, -->
  <!-- #   data = species.1) -->
  <!-- ``` -->
  
  
  <!-- ## More messing around - Forward Selection -->
  
  <!-- ```{r 8.11} -->
  <!-- # Creating a NULL model -->
  <!-- first.step <- glm(PropWeight ~ 1, data = species.4.tmp) -->
  
  <!-- # Creating a FULL model -->
  <!-- fit.all <- glm(PropWeight ~ (.)^2, -->
      <!--   family = gaussian, -->
      <!--   data = species.4.tmp) -->
  
  <!-- # Backward model selection -->
  <!-- step(first.step, direction = "forward", scope = formula(fit.all)) -->
  <!-- ``` -->
  
  
  <!-- ```{r 8.12, echo = FALSE} -->
  <!-- a <- glm(PropWeight ~ Month + TimePeriods + FishingZones + FishingDepthMtr + -->
      <!--     Month:TimePeriods + Month:FishingDepthMtr + TimePeriods:FishingZones + -->
      <!--     TimePeriods:FishingDepthMtr, -->
      <!--   family = gaussian, -->
      <!--   data = species.1.tmp) -->
  
  <!-- # interaction.plot(species.1.tmp$Month, species.1.tmp$FishingZones, species.1.tmp$CpueKGHR) -->
  <!-- # table(species.1.tmp$Month, species.1.tmp$FishingZones) -->
  <!-- summary(a) -->
  <!-- alias(a) -->
  <!-- ``` -->
```





<!--chapter:end:08-part8.Rmd-->

# Correlation Analysis for Primary Species{#id.91}

## Weight Proportions 

**Data preparation**

```{r 9.1}

Top10names.plusone <- c("Macrodon ancylodon",        
"Callinectes ornatus",       
"Stellifer rastrifer",       
"Stellifer microps",         
"Cynoscion virescens",       
"Symphurus plagusia",        
"Bagre bagre",               
"Trichiurus lepturus",       
"Achirus achirus",           
"Paralonchurus brasiliensis", 
"Xiphopenaeus kroyeri") 
  
# Modifying data
species.cor <- ObserverData %>% 
  filter(LatinNames %in% Top10names.plusone) %>% 
  group_by(DragID2) %>%  
  mutate(PropWeight = CpueKGHR/sum(CpueKGHR)) %>% 
  ungroup() %>% 
  dplyr::select(LatinNames,
    DragID2,
    PropWeight,
    Company,
    Month,
    TimePeriods,
    FishingZones,
    FishingDepthMtr)

species.cor.2.temp <- species.cor %>%
  pivot_wider(names_from = LatinNames,
    values_from = PropWeight,
    values_fill = 0) 

head(species.cor.2.temp) %>% 
  kbl() %>%
  kable_classic() %>% 
  row_spec(0, bold = TRUE) %>% 
  kable_styling(fixed_thead = T,
    bootstrap_options = "condensed") %>% 
  scroll_box(width = "750px", height = "300px")

species.cor.2 <- species.cor.2.temp[,7:17]

```

### Correlation plots

```{r 9.2, fig.width = 10, fig.height = 8}
# Species correlation plot 
chart.Correlation(species.cor.2, 
  histogram = TRUE,
  pch = 19)
```

### Correlation matrix

```{r 9.3, fig.width = 10, fig.height = 8}

flattenCorrMatrix <- function(cormat, pmat) {
  ut <- upper.tri(cormat)
  data.frame(
    row = rownames(cormat)[row(cormat)[ut]],
    column = rownames(cormat)[col(cormat)[ut]],
    cor  = (cormat)[ut],
    p = pmat[ut])
}

# Drawing a correlogram
cor.mat <- cor(species.cor.2,
  method = "spearman")
cor.mat[lower.tri(cor.mat)] <- NA
cor.mat <- reshape2::melt(cor.mat)
cor.mat <- na.omit(cor.mat)
cor.mat$Var1 <- factor(cor.mat$Var1,levels = unique(cor.mat$Var1))
cor.mat$Var2 <- factor(cor.mat$Var2,levels = unique(cor.mat$Var2))

ggplot(data = cor.mat, aes(Var2, Var1, fill = value)) +
  geom_tile(color = "white") +
  scale_fill_gradientn(colours = brewer.pal(5,"RdYlBu"),
                       name = "Spearman\nCorrelation") +
  theme_bw(base_size = 15) +
  theme(axis.text.x = element_text(
      angle = 45, vjust = 1, hjust = 1
    ),
    legend.title = element_text(size = 16)
    # ,
    # legend.position = "top"
  ) +
  coord_fixed() +
  labs(x = "",y = "")+
  geom_text(aes(label = round(value, 2)), size = 3)

# Flattening matrix
cor.mtx.2 <- rcorr(as.matrix(species.cor.2))

flattenCorrMatrix(round(cor.mtx.2$r,3),
  format(round(cor.mtx.2$P,3),
    scientific = FALSE)) %>% 
  arrange(p)

# Strong negative correlation between Month and fishing depth - likely the reason for NAs in earlier model. 
```

### Significant correlations 

```{r 9.4, fig.width = 10, fig.height = 8, fig.align = "center"}
m <- cor(species.cor.2)

res1 <- cor.mtest(species.cor.2, conf.level = 0.95)

corrplot(m,
  method = "number",
  type = "upper",
  number.cex = 0.7, 
  p.mat = res1$p,
  tl.cex = 0.8) 
```

## CPUE

**Data preparation**

```{r 9.5}

Top10names.plusone <- c("Macrodon ancylodon",        
"Callinectes ornatus",       
"Stellifer rastrifer",       
"Stellifer microps",         
"Cynoscion virescens",       
"Symphurus plagusia",        
"Bagre bagre",               
"Trichiurus lepturus",       
"Achirus achirus",           
"Paralonchurus brasiliensis", 
"Xiphopenaeus kroyeri") 
  
# Modifying data
species.cor <- ObserverData %>% 
  filter(LatinNames %in% Top10names.plusone) %>% 
  group_by(DragID2) %>%  
  mutate(PropWeight = CpueKGHR/sum(CpueKGHR)) %>% 
  ungroup() %>% 
  dplyr::select(LatinNames,
    DragID2,
    CpueKGHR,
    Company,
    Month,
    TimePeriods,
    FishingZones,
    FishingDepthMtr)

species.cor.3.temp <- species.cor %>%
  pivot_wider(names_from = LatinNames,
    values_from = CpueKGHR,
    values_fill = 0) 

head(species.cor.3.temp)

species.cor.3 <- species.cor.3.temp[,7:17]
```

### Correlation plots

```{r 9.6, fig.width = 10, fig.height = 8}
# Species correlation plot 
chart.Correlation(species.cor.3, 
  histogram = TRUE,
  pch = 19)
```

### Correlation matrix

```{r 9.7, fig.width = 10, fig.height = 8}

# Drawing a correlogram
cor.mat <- cor(species.cor.3,
  method = "spearman")
cor.mat[lower.tri(cor.mat)] <- NA
cor.mat <- reshape2::melt(cor.mat)
cor.mat <- na.omit(cor.mat)
cor.mat$Var1 <- factor(cor.mat$Var1,levels = unique(cor.mat$Var1))
cor.mat$Var2 <- factor(cor.mat$Var2,levels = unique(cor.mat$Var2))

ggplot(data = cor.mat, aes(Var2, Var1, fill = value)) +
  geom_tile(color = "white") +
  scale_fill_gradientn(colours = brewer.pal(5,"RdYlBu"),
                       name = "Spearman\nCorrelation") +
  theme_bw(base_size = 15) +
  theme(axis.text.x = element_text(
      angle = 45, vjust = 1, hjust = 1
    ),
    legend.title = element_text(size = 16)
    # ,
    # legend.position = "top"
  ) +
  coord_fixed() +
  labs(x = "",y = "")+
  geom_text(aes(label = round(value, 2)), size = 3)

# Flattening matrix
cor.mtx.2 <- rcorr(as.matrix(species.cor.3))

flattenCorrMatrix(round(cor.mtx.2$r,3),
  format(round(cor.mtx.2$P,3),
    scientific = FALSE)) %>% 
  arrange(p)


# Strong negative correlation between Month and fishing depth - likely the reason for NAs in earlier model. 
```

### Significant correlations 

```{r 9.8, fig.width = 10, fig.height = 8, fig.align = "center"}
m <- cor(species.cor.3)

res1 <- cor.mtest(species.cor.3, conf.level = 0.95)

corrplot(m,
  method = "number",
  type = "upper",
  number.cex = 0.7, 
  p.mat = res1$p,
  tl.cex = 0.8) 
```

## Species with Factor Variables Correlation

## Weight Proportions

```{r 9.9}
species.fv.cor <- species.cor.2.temp[,2:17] %>% 
  mutate(Company = case_when(Company == "PSI" ~ 1,
    Company == "NHS" ~ 0),
    TimePeriods = case_when(TimePeriods == "Day" ~ 1,
      TimePeriods == "Night" ~ 0))
```

### Correlation plots

```{r 9.10, fig.width = 10, fig.height = 8}

# Species correlation plot 
chart.Correlation(species.fv.cor, 
  histogram = TRUE,
  pch = 19)
```

### Correlation matrix

```{r 9.11, fig.width = 10, fig.height = 8}
# Drawing a correlogram
cor.mat <- cor(species.fv.cor,
  method = "spearman")
cor.mat[lower.tri(cor.mat)] <- NA
cor.mat <- reshape2::melt(cor.mat)
cor.mat <- na.omit(cor.mat)
cor.mat$Var1 <- factor(cor.mat$Var1,levels = unique(cor.mat$Var1))
cor.mat$Var2 <- factor(cor.mat$Var2,levels = unique(cor.mat$Var2))

ggplot(data = cor.mat, aes(Var2, Var1, fill = value)) +
  geom_tile(color = "white") +
  scale_fill_gradientn(colours = brewer.pal(5,"RdYlBu"),
                       name = "Spearman\nCorrelation") +
  theme_bw(base_size = 15) +
  theme(axis.text.x = element_text(
      angle = 45, vjust = 1, hjust = 1
    ),
    legend.title = element_text(size = 16)
    # ,
    # legend.position = "top"
  ) +
  coord_fixed() +
  labs(x = "",y = "")+
  geom_text(aes(label = round(value, 2)), size = 3)

# Flattening matrix
cor.mtx.2 <- rcorr(as.matrix(species.fv.cor))

flattenCorrMatrix(round(cor.mtx.2$r,3),
  format(round(cor.mtx.2$P,3),
    scientific = FALSE)) %>% 
  arrange(p)
```

### Significant correlations 

```{r 9.12, fig.width = 10, fig.height = 8, fig.align = "center"}
m <- cor(species.fv.cor)

res1 <- cor.mtest(species.fv.cor, conf.level = 0.95)

corrplot(m,
  method = "number",
  type = "upper",
  number.cex = 0.7, 
  p.mat = res1$p,
  tl.cex = 0.8) 
```

## CPUE

**Data preparation**

```{r 9.13}

species.fv.cor.2 <- species.cor.3.temp[,2:17] %>% 
  mutate(Company = case_when(Company == "PSI" ~ 1,
    Company == "NHS" ~ 0),
    TimePeriods = case_when(TimePeriods == "Day" ~ 1,
      TimePeriods == "Night" ~ 0))

```

### Correlation plots

```{r 9.14, fig.width = 10, fig.height = 8}

# Species correlation plot 
chart.Correlation(species.fv.cor.2, 
  histogram = TRUE,
  pch = 19)
```

### Correlation matrix

```{r 9.15, fig.width = 10, fig.height = 8}

# Drawing a correlogram
cor.mat <- cor(species.fv.cor.2,
  method = "spearman")
cor.mat[lower.tri(cor.mat)] <- NA
cor.mat <- reshape2::melt(cor.mat)
cor.mat <- na.omit(cor.mat)
cor.mat$Var1 <- factor(cor.mat$Var1,levels = unique(cor.mat$Var1))
cor.mat$Var2 <- factor(cor.mat$Var2,levels = unique(cor.mat$Var2))

ggplot(data = cor.mat, aes(Var2, Var1, fill = value)) +
  geom_tile(color = "white") +
  scale_fill_gradientn(colours = brewer.pal(5,"RdYlBu"),
                       name = "Spearman\nCorrelation") +
  theme_bw(base_size = 15) +
  theme(axis.text.x = element_text(
      angle = 45, vjust = 1, hjust = 1
    ),
    legend.title = element_text(size = 16)
    # ,
    # legend.position = "top"
  ) +
  coord_fixed() +
  labs(x = "",y = "")+
  geom_text(aes(label = round(value, 2)), size = 3)

# Flattening matrix
cor.mtx.2 <- rcorr(as.matrix(species.fv.cor.2))

flattenCorrMatrix(round(cor.mtx.2$r,3),
  format(round(cor.mtx.2$P,3),
    scientific = FALSE)) %>% 
  arrange(p)


# Strong negative correlation between Month and fishing depth - likely the reason for NAs in earlier model. 
```

### Significant correlations 

```{r 9.16, fig.width = 10, fig.height = 8, fig.align = "center"}

m <- cor(species.fv.cor.2)

res1 <- cor.mtest(species.fv.cor.2, conf.level = 0.95)

corrplot(m,
  method = "number",
  type = "upper",
  number.cex = 0.7, 
  p.mat = res1$p,
  tl.cex = 0.8) 
```







<!--chapter:end:09-part9.Rmd-->

# Principal Component Analysis (PCA){#id.101}

**Principal components** are new variables that are constructed as linear combinations or mixtures of the initial variables. 
A PCA converts correlations (or lack thereof) among all of the CPUE and Weight proportions into a 2-D graph. Highly correlated CPUE and Weight proportions will cluster together. 
Also the PCA axis are ranked by order of importance such that differences along the first principal component (PC1) are more important than differences along the second principal component (PC2). This means in clusters = 3 and the difference between clusters on both axes were similar, the clusters along PC1 are deem more different than each other than the clusters along PC2. 

## Prop.Weight Models

```{r 10.1}
# Renaming data
species.pca <- species.cor.2 

# Printing summary of variables
summary(species.pca)
```

```{r 10.2, message = FALSE}

species.pca.2 <- cbind(Row.Names = rownames(species.pca), species.pca)

ggplot(reshape2::melt(species.pca.2, id.vars = "Row.Names"),
  aes(x = value)) +
  geom_histogram(colour = "black", aes(fill = variable)) +
  scale_fill_brewer(palette = "Spectral",
                    name = "Variable")+
  facet_wrap(~variable,
    nrow = 3,
    scales = "free") +
  labs(x = "", 
    y = "Frequency") +
  theme(legend.position = "none") 
```

## PCA

```{r 10.3}
# Before
pca.dat <- PCA(species.pca, 
  graph = TRUE,
  scale.unit = TRUE)

# After 
species.pca.trans <- t(species.pca)
pca.dat.trans <- PCA(species.pca.trans, 
  graph = TRUE,
  scale.unit = TRUE)
```

So what were the PCs generated? How well do they capture the overall variation in the dataset? And how are they stored in the object? Lets take a look.

```{r 10.4}
# Before
pca.eig <- as.data.frame(format(round(pca.dat$eig,3), scientific = FALSE))

pca.eig

# After
pca.eig.trans <- as.data.frame(format(round(pca.dat.trans$eig,3), scientific = FALSE))

pca.eig.trans
```
  
  
```{r 10.5}
# Before
pca.eig$index <- as.factor(1:nrow(pca.eig))
pca.eig$index.cont <- 1:nrow(pca.eig)

nb.cols <- 11
mycolors <- colorRampPalette(rev(brewer.pal(8, "YlGnBu")))(nb.cols)

#Scree plot
ggplot(pca.eig, 
  aes(x = index,
    y = as.numeric(`percentage of variance`))) +
  geom_bar(stat = "identity",
    aes(fill = index),
    colour = "black") +
  geom_path(aes(x = index.cont, 
    group = 1),
    size = 1,
    colour = "Gray50") +
  geom_point(size = 3) +
  labs(x = "Principal Components",
       y = "Percentage of Variance Explained") +
  scale_fill_manual(values = mycolors) +
  theme_bw(base_size = 15) +
  theme(legend.position = "none")

# After 
pca.eig.trans$index <- as.factor(1:nrow(pca.eig.trans))
pca.eig.trans$index.cont <- 1:nrow(pca.eig.trans)

nb.cols <- 10
mycolors <- colorRampPalette(rev(brewer.pal(8, "YlGnBu")))(nb.cols)

#Scree plot
pca.eig.trans %>% 
ggplot(aes(x = index,
  y =as.numeric(`percentage of variance`))) +
  geom_bar(stat = "identity",
    aes(fill = index),
    colour = "black") +
  geom_path(aes(x = index.cont,
    group = 1),
    size = 1,
    colour = "Gray50") +
  geom_point(size = 3) +
  labs(x = "Principal Components",
       y = "Percentage of Variance Explained") +
  scale_fill_manual(values = mycolors) +
  theme_bw(base_size = 15) +
  theme(legend.position = "none")
```

```{r 10.6}

pca.contrib <- as.data.frame(round(pca.dat$var$contrib, 2))[,1:4]
pca.contrib
```

```{r 10.7}
pca.contrib$var <-
  row.names(pca.contrib) #Turn row names into a variable

pca.contrib <- reshape2::melt(pca.contrib,id.vars = "var") #Melt the dataset
  
total.var <-
  paste0("(",pca.eig$`percentage of variance`[1:4],"% of Variance)",sep = "") #Extract the % of variance explained by each PC

pca.contrib$variable <- factor(pca.contrib$variable,labels =
  paste("PC",1:4," ", total.var,sep = "")) #Append these values to the names of each PC
```


```{r 10.8}
pca.coord <- as.data.frame(round(pca.dat$var$coord, 3))
pca.coord
```

```{r 10.9}
for (i in 1:nrow(pca.contrib))
{
  pca.contrib$dir[i] <- pca.coord[which(row.names(pca.coord) == pca.contrib$var[i]),
                                  grep(as.numeric(substr(pca.contrib$variable[i],3,3)),names(pca.coord))] >
    0
}
pca.contrib
```

```{r 10.10}

ggplot(pca.contrib,aes(x = var,
  y = value)) +
  geom_hline(yintercept = 100 / length(unique(pca.contrib$var)),
             linetype = "dashed") +
  geom_bar(stat = "identity",
    aes(fill = var),
    colour = "black") +
  facet_wrap(~variable,
    nrow = 2,
    scales = "free") +
  # geom_label(aes(label = var,colour = dir)) +
  scale_colour_manual(values = c("red","black"))+
  scale_fill_brewer(palette = "Spectral") +
  theme_bw(base_size = 15) +
  labs(x = NULL, y = "% Contribution to Principal Component", fill = " ") +
  theme(axis.text.x = element_blank(),
    legend.position = "bottom") +
  guides(fill = guide_legend(override.aes =
      aes(label = " "), nrow = 4)) 
```

## CPUE Models

```{r 10.11}
# Renaming data
species.pca.2 <- species.cor.3 

# Printing summary of variables
summary(species.pca.2)
```

```{r 10.12, message = FALSE}

species.pca.3 <- cbind(Row.Names = rownames(species.pca.2), species.pca.2)

ggplot(reshape2::melt(species.pca.3, id.vars = "Row.Names"),
  aes(x = value)) +
  geom_histogram(colour = "black", aes(fill = variable)) +
  scale_fill_brewer(palette = "Spectral",
                    name = "Variable")+
  facet_wrap(~variable,
    nrow = 3,
    scales = "free") +
  labs(x = "", 
    y = "Frequency") +
  theme(legend.position = "none") 
```

## PCA

```{r 10.13}
# Before 
pca.dat.2 <- PCA(species.pca.2, 
  graph = TRUE,
  scale.unit = TRUE)

# After 
species.pca.2.trans <- t(species.pca.2)
pca.dat.2.trans <- PCA(species.pca.2.trans, 
  graph = TRUE,
  scale.unit = TRUE)
```

So what were the PCs generated? How well do they capture the overall variation in the dataset? And how are they stored in the object? Lets take a look.

```{r 10.14}
# Before
pca.eig.2 <- as.data.frame(format(round(pca.dat.2$eig,3), scientific = FALSE))

pca.eig.2

# After
pca.eig.2.trans <- as.data.frame(format(round(pca.dat.2.trans$eig,3), scientific = FALSE))

pca.eig.2.trans
```
  
  
```{r 10.15}
# Before 
pca.eig.2$index <- as.factor(1:nrow(pca.eig.2))
pca.eig.2$index.cont <- 1:nrow(pca.eig.2)

nb.cols <- 11
mycolors <- colorRampPalette(rev(brewer.pal(8, "YlGnBu")))(nb.cols)

#Scree plot
ggplot(pca.eig.2,aes(x=index,y=as.numeric(`percentage of variance`))) +
  geom_bar(stat = "identity",aes(fill = index),colour = "black") +
  geom_path(aes(x = index.cont, group = 1),size = 1,colour = "Gray50") +
  geom_point(size = 3) +
  labs(x = "Principal Components",
       y = "Percentage of Variance Explained") +
  scale_fill_manual(values = mycolors) +
  theme_bw(base_size = 15) +
  theme(legend.position = "none")

# After
pca.eig.2.trans$index <- as.factor(1:nrow(pca.eig.2.trans))
pca.eig.2.trans$index.cont <- 1:nrow(pca.eig.2.trans)

nb.cols <- 10
mycolors <- colorRampPalette(rev(brewer.pal(8, "YlGnBu")))(nb.cols)

#Scree plot
ggplot(pca.eig.2.trans,aes(x=index,y=as.numeric(`percentage of variance`))) +
  geom_bar(stat = "identity",aes(fill = index),colour = "black") +
  geom_path(aes(x = index.cont, group = 1),size = 1,colour = "Gray50") +
  geom_point(size = 3) +
  labs(x = "Principal Components",
       y = "Percentage of Variance Explained") +
  scale_fill_manual(values = mycolors) +
  theme_bw(base_size = 15) +
  theme(legend.position = "none")

```

```{r 10.16}
pca.contrib.2 <- as.data.frame(round(pca.dat.2$var$contrib, 2))[,1:4]
pca.contrib.2
```

```{r 10.17}
pca.contrib.2$var <-
  row.names(pca.contrib.2) #Turn row names into a variable

pca.contrib.2 <- reshape2::melt(pca.contrib.2,id.vars = "var") #Melt the dataset
  
total.var <-
  paste0("(",pca.eig.2$`percentage of variance`[1:4],"% of Variance)",sep = "") #Extract the % of variance explained by each PC

pca.contrib.2$variable <- factor(pca.contrib.2$variable,labels =
  paste("PC",1:4," ", total.var,sep = "")) #Append these values to the names of each PC
```


```{r 10.18}
pca.coord.2 <- as.data.frame(round(pca.dat.2$var$coord, 3))
pca.coord.2
```

```{r 10.19}
for (i in 1:nrow(pca.contrib.2))
{
  pca.contrib.2$dir[i] <- pca.coord.2[which(row.names(pca.coord) == pca.contrib.2$var[i]),
                                  grep(as.numeric(substr(pca.contrib.2$variable[i],3,3)),names(pca.coord.2))] >
    0
}
pca.contrib.2
```

```{r 10.20}

ggplot(pca.contrib.2,aes(x = var,
  y = value)) +
  geom_hline(yintercept = 100 / length(unique(pca.contrib.2$var)),
             linetype = "dashed") +
  geom_bar(stat = "identity",
    aes(fill = var),
    colour = "black") +
  facet_wrap(~variable,
    nrow = 2,
    scales = "free") +
  # geom_label(aes(label = var,colour = dir)) +
  scale_colour_manual(values = c("red","black"))+
  scale_fill_brewer(palette = "Spectral") +
  theme_bw(base_size = 15) +
  labs(x = NULL, y = "% Contribution to Principal Component", fill = " ") +
  theme(axis.text.x = element_blank(),
    legend.position = "bottom") +
  guides(fill = guide_legend(override.aes =
      aes(label = " "), nrow = 4)) 
```


## Canonical Correspondence Analysis{#id.102}

```{r 10.21, echo=FALSE}
# data(varespec)
# data(varechem)
# ## Common but bad way: use all variables you happen to have in your
# ## environmental data matrix
# vare.cca <- cca(varespec, varechem)
# vare.cca
# plot(vare.cca)
# ## Formula interface and a better model
# vare.cca <- cca(varespec ~ Al + P*(K + Baresoil), data=varechem)
# vare.cca
# plot(vare.cca)
# ## `Partialling out' and `negative components of variance'
# cca(varespec ~ Ca, varechem)
# cca(varespec ~ Ca + Condition(pH), varechem)
```

## First Approach

```{r 10.22}
# Data
cca.data.all <- species.cor %>%
  pivot_wider(names_from = LatinNames,
    values_from = CpueKGHR,
    values_fill = 0) 

# Creating two data frames
cca.1 <- cca.data.all[,7:17]
cca.2 <- cca.data.all[,2:6]

# Fitting model 
cca.model <- cca(cca.1, cca.2)
cca.model

plot(cca.model, xlim = c(-3,3), ylim = c(-1,1))

summary(cca.model)

anova(cca.model)
```

## Second Approach 

```{r}
data.1 <- cca.1[, 7]
data.2 <- cca.1[, c(1:6,8:11)]

# Running model
cc1 <- cc(data.1, data.2)

# display the canonical correlations
cc1$cor

# raw canonical coefficients
cc1[3:4]
```

The raw canonical coefficients are interpreted in a manner analogous to interpreting regression coefficients i.e., for the species *Paralonchurus brasiliensis*, a one unit increase in CPUE leads to a -0.497 decrease in the first canonical variate of the other variables are held constant?

```{r}
# compute canonical loadings
cc2 <- comput(data.1, data.2, cc1)

# display canonical loadings
cc2[3:6]
```
The above correlations are between observed variables and canonical variables which are known as the canonical loadings. These canonical variates are actually a type of latent variable.

```{r}
# tests of canonical dimensions
rho <- cc1$cor
## Define number of observations, number of variables in first set, and number of variables in the second set.
n <- dim(data.1)[1]
p <- length(data.1)
q <- length(data.2)

## Calculate p-values using the F-approximations of different test statistics:
p.asym(rho, n, p, q, tstat = "Wilks")
```


<!--chapter:end:10-part10.Rmd-->

# CLUSTER ANALYSIS{#id.111} 

K-means finds fixed cluster points (means) in the dataset and compares the distance between each observations and those fixed points. While hierarchical clustering starts by placing each observation in their own cluster (i.e. cluster of 1) and step-wise merges by looking at the differences between the different adjacent points. Thus adding information about structure of the data, unlike K-means. Thus hierarchical clustering looks at both similarity of points and clusters. 

## Prop.Weight - Scaled Data

```{r 11.1}
species.kmeans <- species.pca

prop.wt.kmeans <- t(scale(species.kmeans))
```

## K-Means Clustering 

### K-means Clustering 

```{r 11.2}
# Fitting models
# # K-means = 3
kmeans.3 <- kmeans(prop.wt.kmeans,
  centers = 3,
  nstart = 25)
# K-means = 4
kmeans.4 <- kmeans(prop.wt.kmeans,
  centers = 4,
  nstart = 25)
# K-means = 5
kmeans.5 <- kmeans(prop.wt.kmeans,
  centers = 5,
  nstart = 25)
# K-means = 6
kmeans.6 <- kmeans(prop.wt.kmeans,
  centers = 6,
  nstart = 25)
# K-means = 7
kmeans.7 <- kmeans(prop.wt.kmeans,
  centers = 7,
  nstart = 25)
# K-means = 8
kmeans.8 <- kmeans(prop.wt.kmeans,
  centers = 8,
  nstart = 25)

# Printing k-means = 8 & 11
kmeans.5; kmeans.8
```


### Plotting results

```{r 11.3}
# Plotting 
# K-means = 3
fviz_cluster(kmeans.3,
  data = prop.wt.kmeans,
  ggtheme = theme_bw(),
  main = "Clusters = 3")
# K-means = 4
fviz_cluster(kmeans.4,
  data = prop.wt.kmeans,
  ggtheme = theme_bw(),
  main = "Clusters = 4")
# K-means = 5
fviz_cluster(kmeans.5,
  data = prop.wt.kmeans,
  ggtheme = theme_bw(),
  main = "Clusters = 5")
# K-means = 6
fviz_cluster(kmeans.6,
  data = prop.wt.kmeans,
  ggtheme = theme_bw(),
  main = "Clusters = 6")
# K-means = 7
fviz_cluster(kmeans.7,
  data = prop.wt.kmeans,
  ggtheme = theme_bw(),
  main = "Clusters = 7")
# K-means = 8
fviz_cluster(kmeans.8,
  data = prop.wt.kmeans,
  ggtheme = theme_bw(),
  main = "Clusters = 8")

```

### Determining Optimal Clusters

```{r 11.4}
set.seed(123)

fviz_nbclust(prop.wt.kmeans, kmeans, k.max = 8, method = "wss")
```

## Hierachical Clustering (HC)

```{r 11.5}
# Creating the distance matrix (matrix of the distance between between every point in dataframe)
prop.wt.hc <- prop.wt.kmeans

dist.mtx <- dist(prop.wt.hc)

# Fitting model
fit.hc <- hclust(dist.mtx) # different methods/search algorithms...no wrong or right...default complete linkage...?hclust to list of other options 

# Plot model (dendrogram) and selecting clusters

# k = 3
plot(fit.hc);rect.hclust(fit.hc,
  k = 3,
  border = "red")

# k = 4
plot(fit.hc);rect.hclust(fit.hc,
  k = 4,
  border = "blue") 

# k = 5
plot(fit.hc);rect.hclust(fit.hc,
  k = 5,
  border = "green") 

# k = 6
plot(fit.hc);rect.hclust(fit.hc,
  k = 6,
  border = "purple") 
```

### Determining Optimal Groups

```{r}
ggplot(fit.hc$height %>%
    as.tibble() %>%
    add_column(Groups = length(fit.hc$height):1) %>%
    rename(Height=value),
  aes(x = Groups, y = Height)) +
  scale_x_continuous(breaks = seq(from = 1, to = 10)) +
  geom_point() +
  geom_line() +
  labs(title = "Scree plot - Weight Proportions") +
  theme_bw()
```



## CPUE - Scaled Data

```{r 11.6}
species.kmeans <- species.pca.2

cpue.kmeans <- t(scale(species.kmeans))
```

## K-Means Clustering 

### K-means Clustering 

```{r 11.7}
# Fitting models
# K-means = 3
kmeans.3 <- kmeans(cpue.kmeans,
  centers = 3,
  nstart = 25)

# K-means = 4
kmeans.4 <- kmeans(cpue.kmeans,
  centers = 4,
  nstart = 25)

# K-means = 5
kmeans.5 <- kmeans(cpue.kmeans,
  centers = 5,
  nstart = 25)

# K-means = 6
kmeans.6 <- kmeans(cpue.kmeans,
  centers = 6,
  nstart = 25)

# K-means = 7
kmeans.7 <- kmeans(cpue.kmeans,
  centers = 7,
  nstart = 25)

# K-means = 8
kmeans.8 <- kmeans(cpue.kmeans,
  centers = 8,
  nstart = 25)

# Printing k-means = 8 & 11
kmeans.3; kmeans.8
```


### Plotting results

```{r 11.8}
# Plotting 
# K-means = 3
fviz_cluster(kmeans.3,
  data = cpue.kmeans,
  ggtheme = theme_bw(),
  main = "Clusters = 3")

# K-means = 4
fviz_cluster(kmeans.4,
  data = cpue.kmeans,
  ggtheme = theme_bw(),
  main = "Clusters = 4")

# K-means = 5
fviz_cluster(kmeans.5,
  data = cpue.kmeans,
  ggtheme = theme_bw(),
  main = "Clusters = 5")

# K-means = 6
fviz_cluster(kmeans.6,
  data = cpue.kmeans,
  ggtheme = theme_bw(),
  main = "Clusters = 6")

# K-means = 7
fviz_cluster(kmeans.7,
  data = cpue.kmeans,
  ggtheme = theme_bw(),
  main = "Clusters = 7")

# K-means = 8
fviz_cluster(kmeans.8,
  data = cpue.kmeans,
  ggtheme = theme_bw(),
  main = "Clusters = 8")

```

### Determining Optimal Clusters

```{r 11.9}
set.seed(123)

fviz_nbclust(cpue.kmeans, kmeans, k.max = 8, method = "wss")
```

## Hierachical Clustering (HC)

```{r 11.10}
# Creating the distance matrix (matrix of the distance between between every point in dataframe)
cpue.hc <- cpue.kmeans

dist.mtx <- dist(cpue.hc)

# Fitting model
fit.hc.2 <- hclust(dist.mtx) # different methods/search algorithms...no wrong or right...default complete linkage...?hclust to list of other options 

# Plot model (dendrogram) and selecting clusters


# k = 3
plot(fit.hc.2);rect.hclust(fit.hc.2,
  k = 3,
  border = "red")

# k = 4
plot(fit.hc.2);rect.hclust(fit.hc.2,
  k = 4,
  border = "blue") 

# k = 5
plot(fit.hc.2);rect.hclust(fit.hc.2,
  k = 5,
  border = "green") 

# k = 6
plot(fit.hc.2);rect.hclust(fit.hc.2,
  k = 6,
  border = "purple") 
```

### Determining Optimal Groups

```{r}
ggplot(fit.hc.2$height %>%
    as.tibble() %>%
    add_column(Groups = length(fit.hc.2$height):1) %>%
    rename(Height=value),
  aes(x = Groups, y = Height)) +
  scale_x_continuous(breaks = seq(from = 1, to = 10)) +
  geom_point() +
  geom_line() +
  labs(title = "Scree plot - CPUE") +
  theme_bw()
```


<!--chapter:end:11-part11.Rmd-->

# Appendix

## Bottom trawl fishing vessel{#id.121}

<center>

![A typical bottom trawl fishing vessel used in Guyana (The Maritime Executive, 2020)](C:\Users\UNUFTP\Documents\MyGit\Masters-Thesis-Seion\BottomTrawl.png){width=60%}

</center>

## Discarded fish species{#id.122}

<center>

![An example of fish species discarded (Richardson, 2018)](C:\Users\UNUFTP\Documents\MyGit\Masters-Thesis-Seion\Discards.png){width=60%}

</center>

## Atlantic seabob shrimp{#id.123}

<center>

![A typical photo of an Atlantic seabob shrimp caught offshore Guyana(Torrez, 2015)](C:\Users\UNUFTP\Documents\MyGit\Masters-Thesis-Seion\Seabob.jpg){width=60%}

</center>

## Common Fish Species

<center>

![Marine Fauna - Fish](C:\Users\UNUFTP\Documents\MyGit\Masters-Thesis-Seion\Marine_fauna_poster_Suriname_fish.jpg){width=90%}

</center>

## Common Invertebrate Species

<center>

![Marine Fauna - Invertebrates](C:\Users\UNUFTP\Documents\MyGit\Masters-Thesis-Seion\Marine_fauna_poster_Suriname_invertebrates.jpg){width=90%}

</center>

<!--chapter:end:12-part12.Rmd-->

